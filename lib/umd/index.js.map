{"version":3,"file":"index.js","sources":["vendors/marionette.js","utils/is-known-ctor/ctors.js","utils/is-known-ctor/index.js","utils/better-result/index.js","utils/camel-case/index.js","vendors/helpers.js","utils/compare-ab/get-model.js","utils/compare-ab/get-view.js","utils/compare-ab/index.js","utils/comparator/index.js","utils/convert-string/to-number.js","utils/to-bool/options.js","utils/to-bool/index.js","utils/convert-string/index.js","utils/flat/traverse.js","utils/flat/index.js","utils/get-by-path/get-property.js","utils/get-by-path/get-by-path-array.js","utils/get-by-path/index.js","utils/get-option/index.js","utils/has-flag/index.js","utils/mix/options.js","utils/mix/create-mixin-from-object.js","utils/mix/normalize-arguments.js","utils/mix/with.js","utils/mix/index.js","utils/params-to-object/index.js","utils/set-by-path/set-property.js","utils/set-by-path/ensure-arguments.js","utils/set-by-path/set-by-path-array.js","utils/set-by-path/normalize-options.js","utils/set-by-path/trigger-model-change-events.js","utils/set-by-path/index.js","utils/unflat/index.js","utils/compare-objects/index.js","utils/merge-objects/index.js","utils/trigger-method/index.js","utils/merge-options/index.js","components/process/register.js","components/process/helpers.js","components/process/index.js","components/navigation/router/build-route-context.js","components/navigation/router/action-context.js","components/navigation/router/process-callback.js","components/navigation/route-error-handler/index.js","components/navigation/router/index.js","components/navigation/page/router.js","mixins/common/startable/index.js","mixins/common/childrenable/index.js","components/navigation/page/routes-mixin.js","components/navigation/page/index.js","components/navigation/history/index.js","components/navigation/history-watcher/index.js","components/navigation/navigator/index.js","components/bearer-token/index.js","components/view-manager/borrow.js","components/view-manager/collection.js","components/view-manager/common.js","components/view-manager/customs.js","components/view-manager/utils.js","components/view-manager/models.js","components/view-manager/render.js","components/view-manager/empty-view.js","components/view-manager/index.js","components/store/fake.js","components/store/store.js","components/store/index.js","components/app-error/index.js","components/view-stack/index.js","components/render-in-node/index.js","mixins/collection-view/empty-fetch/index.js","mixins/collection-view/improved-indexes/index.js","mixins/collection-view/next-collection-view/index.js","mixins/collection-view/customs/index.js","mixins/view/css-class-modifiers/index.js","mixins/view/nested-views/build-region.js","mixins/view/nested-views/normalize-region.js","mixins/view/nested-views/index.js","mixins/view/next-view/index.js","mixins/view/destroy/index.js","mixins/view/build-view-by-key/index.js","components/text-view/index.js","components/modals/view-mixin.js","components/modals/config.js","components/modals/index.js","utils/build-view-by-key/index.js","utils/index.js","mixins/common/get-option/index.js","mixins/model/smart-get/get-nested-result.js","mixins/model/smart-get/get-property-schema.js","mixins/model/smart-get/get-display-config.js","mixins/model/smart-get/index.js","mixins/collection/is-fetching/index.js","mixins/controls/button/index.js","mixins/controls/control/index.js","mixins/controls/control-view/index.js","mixins/controls/input/get-input-type.js","mixins/controls/input/set-attributes.js","mixins/controls/input/events/_get-option.js","mixins/controls/input/events/_is-char.js","mixins/controls/input/events/keydown.js","mixins/controls/input/events/keyup.js","mixins/controls/input/events/paste.js","mixins/controls/input/events/blur.js","mixins/controls/input/events/focus.js","mixins/controls/input/events/input.js","mixins/controls/input/events/index.js","mixins/controls/input/handle-event.js","mixins/controls/input/set-events.js","mixins/controls/input/index.js","mixins/controls/promise-bar/index.js"],"sourcesContent":["import Mn, { Region, View } from 'backbone.marionette';\r\n\r\nconst MnObject = Mn.Object || Mn.MnObject;\r\n\r\n\r\nexport {\r\n\tMnObject, Region, View\r\n};\r\n","import { Model, Collection, BackboneView as View, Router } from '../../vendors/backbone.js';\r\nimport { MnObject } from '../../vendors/marionette.js';\r\nimport Mn from 'backbone.marionette';\r\n\r\nlet ctors = [\r\n\tModel,\r\n\tCollection,\r\n\tView,\r\n\tRouter,\r\n\tMnObject,\r\n];\r\n\r\nlet tryGetFromMn = ['Region', 'Application', 'AppRouter'];\r\n\r\n_.each(tryGetFromMn, ClassName => {\r\n\t_.isFunction(Mn[ClassName]) && ctors.push(Mn[ClassName]);\r\n});\r\n\r\n\r\nexport default ctors;\r\n","import knownCtors from './ctors';\r\n\r\nfunction isKnownCtor(arg) {\r\n\tlet isFn = _.isFunction(arg);\r\n\tlet result = _(knownCtors).some((ctor) => arg === ctor || arg.prototype instanceof ctor);\r\n\treturn isFn && result;\r\n}\r\n\r\nexport default isKnownCtor;\r\n","import isKnownCtor from '../is-known-ctor';\r\nexport default function betterResult(obj, key, opts = {})\r\n{\r\n\tlet { context, args, checkAlso, force } = opts;\r\n\tlet defaultValue = opts.default;\r\n\r\n\tif(!_.isString(key) || key === '') return;\r\n\t\r\n\tlet value = (obj || {})[key];\r\n\r\n\tif (value != null && (!_.isFunction(value) || isKnownCtor(value)))\r\n\t\treturn value;\r\n\t\t\r\n\tlet result = force !== false && _.isFunction(value) ? value.apply(context || obj, args) : value;\r\n\r\n\tif (result == null && _.isObject(checkAlso)) {\r\n\t\tlet alsoOptions = _.omit(opts, 'checkAlso');\r\n\t\tresult = betterResult(checkAlso, key, alsoOptions);\r\n\t}\r\n\r\n\tif (result == null && defaultValue != null )\r\n\t\tresult = defaultValue;\r\n\r\n\treturn result;\r\n}\r\n","// camelCase('asd:qwe:zxc') -> asdQweZxc\r\n// camelCase('asd:qwe:zxc', true) -> AsdQweZxc\r\nexport default function camelCase(text, first) {\r\n\tif (!_.isString(text)) return text;\r\n\tvar splitter = first === true ? /(^|:)(\\w)/gi : /(:)(\\w)/gi;\r\n\ttext = text.replace(splitter, (match, prefix, text) => text.toUpperCase());\r\n\tif(!first)\r\n\t\ttext = text.replace(/(^)(\\w)/gi, (match, prefix, text) => text.toLowerCase());\r\n\treturn text;\r\n}","import { Model, Collection, BackboneView as View } from './backbone.js';\r\n\r\n\r\nexport function isClass(arg, Base){\r\n\treturn _.isFunction(arg) && (arg == Base || arg.prototype instanceof Base);\r\n}\r\n\r\n\r\nexport function isModel(arg){\r\n\treturn arg instanceof Model;\r\n}\r\nexport function isModelClass(arg) {\r\n\treturn isClass(arg, Model);\r\n}\r\n\r\n\r\nexport function isCollection(arg){\r\n\treturn arg instanceof Collection;\r\n}\r\nexport function isCollectionClass(arg) {\r\n\treturn isClass(arg, Collection);\r\n}\r\n\r\n\r\nexport function isView(arg){\r\n\treturn arg instanceof View;\r\n}\r\n\r\n\r\nexport function isViewClass(arg) {\r\n\treturn isClass(arg, View);\r\n}\r\n\r\nexport const extend = Model.extend;\r\n\r\n","import { isModel, isView } from '../../vendors/helpers';\r\nexport default function getModel(arg){\r\n\r\n\tif (isModel(arg)) { return arg; }\r\n\t\r\n\tif (isView(arg)) { return arg.model; }\r\n\r\n}\r\n","import { isView }  from '../../vendors/helpers';\r\nexport default function getModel(arg){\r\n\treturn isView(arg) && arg;\r\n}\r\n","\r\nimport getModel from './get-model';\r\nimport getView from './get-view';\r\nexport default function compareAB(a, b, func){\r\n\tif(_.isArray(func)) {\r\n\r\n\t\tlet result = 0;\r\n\r\n\t\t_(func).every((f) => {\r\n\t\t\tresult = compareAB(a,b,f);\r\n\t\t\treturn result === 0;\r\n\t\t});\r\n\t\t\r\n\t\treturn result;\r\n\t} else {\r\n\t\tif (_.isFunction(func)) {\r\n\t\t\ta = func.call(a, getModel(a), getView(a));\r\n\t\t\tb = func.call(b, getModel(b), getView(b));\r\n\t\t}\r\n\r\n\t\tif (a < b) return -1;\r\n\t\tif (a > b) return 1;\r\n\t\treturn 0;\r\n\r\n\t}\r\n}\r\n","import compareAB from '../compare-ab';\r\nexport default function comparator(...args){\r\n\tvar result = 0;\r\n\r\n\t//for simple case (arg1, arg2, compare)\r\n\tif (args.length <= 3 && !_.isArray(args[0])){\r\n\r\n\t\treturn compareAB.apply(null, args);\r\n\r\n\t} \r\n\t//for complex cases ([arg1, arg2, compare], [], .... [])\r\n\t//each arguments should be an array\r\n\telse {\r\n\r\n\t\t_(args).every((single) => {\r\n\r\n\t\t\tif(!_.isArray(single)) return true;\r\n\t\t\tresult = compareAB(...single);\r\n\t\t\treturn result === 0;\r\n\t\t});\r\n\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","export default function toNumber(text){\r\n\tif(_.isNumber(text)) return text;\r\n\tif(!_.isString(text)) return;\r\n\t\r\n\tlet value = parseFloat(text, 10);\r\n\tif(isNaN(value))\r\n\t\tvalue = undefined;\r\n\t\t\r\n\treturn value;\r\n}\r\n","export default {\r\n\tnullable: true, \r\n\tstrict: false,\r\n\treturnNullAs: undefined, \r\n\treturnEmptyAs: undefined, \r\n\treturnNullAndEmptyAs: undefined,\r\n\treturnAnyAs: undefined, \r\n\treturnOtherAs: undefined\r\n};\r\n","import defaultOptions from './options';\r\n\r\nconst trueValues = ['true','1','-1','yes'];\r\nconst falseValues = ['false','0','no'];\r\n\r\nconst alternative = function(...args) {\r\n\tlet returnValue;\r\n\t_(args).some(arg => {\r\n\t\tif(_.isBoolean(arg)) {\r\n\t\t\treturnValue = arg;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n\treturn returnValue;\r\n};\r\n\r\nconst valueOrAlternative = function(nullable, nullValue, value, ...alts){\r\n\tlet alt = alternative(...alts);\r\n\tif (alt != null)\r\n\t\treturn alt;\r\n\telse if (nullable)\r\n\t\treturn nullValue;\r\n\telse\r\n\t\treturn value;\r\n};\r\n\r\nconst convertToBoolean = function (arg, opts = {})\r\n{\r\n\r\n\tlet other;\r\n\tlet options = _.extend({}, defaultOptions, opts);\r\n\tlet { \r\n\t\tnullable, strict,\r\n\t\treturnNullAs, returnEmptyAs, returnNullAndEmptyAs,\r\n\t\treturnAnyAs, returnOtherAs\r\n\t} = options;\r\n\r\n\r\n\r\n\tif (arg == null) {\r\n\t\treturn valueOrAlternative(nullable, undefined, false, returnNullAs, returnNullAndEmptyAs);\r\n\t}\r\n\telse if (arg === '') {\r\n\t\treturn valueOrAlternative(nullable, undefined, false, returnEmptyAs, returnNullAndEmptyAs);\r\n\t} else if (_.isBoolean(arg)) {\r\n\t\treturn arg;\r\n\t}\r\n\t//  else if (_.isObject(arg)) {\r\n\t// }\r\n\t\r\n\tother = strict \r\n\t\t? (nullable ? undefined : false) \r\n\t\t: true;\r\n\t\t\r\n\r\n\tlet text = arg.toString().toLowerCase();\r\n\tlet isTrue = convertToBoolean.trueValues.indexOf(text) > -1;\r\n\tlet isFalse = convertToBoolean.falseValues.indexOf(text) > -1;\r\n\r\n\r\n\tif (_.isBoolean(returnAnyAs)) {\r\n\t\treturn returnAnyAs;\r\n\t} else if (_.isBoolean(returnOtherAs)) {\r\n\t\tother = returnOtherAs;\r\n\t}\r\n\t\r\n\treturn isTrue \r\n\t\t? true \r\n\t\t: isFalse \r\n\t\t\t? false \r\n\t\t\t: other;\r\n};\r\n\r\nconvertToBoolean.trueValues = trueValues;\r\nconvertToBoolean.falseValues = falseValues;\r\nexport default convertToBoolean;\r\n","import toNumber from './to-number';\r\nimport toBoolean from '../to-bool';\r\n\r\n\r\n//this is under development yet and can be change in any time\r\nexport default function convertString(text, type, opts) {\r\n\r\n\tswitch(type){\r\n\tcase 'number':\r\n\t\treturn toNumber(text, opts);\r\n\tcase 'boolean':\r\n\t\treturn toBoolean(text, opts);\r\n\tdefault:\r\n\t\treturn text;\r\n\t}\r\n\r\n\r\n}\r\n","import { isModel } from '../../vendors/helpers';\r\nexport default function traverse(fields, root)\r\n{\r\n\troot = root || '';\r\n\tif (this == null || typeof this != 'object') {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar hash = isModel(this) ? this.attributes : this;\r\n\r\n\tvar props = Object.getOwnPropertyNames(hash);\r\n\r\n\tfor (var x = 0; x < props.length; x++) {\r\n\t\tvar name = props[x];\r\n\t\tvar prop = this[name];\r\n\r\n\t\tif (prop == null || typeof prop != 'object' || (prop instanceof Date || prop instanceof Array)) {\r\n\r\n\t\t\tfields[root + name] = prop;\r\n\t\t}\r\n\t\telse if (typeof prop == 'object') {\r\n\r\n\t\t\ttraverse.call(prop, fields, root + name + '.');\r\n\t\t}\r\n\t}\r\n\t\t\r\n}\r\n","import traverse from './traverse';\r\n\r\nexport default function flattenObject(obj) {\r\n\tif (obj == null || !_.isObject(obj)) return;\r\n\tvar res = {};\r\n\ttraverse.call(obj, res);\r\n\treturn res;\r\n}","import { isModel } from '../../vendors/helpers';\r\nfunction getProperty(context, name)\r\n{\r\n\tif(context == null || !_.isObject(context) || name == null || name == '') return;\r\n\tif (isModel(context))\r\n\t\treturn context.get(name, { gettingByPath: true  });\r\n\telse\r\n\t\treturn context[name];\r\n}\r\nexport default getProperty;\t\r\n","\r\nimport getProperty from './get-property';\r\n\r\nfunction getByPathArray(context, propertyName, pathArray) {\r\n\t\r\n\tif (context == null || !_.isObject(context) || propertyName == null || propertyName == '')\r\n\t\treturn;\r\n\r\n\tvar prop = getProperty(context, propertyName);\r\n\r\n\tif (!pathArray.length || (pathArray.length && prop == null))\r\n\t\treturn prop;\r\n\r\n\tvar nextName = pathArray.shift();\r\n\r\n\treturn getByPathArray(prop, nextName, pathArray);\r\n\r\n}\r\n\r\nexport default getByPathArray;\r\n","import getByPathArray from './get-by-path-array';\r\n\r\nexport default function getByPath(obj, path) {\r\n\r\n\tif (obj == null || !_.isObject(obj) || path == null || path == '') return;\r\n\r\n\tvar pathArray = _.isString(path) ? path.split('.')\r\n\t\t: _.isArray(path) ? [].slice.call(path)\r\n\t\t\t: [path];\r\n\r\n\tvar prop = pathArray.shift();\r\n\r\n\treturn getByPathArray(obj, prop, pathArray);\r\n\r\n}\r\n","import result from '../better-result';\r\n\r\nexport default function getOption(context = {}, key, opts, also) {\r\n\r\n\tif(_.isObject(key) && _.isString(opts)){\r\n\t\tlet _opts = also;\r\n\t\talso = key;\r\n\t\tkey = opts;\r\n\t\topts = _opts;\r\n\t}\r\n\r\n\tlet options = _.extend({ args:[context], context }, opts, { default: null });\r\n\tlet { deep } = options;\r\n\tlet defaultValue = opts && opts.default;\r\n\r\n\tlet value = result(context.options || also, key, options);\r\n\tif (value == null && deep !== false) {\r\n\t\tvalue = result(context, key, options);\r\n\t}\r\n\t\r\n\treturn value != null ? value : defaultValue;\r\n\r\n}\r\n\r\nexport function instanceGetOption(...args){\r\n\treturn getOption(this, ...args);\r\n}\r\n","import camelCase from '../camel-case';\r\nfunction transformStringArray(arr, opts = {}){\r\n\tlet { ignoreCase = true, toCamelCase = false } = opts;\r\n\treturn _(arr).map(value => {\r\n\t\tif (ignoreCase) \r\n\t\t\treturn value.toLowerCase();\r\n\t\telse if (toCamelCase)\r\n\t\t\treturn camelCase(value);\r\n\t\telse\r\n\t\t\treturn value;\r\n\t});\r\n}\r\nexport default function hasFlag(value, flag, opts = {}){\r\n\tif (value == null || flag == null) return false;\r\n\tif(typeof value != typeof flag)\r\n\t\tthrow new Error('value and flag must be of same type. allowed types: string, number');\r\n\r\n\r\n\tif(_.isNumber(value) && _.isNumber(flag)) {\r\n\t\tlet has = value & flag;\r\n\t\treturn opts.all === true ? has === flag : has > 0;\r\n\t}\r\n\r\n\tif(_.isString(value) && _.isString(flag)) {\r\n\t\tif(value === '' || flag === '') return false;\r\n\t\tlet values = transformStringArray(value.split(/\\s*,\\s*/), opts);\r\n\t\tlet flags = transformStringArray(flag.split(/\\s*,\\s*/), opts);\r\n\t\tlet intersection = _.intersection(values, flags);\r\n\t\t\r\n\t\tif(intersection.length == 0) return false;\r\n\r\n\t\tif(intersection.length == flags.length) return true;\r\n\r\n\t\treturn opts.all != true;\r\n\r\n\t}\r\n\r\n}\r\n","export default {\r\n\tmergeObjects: true,\r\n\twrapObjectWithConstructor: true,\r\n};\r\n","export default function createMixinFromObject(arg) {\r\n\tlet mixedObj = _.clone(arg);\r\n\tlet mixedCtor = _.isFunction(mixedObj.constructor) && mixedObj.constructor;\r\n\treturn Base => { \r\n\t\tif (_.isFunction(mixedCtor)) {\r\n\t\t\t//let providedCtor = ((mixed) => mixed)(obj.constructor);\r\n\t\t\tmixedObj.constructor = function mx(){\r\n\t\t\t\tBase.apply(this, arguments);\r\n\t\t\t\tmixedCtor.apply(this, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn Base.extend(mixedObj);\r\n\t};\r\n}\r\n","\r\nimport createMixinFromObject from './create-mixin-from-object';\r\n\r\nexport default function normalizeArguments(args, opts = {}) {\r\n\tlet raw = {};\r\n\tlet wrap = opts.wrapObjectWithConstructor == true;\r\n\tlet merge = opts.mergeObjects == true;\r\n\tlet mixins = [];\r\n\t_(args).each(arg => {\r\n\t\t\r\n\t\t//if argument is function just put it to mixins array\r\n\t\t//and continue;\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\tmixins.push(arg);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if argument is not an object just skip it\r\n\t\tif (!_.isObject(arg)) return;\r\n\r\n\t\t//if mergeObjects == false or wrapObjectWithConstructor == true \r\n\t\t//and there is a constructor function\r\n\t\t//converting to a mixin function\r\n\t\t//otherwise extend rawObject\r\n\t\tif (!merge || (wrap && _.isFunction(arg.constructor))) {\r\n\t\t\tmixins.push(createMixinFromObject(arg));\r\n\t\t} \r\n\t\telse {\r\n\t\t\t_.extend(raw, arg);\r\n\t\t}\r\n\t\r\n\t});\r\n\r\n\t//if rawObject is not empty\r\n\t//convert it to a mixin function\r\n\t//and put it to the begin of mixins array\r\n\tif (_.size(raw))\r\n\t\tmixins.unshift(createMixinFromObject(raw));\r\n\r\n\treturn mixins;\r\n}\r\n","\r\n\r\nimport normalizeArguments from './normalize-arguments';\r\n\r\nexport default function withMethod(...args) {\r\n\r\n\tlet mixins = normalizeArguments(args, this.options);\r\n\tlet Mixed = this.class;\r\n\tif (!mixins.length) return Mixed;\r\n\telse\r\n\t\treturn _.reduce(mixins, (Memo, Ctor) => { \r\n\t\t\tlet mixed = Ctor(Memo);\r\n\t\t\treturn mixed;\r\n\t\t}, Mixed);\r\n\r\n}\r\n","import defaultOptions from './options';\r\nimport withMethod from './with';\r\n\r\nimport extend from '../extend';\r\n\r\n\r\n\r\nexport default function mix(_ctor, options) {\r\n\r\n\tlet opts = _.extend({}, defaultOptions, options);\r\n\r\n\tlet ctor;\r\n\r\n\tif (_.isFunction(_ctor)) {\r\n\t\tctor = _ctor;\r\n\t}\r\n\telse if (_.isObject(_ctor)) {\r\n\t\tlet b = _.isFunction(_ctor.constructor) && _ctor.constructor;\r\n\t\tctor = function mx() { b.apply(this, arguments); };\r\n\t\t_.extend(ctor.prototype, _.omit(_ctor,'constructor'));\r\n\r\n\t} else {\r\n\t\tthrow new Error('Mix argument should be a class or a plain object');\r\n\t}\r\n\r\n\tif (!_.isFunction(ctor.extend))\r\n\t\tctor.extend = extend;\r\n\r\n\treturn {\r\n\t\toptions: opts,\r\n\t\twith: withMethod,\r\n\t\tclass: ctor,\r\n\t};\r\n}\r\n","function pstoSetPair(context, pair){\r\n\tif(!_.isString(pair)) return;\r\n\tlet keyvalue = pair.split('=');\r\n\tlet key = keyvalue.shift();\r\n\tlet value = keyvalue.join('=');\r\n\tpstoSetKeyValue(context, key, value);\r\n}\r\n\r\nfunction pstoSetKeyValue(context, key, value){\r\n\t\t\r\n\tif (key == null) return;\r\n\tkey = decodeURIComponent(key);\r\n\tvalue != null && (value = decodeURIComponent(value));\r\n\r\n\tif(!(key in context))\r\n\t\treturn (context[key] = value);\r\n\r\n\t!_.isArray(context[key]) && (context[key] = [context[key]]);\r\n\r\n\tcontext[key].push(value);\r\n\r\n\treturn context[key];\r\n}\r\n\r\nexport default function paramsToObject(raw, opts = {emptyObject: true}){\r\n\tlet result = {};\r\n\tif(!_.isString(raw)) return opts.emptyObject ? result : raw;\r\n\r\n\tlet pairs = raw.split('&');\r\n\t_(pairs).each((pair) => pstoSetPair(result, pair));\r\n\t\r\n\treturn result;\r\n}\r\n","import getProperty from '../get-by-path/get-property';\r\nimport { isModel } from '../../vendors/helpers';\r\nfunction setProperty(context, name, value) {\r\n\tif (isModel(context)) {\r\n\t\tcontext.set(name, value, { silent: true });\r\n\t}\r\n\telse {\r\n\t\tcontext[name] = value;\r\n\t}\r\n\r\n\treturn getProperty(context, name);\r\n}\r\n\r\nexport default setProperty;\r\n","export default function ensureSetByPathArguments(context, path)\r\n{\r\n\tlet errors = [];\r\n\tif (context == null || !_.isObject(context)) {\r\n\t\terrors.push(new Error('Context is not an object'));\r\n\t}\r\n\tif (!_.isString(path) || path === '') {\r\n\t\terrors.push(new Error('Path is not a string'));\r\n\t}\r\n\tif (errors.length) {\r\n\t\treturn errors;\r\n\t}\r\n}\r\n","import getProperty from '../get-by-path/get-property';\r\nimport setProperty from './set-property';\r\nimport ensureArguments from './ensure-arguments';\r\nimport { isModel } from '../../vendors/helpers';\r\nexport default function setByPathArr(context, propertyName, pathArray, value, options) {\r\n\r\n\tlet argumentsErrors = ensureArguments(context, propertyName);\r\n\tif (argumentsErrors) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet modelContext;\r\n\tif (isModel(context)) {\r\n\t\tmodelContext = {\r\n\t\t\tmodel: context,\r\n\t\t\tproperty: propertyName,\r\n\t\t\tpathChunks: [].slice.call(pathArray)\r\n\t\t};\r\n\t}\r\n\r\n\t//set value if this is a last chunk of path\r\n\tif (!pathArray.length) {\r\n\r\n\t\tmodelContext && options.models.push(modelContext);\r\n\r\n\t\treturn setProperty(context, propertyName, value, options);\r\n\r\n\t} else {\r\n\r\n\t\tvar prop = getProperty(context, propertyName);\r\n\r\n\t\tif (!_.isObject(prop) && !options.force) {\r\n\t\t\treturn;\r\n\t\t} else if (!_.isObject(prop) && options.force) {\r\n\t\t\tprop = setProperty(context, propertyName, {}, options);\r\n\t\t} \r\n\r\n\t\tmodelContext && options.models.push(modelContext);\r\n\r\n\t\tvar nextName = pathArray.shift();\t\r\n\t\treturn setByPathArr(prop, nextName, pathArray, value, options);\r\n\r\n\t}\r\n}\r\n","export default function normalizeSetByPathOptions(opts = {}, ext)\r\n{\r\n\r\n\tlet options = _.extend({}, opts, ext, {\r\n\t\tsilent: opts.silent === true,\r\n\t\tforce: opts.force !== false,\r\n\t\t//passPath: [],\r\n\t\tmodels: []\r\n\t});\r\n\r\n\treturn options;\r\n}\r\n","export default function triggerModelEventsOnSetByPath(value, options = {})\r\n{\r\n\tif (options.silent || !options.models.length) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t_(options.models).each(context => {\r\n\t\tlet rest = context.pathChunks.join(':');\r\n\t\tif (rest) {\r\n\t\t\tcontext.model.trigger(`change:${context.property}:${rest}`, context.model, value);\r\n\t\t}\r\n\t\tcontext.model.trigger(`change:${context.property}`, context.model, value);\r\n\t\tcontext.model.trigger('change', context.model);\r\n\t});\r\n\r\n\t// //triggering change event on all met models\r\n\t// let originPath = options.pathArray.join(':');\r\n\t// while (options.models.length) {\r\n\t// \tlet modelContext = options.models.pop();\r\n\t// \tlet propertyEventName = modelContext.path == ''\r\n\t// \t\t? originPath\r\n\t// \t\t: originPath.substring(modelContext.path.length + 1);\r\n\r\n\t// \tif (propertyEventName) {\r\n\t// \t\tmodelContext.model.trigger('change:' + propertyEventName, value);\r\n\t// \t}\r\n\t// \tmodelContext.model.trigger('change', modelContext.model);\r\n\t// }\r\n}\r\n","import setByPathArray from './set-by-path-array';\r\nimport normalizeOptions from './normalize-options';\r\nimport triggerModelChangeEvents from './trigger-model-change-events';\r\nimport ensureArguments from './ensure-arguments';\r\nexport default function setByPath(context, path, value, opts = {}) {\r\n\r\n\tlet argumentsErrors = ensureArguments(context, path);\r\n\tif (argumentsErrors) {\r\n\t\treturn value;\r\n\t}\r\n\r\n\tlet pathArray = path.split('.');\t\r\n\tlet options = normalizeOptions(opts, { path, pathArray: [].slice.call(pathArray) });\r\n\r\n\tlet propertyName = pathArray.shift();\r\n\r\n\tlet result = setByPathArray(context, propertyName, pathArray, value, options);\r\n\r\n\tif (result === undefined && value !== undefined) {\r\n\t\treturn value;\r\n\t}\r\n\r\n\ttriggerModelChangeEvents(value, options);\r\n\r\n\treturn value;\r\n\r\n\t// if (_.isObject(path) && !_.isArray(path)) {\r\n\t// \tvalue = path.value;\r\n\t// \toptions.force = path.force !== false;\r\n\t// \toptions.silent = path.silent === true;\r\n\t// \tpath = path.path;\r\n\t// }\r\n\r\n\t// var prop = pathArray.shift();\r\n\r\n\t// if (isModel(context)) {\r\n\t// \toptions.models.push({\r\n\t// \t\tpath: '',\r\n\t// \t\tproperty: prop,\r\n\t// \t\tmodel: context\r\n\t// \t});\r\n\t// }\r\n\r\n}\r\n\r\n\r\n","import setByPath from '../set-by-path';\r\n\r\nexport default function unFlat(obj) {\r\n\r\n\tif (obj == null || !_.isObject(obj)) return;\r\n\tvar res = {};\r\n\tfor (var e in obj) {\r\n\t\tsetByPath(res, e, obj[e]);\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n","export default function compareObjects(objectA, objectB) {\r\n\r\n\tif (!_.isObject(objectA) || !_.isObject(objectB)) {\r\n\t\treturn objectA == objectB;\r\n\t}\r\n\tif ((_.isArray(objectA) && !_.isArray(objectB)) || (_.isArray(objectB) && !_.isArray(objectA))) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (typeof objectA != typeof objectB) return false;\r\n\r\n\tlet size = _.size(objectA);\r\n\tif(size != _.size(objectB)) return false;\r\n\r\n\tif (_.isArray(objectA)) {\r\n\t\tlet allvalues = _.uniq(objectA.concat(objectB));\r\n\t\treturn _.every(allvalues, value => {\r\n\t\t\tlet valuesA = _.filter(objectA, _v => _v == value);\r\n\t\t\tlet valuesB = _.filter(objectB, _v => _v == value);\r\n\t\t\tif (valuesA.length != valuesB.length) return false;\r\n\t\t\treturn compareObjects(valuesA[0], valuesB[0]);\r\n\t\t});\r\n\t} else {\r\n\t\tlet allkeys = _.uniq(_.keys(objectA).concat(_.keys(objectB)));\r\n\t\tif (allkeys.length != size) return false;\r\n\t\treturn _.every(allkeys, key => {\r\n\t\t\treturn compareObjects(objectA[key], objectB[key]);\r\n\t\t});\r\n\t}\r\n}\r\n","import { flat, unflat } from '../index.js';\r\n\r\nexport default function mergeObject(src, dst){\r\n\tif (!_.isObject(src) || !_.isObject(dst)) {\r\n\t\treturn dst;\r\n\t}\r\n\tlet flatSrc = flat(src);\r\n\tlet flatDst = flat(dst);\r\n\t_.each(flatDst, (value, key) => {\r\n\t\tflatSrc[key] = value;\r\n\t});\r\n\treturn unflat(flatSrc);\r\n}\r\n","import { camelCase, getOption } from '../index.js';\r\n\r\nexport default function triggerMethod(event, ...args) {\r\n\t// get the method name from the event name\r\n\tconst methodName = camelCase('on:' + event);\r\n\tconst method = getOption(this, methodName, { force: false });\r\n\tlet result;\r\n  \r\n\t// call the onMethodName if it exists\r\n\tif (_.isFunction(method)) {\r\n\t\t// pass all args, except the event name\r\n\t\tresult = method.apply(this, args);\r\n\t}\r\n  \r\n\tif(_.isFunction(this.trigger)) {\r\n\t\t// trigger the event\r\n\t\tthis.trigger.apply(this, arguments);\r\n\t}\r\n  \r\n\treturn result;\r\n}\r\n\r\nexport function triggerMethodOn(context, event, ...args) {\r\n\treturn triggerMethod.call(context, event, ...args);\r\n}\r\n","export default function mergeOptions(options, keys) {\r\n\tif (!options) { return; }\r\n  \r\n\t_.each(keys, key => {\r\n\t\tconst option = options[key];\r\n\t\tif (option !== undefined) {\r\n\t\t\tthis[key] = option;\r\n\t\t}\r\n\t});\r\n}\r\n","\r\nexport default function (Process, context, name, opts) {\r\n\r\n\tcontext[name] = function(...args){\r\n\t\t\r\n\t\tlet process = new Process(context, name, _.extend({}, opts));\r\n\t\tlet concurrent = process.concurrencyCheck();\r\n\r\n\t\tif (concurrent)\r\n\t\t\treturn concurrent;\r\n\t\telse\r\n\t\t\treturn process.run(...args);\r\n\r\n\t};\r\n\r\n}\r\n","export function isPromisable(arg){\r\n\treturn arg instanceof Promise || _.isFunction(arg && arg.then);\r\n}\r\n\r\nexport function asArray(arg) {\r\n\tif(_.isArray(arg))\r\n\t\treturn arg;\r\n\telse if(arg == null || arg === '')\r\n\t\treturn [];\r\n\telse\r\n\t\treturn [arg];\r\n}\r\n\r\nexport function race(...promises){\r\n\treturn Promise.race(promises);\r\n}\r\n\r\nexport function valueToPromise(arg){\r\n\tif(!isPromisable(arg)) {\r\n\t\tlet result = arg;\r\n\t\targ = arg == null || arg === '' ? Promise.resolve() : Promise.reject(result);\r\n\t}\r\n\treturn arg;\t\t\r\n}\r\n","import mix from '../../utils/mix';\r\nimport { triggerMethodOn } from '../../utils/index.js';\r\nimport camelCase from '../../utils/camel-case';\r\nimport result from '../../utils/better-result';\r\nimport register from './register';\r\n\r\nimport { isPromisable, race, asArray, valueToPromise } from './helpers';\r\n\r\nconst Process = mix({\r\n\tconstructor: function Process(context, name, opts){\r\n\t\tthis._initDefaults(name, context);\r\n\t\tthis._initCancelation();\r\n\t\tthis._mergeOptions(opts);\r\n\t},\r\n\r\n\r\n\t// initialize methods\r\n\r\n\t_initDefaults(name, context){\r\n\t\tif(name == null || name === '')\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. name missing');\r\n\t\t\r\n\t\tif(!_.isObject(context))\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. context is not an object');\r\n\r\n\t\tthis.cid = _.uniqueId('process');\r\n\t\tthis.name = name;\r\n\t\tthis.context = context;\r\n\t\tthis.errors = [];\r\n\t},\r\n\r\n\t_initCancelation(){\r\n\t\tthis.cancelPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis.cancel = () => reject('cancel'); \r\n\t\t});\r\n\t},\r\n\t_mergeOptions(opts = {}){\r\n\t\tlet options = _.omit(opts, 'cid', 'name', 'context', 'cancelPromise', 'cancel', 'errors');\r\n\t\t_(options).each((value, key) => this[key] = value);\r\n\t},\r\n\r\n\t\r\n\tconcurrencyCheck(){\r\n\r\n\t\tlet previous = this.getProcessFromContext();\r\n\t\t//console.log(previous, this.context);\r\n\t\tif(!previous) return;\r\n\t\r\n\t\tlet concurrent = this.concurrent;\t\r\n\t\t\r\n\t\tif (concurrent === false) {\r\n\t\r\n\t\t\tthis.cancel();\r\n\t\r\n\t\t} else if (concurrent == 'first') {\r\n\t\r\n\t\t\treturn previous.promise;\r\n\t\r\n\t\t} else if (concurrent == 'last') {\r\n\t\r\n\t\t\tprevious.cancel();\r\n\t\r\n\t\t}\t\t\r\n\t},\r\n\r\n\r\n\t// life cycle methods\t\r\n\r\n\trun(...args){\r\n\t\tthis.updateProcessInContext(this);\r\n\t\tthis.args = args || [];\r\n\t\tthis.promise = this._createLifeCyclePromise();\r\n\t\treturn this.promise;\r\n\t},\r\n\r\n\r\n\t_createLifeCyclePromise(){\r\n\r\n\r\n\t\treturn this._notCanceled()\r\n\t\t\t.then(() => this._begin())\r\n\t\t\t.then(() => this._beforeStart())\r\n\t\t\t.then(() => this._canBeStarted())\r\n\t\t\t.then(() => this._waitOtherPromises())\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.triggerComplete();\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tthis.triggerError(error);\r\n\t\t\t\tlet jsError;\r\n\t\t\t\tif(error instanceof Error) {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t} else if ((jsError = this.getJsError())) {\r\n\t\t\t\t\tthrow jsError;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(this);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_notCanceled() {\r\n\t\treturn this._cancelationRace(Promise.resolve());\r\n\t},\r\n\t_begin(){\r\n\t\treturn this._getHookResultAsPromise('begin');\r\n\t},\r\n\t_beforeStart(){\r\n\t\treturn this._getHookResultAsPromise('before');\r\n\t},\r\n\t_canBeStarted(){\r\n\t\tlet contextMethod = 'can:not:' + this.name;\r\n\t\tlet promise = this.invokeOnContext(contextMethod);\r\n\t\tif(!isPromisable(promise)) {\r\n\t\t\tpromise = (promise == null || promise === '') \r\n\t\t\t\t? Promise.resolve()\r\n\t\t\t\t: Promise.reject(promise);\r\n\t\t}\r\n\t\treturn this._cancelationRace(promise);\r\n\t},\r\n\t_waitOtherPromises(){\r\n\t\tlet contextMethod = `get:${this.name}:promises`;\r\n\t\t\r\n\t\tlet promises = asArray(this.invokeOnContext(contextMethod));\r\n\r\n\t\treturn this._cancelationRace(Promise.all(promises));\r\n\t},\r\n\r\n\t_getHookResultAsPromise(hookName){\r\n\t\tlet procMethod = camelCase('on:' + hookName);\r\n\t\tlet procHook = _.isFunction(this[procMethod]) && this[procMethod](this.context, ...this.args) || undefined;\r\n\t\tlet result = valueToPromise(procHook).then(() => {\r\n\t\t\tlet cntxHook = this.triggerOnContext(hookName);\r\n\t\t\treturn valueToPromise(cntxHook);\r\n\t\t});\r\n\r\n\t\treturn this._cancelationRace(result);\r\n\r\n\t},\r\n\r\n\t// trigger methods\r\n\r\n\ttriggerComplete() { \r\n\r\n\t\tthis.updateProcessInContext(null);\r\n\r\n\t\tif (_.isFunction(this.onComplete))\r\n\t\t\tthis.onComplete(this.context, ...this.args);\r\n\r\n\t\tthis.triggerOnContext();\r\n\r\n\t\tthis.triggerEnd();\r\n\t\t\r\n\t\r\n\t},\r\n\ttriggerError(errors){\r\n\r\n\r\n\t\tthis.updateProcessInContext(null);\t\t\r\n\r\n\t\tif(!_.isArray(errors))\r\n\t\t\terrors = [errors];\r\n\r\n\t\tthis.errors.push(...errors);\r\n\r\n\t\t\r\n\t\tif (_.isFunction(this.onError))\r\n\t\t\tthis.onError(this.context, ...this.errors);\r\n\t\t\r\n\t\tthis.triggerOnContext('error', ...this.errors);\r\n\t\t\r\n\t\tthis.triggerEnd();\r\n\r\n\t\t\r\n\t},\r\n\ttriggerEnd(){\r\n\t\tthis.triggerOnContext('end');\r\n\t},\r\n\r\n\r\n\r\n\t// helpers methods\r\n\r\n\tgetJsError(context){\r\n\t\t!context && (context = this);\r\n\t\tif(context != this && (!_.isObject(context) || !_.isArray(context.errors)))\r\n\t\t\treturn;\r\n\r\n\t\treturn _(context.errors).filter(f => f instanceof Error)[0];\r\n\t},\t\r\n\r\n\t_cancelationRace(promise){\r\n\t\treturn race(this.cancelPromise, promise);\r\n\t},\r\n\r\n\r\n\tgetContextProcessKey(){\r\n\t\treturn camelCase(`_process:${this.name}:executing`);\r\n\t},\r\n\tgetProcessFromContext(){\r\n\t\tlet key = this.getContextProcessKey();\r\n\t\treturn this.context[key];\r\n\t},\r\n\tupdateProcessInContext(process){\r\n\t\tlet key = this.getContextProcessKey();\t\t\r\n\t\tthis.context[key] = process;\r\n\t},\r\n\r\n\r\n\r\n\ttriggerOnContext (eventName) {\r\n\t\r\n\t\tlet context = this.context; \r\n\t\tif(!_.isFunction(context.trigger))\r\n\t\t\treturn;\r\n\t\t\r\n\t\tlet event = (eventName ? eventName + ':' : '') + this.name;\r\n\t\t\r\n\t\treturn triggerMethodOn(context, event, this, ...this.args);\r\n\t\r\n\t},\r\n\r\n\tinvokeOnContext(methodName)\r\n\t{\r\n\t\tlet method = camelCase(methodName);\r\n\t\tlet context = this.context;\r\n\t\tlet args = this.args;\r\n\t\treturn result(context, method, { args });\r\n\r\n\t}\r\n\r\n}).class;\r\n\r\n\r\nProcess.register = function(context, name, opts) {\r\n\treturn register(this, context, name, opts);\r\n};\r\n\r\nexport default Process;\r\n","import result from '../../../utils/better-result';\r\n\r\nfunction get(router, opts = {}, key, update){\r\n\t\r\n\tlet value = result(opts, key, { context: router, args:[ router ] });\r\n\tif(value == null) {\r\n\t\tvalue = router.getOption(key, {args: [ router ]});\r\n\t\tif(update)\r\n\t\t\topts[key] = value;\r\n\t}\r\n\treturn value;\t\t\r\n}\r\n\r\n// converts route method arguments to plain object;\r\n// _normalizeRegisterRouteArguments\r\n// { route, rawRoute, callback, name }\r\nexport default function routeArgumentsToObject(router, route, name, callback, opts = {}){\r\n\r\n\tlet context = {};\r\n\r\n\tif(_.isObject(route)){\r\n\t\tcontext = route;\r\n\t\t//_.extend(context, route);\r\n\t\t//then second argument is probably options;\r\n\t\t_.extend(opts, name);\r\n\r\n\t} else if (_.isFunction(name)) {\r\n\t\t_.extend(context, { route, callback: name, name: _.uniqueId('routerAction') });\r\n\t} else {\r\n\t\t_.extend(context, { route, name, callback });\r\n\t}\r\n\r\n\tlet isRouterHoldsActions = get(router, opts, 'isRouterHoldsActions', true);\r\n\t//let isRouteChaining = get(router, opts, 'isRouteChaining', true);\r\n\r\n\t// !_(opts).has('isRouterHoldsActions') && (opts.isRouterHoldsActions = this.getOption('isRouterHoldsActions'));\r\n\t// !_(opts).has('isRouteChaining') && (opts.isRouteChaining = this.getOption('isRouteChaining'));\r\n\r\n\r\n\t// last chance to get callback from router instance by name\r\n\t// this behavior can be disabled through `isRouterHoldsActions` options\r\n\tif(!_.isFunction(context.callback) && isRouterHoldsActions && _.isFunction(router[context.name])) {\r\n\r\n\t\tcontext.callback = router[context.name];\r\n\r\n\t}\r\n\r\n\t//store original route\r\n\tcontext.rawRoute = context.route;\r\n\r\n\t!context.name && (context.name = _.uniqueId('routerAction'));\r\n\r\n\t//converts route to RegExp pattern\r\n\tif (!_.isRegExp(context.route)) context.route = router._routeToRegExp(context.route);\r\n\r\n\t// by default backbone router wraps every callback with own wrapper\r\n\t// which in turn call actual callback with correct arguments on route\r\n\t// this callback was inlined and can not be overrided, so now its possible\t\r\n\tcontext.callbackWrapper = _.bind(router._processCallback, router, context);\r\n\r\n\treturn context;\r\n}\r\n\r\n\r\n\r\n","export function createActionContext(router, routeContext, fragment, options = {}) {\r\n\r\n\tlet rawArgs = router._extractParameters(routeContext.route, fragment);\r\n\r\n\tlet result = _.extend({}, routeContext, { fragment, rawArgs }, options, { options });\r\n\r\n\tlet args = rawArgs.slice(0);\r\n\tlet queryString = args.pop();\r\n\r\n\t_.extend(result, { qs: prepareActionQueryString(router, queryString) });\r\n\t_.extend(result, { args: prepareActionArguments(routeContext.rawRoute, args) });\r\n\r\n\tif (result.routeType == null) {\r\n\t\tresult.routeType = 'route';\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction prepareActionQueryString(router, queryString){\r\n\tif(_.isString(queryString))\r\n\t\treturn router.queryStringParser(queryString);\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nfunction prepareActionArguments(rawRoute, args){\r\n\r\n\tlet params = rawRoute.match(/:([^/|)]+)/g) || [];\r\n\t\r\n\tlet res = {};\r\n\t_(params).each((name, index) => {\r\n\t\tname = name.substring(1);\r\n\t\t\r\n\t\tif(args == null) return;\r\n\r\n\t\tif(name in res && _.isArray(res[name]))\r\n\t\t\tres[name].push(args[index]);\r\n\t\telse if(name in res && !_.isArray(res[name]))\r\n\t\t\tres[name] = [res[name]].concat(args[index]);\r\n\t\telse\r\n\t\t\tres[name] = args[index];\r\n\t});\r\n\treturn res;\r\n}\r\n","\r\nfunction toPromise(arg, resolve = true){\r\n\tif (arg instanceof Promise || (arg && _.isFunction(arg.then)))\r\n\t\treturn arg;\r\n\telse if (arg instanceof Error)\r\n\t\treturn Promise.reject(arg);\r\n\telse\r\n\t\treturn resolve \r\n\t\t\t? Promise.resolve(arg) \r\n\t\t\t: Promise.reject(arg);\r\n}\r\nfunction getCallbackFunction(callback, executeResult)\r\n{\r\n\treturn (...args) => {\r\n\t\ttry {\r\n\t\t\texecuteResult.value = callback && callback(...args);\r\n\t\t} catch(exception) {\r\n\t\t\texecuteResult.value = exception;\r\n\t\t}\r\n\t\texecuteResult.promise = toPromise(executeResult.value);\r\n\t\treturn executeResult.value;\r\n\t};\r\n}\r\n\r\n\r\nexport function processCallback(router, actionContext, routeType){\t\r\n\t\r\n\tlet args = router.getOption('classicMode') \r\n\t\t? actionContext.rawArgs || [] \r\n\t\t: [ actionContext ];\r\n\r\n\tlet asPromise = router.getOption('callbackAsPromises');\r\n\tlet executeResult = {};\r\n\tlet callback = getCallbackFunction(actionContext.callback, executeResult, asPromise);\r\n\r\n\t//console.log('routeType:',routeType);\r\n\r\n\trouter.triggerEvent('before:' + routeType, actionContext);\r\n\r\n\tlet shouldTriggerEvent = router.execute(callback, args);\r\n\tif (shouldTriggerEvent !== false) {\r\n\t\trouter.triggerEvent(routeType, actionContext);\r\n\t\tif(routeType == 'route' || routeType == 'backroute')\r\n\t\t\trouter.lastAttempt = actionContext;\r\n\t}\r\n\r\n\texecuteResult.promise.then(\r\n\t\t(arg) => {\r\n\t\t\trouter.triggerEvent('after:'+routeType, actionContext);\r\n\t\t\treturn arg;\r\n\t\t},\r\n\t\t(error) => {\r\n\t\t\trouter.triggerEvent('error:' + routeType, error, actionContext);\r\n\t\t\trouter.handleError(error, actionContext);\r\n\t\t}\r\n\t);\r\n\r\n\treturn executeResult.value;\r\n}\r\n\r\n\r\n\r\n","\r\nexport default {\r\n\thandlers: {\r\n\t\t'js:error'(error){\r\n\t\t\tthrow error;\r\n\t\t},\r\n\t},\r\n\thandle(error, context, args){\r\n\r\n\t\tlet handlers = this._getHandleContext(error, context, args) || {};\r\n\t\treturn _(handlers).some((options, key) => this.applyHandler(key, options));\r\n\r\n\t},\r\n\tapplyHandler(key, options = {}){\r\n\r\n\t\tlet handler = this.getHandler(key, options);\r\n\t\tif (!handler) return;\r\n\t\tlet { context, args } = options;\r\n\t\treturn handler.apply(context, args);\r\n\r\n\t},\r\n\tgetHandler(key){\r\n\t\tif(_.isFunction(this.handlers[key]))\r\n\t\t\treturn this.handlers[key];\r\n\t},\r\n\tsetHandler(key, handler){\r\n\t\tif(!_.isString(key) || key === '')\r\n\t\t\tthrow new Error('setHandler first argument must be a non empty string');\r\n\r\n\t\tif (!_.isFunction(handler)) {\r\n\t\t\tdelete this.handlers[key];\r\n\t\t} else {\r\n\t\t\tthis.handlers[key] = handler;\r\n\t\t}\r\n\t},\r\n\tsetHandlers(hash){\r\n\t\tlet nullable = hash === null;\r\n\t\tlet items = nullable && this.handlers || hash;\r\n\t\tif(!_.isObject(items)) return;\r\n\t\t_(items).each((handler, key) => this.setHandler(key, nullable || handler));\r\n\t},\r\n\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\t_getHandleContext(error, context, args = []){\r\n\r\n\t\tif (_.isArray(error)) {\r\n\t\t\treturn _(error).reduce((memo, item) => _.extend(memo, this._getHandleContext(item, context, args)), {});\r\n\t\t}\r\n\r\n\t\tif(_.isFunction(this.getHandleContext)) {\r\n\t\t\tlet custom = this.getHandleContext(error, context, args);\r\n\t\t\tif(custom != null) return custom;\r\n\t\t}\r\n\r\n\t\tif (error instanceof Error) {\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'js:error': { context, args } };\r\n\t\t}\r\n\t\telse if(_.isString(error)) {\r\n\t\t\treturn { [error]: { context, args } };\r\n\t\t}\r\n\t\telse if(error instanceof $.Deferred().constructor){\r\n\t\t\targs.unshift(error);\r\n\t\t\treturn { 'jq:xhr': { context, args }};\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// provide your own arguments processor\r\n\t// should return hash: { 'handler_key': { context: handler_context, args: handler_arguments}}\r\n\tgetHandleContext: undefined,\r\n\r\n};\r\n","import mix from '../../../utils/mix';\r\nimport GetOptionMixin from '../../../mixins/common/get-option';\r\nimport paramStringToObject from '../../../utils/params-to-object';\r\nimport { Router as BbRouter } from '../../../vendors/backbone.js';\r\n\r\nimport buildRouteContextFromArguments from './build-route-context';\r\n\r\nimport  { createActionContext } from './action-context';\r\nimport { processCallback } from './process-callback';\r\nimport errorHandler from '../route-error-handler';\r\n\r\n\r\nconst BaseRouter = mix(BbRouter).with(GetOptionMixin);\r\nconst Router = BaseRouter.extend({\r\n\r\n\r\n\t// for migrating from Mn.AppRoute\r\n\t// set to true. it will populate routes from { controller, appRoutes } structure.\r\n\tisMarionetteStyle: false,\r\n\r\n\t// by default Backbone.Router tries to lookup callback in router instance by name `callback = this[name]` if there is no callback provided\r\n\t// its recomend to turn this feature to false\r\n\t// default value is true for Backbone.Router compatability\r\n\tisRouterHoldsActions : true,\r\n\r\n\t// by default Backbone.Router `route` method returns router itself instead of just created routeContext for chaining purposes.\r\n\t// you can change this behavior turning this feature to false\r\n\tisRouteChaining: true,\r\n\r\n\t//in classic mode actions receive argument array\r\n\t//if you need actionContext instead turn this option to false\r\n\tclassicMode: true,\r\n\r\n\tconstructor(options = {}){\r\n\t\t\r\n\t\tthis.options = _.extend({}, _.result(this, 'options'), options);\r\n\r\n\t\tBaseRouter.apply(this, arguments);\r\n\r\n\t\t//this.on('re:route:last', this._onReRouteLast);\r\n\t},\r\n\r\n\r\n\t/*\r\n\r\n\t\tinitialize methods\r\n\t\t\"when a router initialized\"\r\n\r\n\t*/\r\n\r\n\t//by default router expects that routes will result in { route, callback } hash\r\n\t//we are extending this to provide more flexibility\r\n\t// - overrided\r\n\t_bindRoutes: function() {\r\n\t\t\r\n\t\tlet routes = this.getInitRoutes();\r\n\t\tif(!_.size(routes)) return;\r\n\t\tthis.addRoutes(routes);\r\n\r\n\t},\r\n\tgetInitRoutes(){\r\n\t\tlet routes;\r\n\t\tif(this.getOption('isMarionetteStyle')) {\r\n\t\t\tlet controller = this.getOption('controller') || {};\r\n\t\t\tlet approutes = this.getOption('appRoutes') || {};\r\n\t\t\troutes = _(approutes).map((name, route) => ({ \r\n\t\t\t\troute, name, \r\n\t\t\t\tcallback: controller[name] \r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\troutes = this.getOption('routes');\r\n\t\t}\r\n\t\treturn routes;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tmanipulating routes\r\n\t\tadding\r\n\t*/\r\n\r\n\t// refactored original route method\r\n\t// chain:true by default is for supporting default behavior\r\n\t// routerHoldsActions: true - backbone router tries to get callback from router itself if there is no callback provided. \r\n\t// this options allow to support this behavior, but its recomended not to hold action inside router instance\r\n\t// - overrided\r\n\troute(route, name, callback, opts = {}){\r\n\t\t\r\n\t\t//normalizing passed arguments and putting them into a context object\r\n\t\t//refactored from original route\r\n\t\t// let context = this._normalizeRegisterRouteArguments(route, name, callback, opts);\r\n\r\n\t\t// //extends context with result of `mergeWithRegisterRouteContext`\r\n\t\t// this._normalizeRegisterRouteContext(context);\r\n\r\n\t\t// //wrapping provided callback \r\n\t\t// this._normalizeRegisterRouteCallback(context);\r\n\r\n\t\tlet context = this._buildRouteContext(route, name, callback, opts);\r\n\r\n\t\t//refactored for providing possibility to override\r\n\t\t//at this point context should be almost ready\r\n\t\tthis.registerRouteContext(context);\r\n\r\n\t\tthis._storeCreatedContext(context, opts);\r\n\r\n\t\treturn opts.isRouteChaining === true \r\n\t\t\t? this \r\n\t\t\t: context;\r\n\r\n\t},\r\n\r\n\t// provide more semantic alias for route\r\n\taddRoute(route, name, callback, opts = {}){\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet context = this.route(route, name, callback, opts);\r\n\t\treturn context;\r\n\t},\r\n\r\n\t//process many routes at once\r\n\t//accepts object { name, routeContext | handler }\r\n\t// or array of routeContexts\r\n\taddRoutes(routes, opts = {}){\r\n\r\n\t\tif(opts.isRouteChaining == null)\r\n\t\t\topts.isRouteChaining = this.getOption('isRouteChaining');\r\n\r\n\t\tlet normalized = _(routes)\r\n\t\t\t.chain()\r\n\t\t\t.map((value, key) => this._normalizeRoutes(value, key))\r\n\t\t\t.filter(f => _.isObject(f))\r\n\t\t\t.value();\r\n\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tnormalized.reverse();\r\n\r\n\t\tlet registered = _(normalized).map(\r\n\t\t\troute => route && \r\n\t\t\tthis.addRoute(route, _.extend({ massAdd:true }, opts))\r\n\t\t); \r\n\t\t\r\n\t\tif(opts.doNotReverse != true)\r\n\t\t\tregistered.reverse();\r\n\r\n\t\t_(registered).each((c) => this._storeCreatedContext(c));\r\n\t\t\r\n\t\treturn registered;\r\n\t},\r\n\r\n\t// internal method called by `addRoutes` to normalize provided data\r\n\t_normalizeRoutes(value, key){\r\n\t\t//let route, name, callback;\r\n\t\tlet context;\r\n\t\tif (_.isString(value)) {\r\n\t\t\tcontext = { \r\n\t\t\t\troute: key, \r\n\t\t\t\tname: value, \r\n\t\t\t};\r\n\t\t}\r\n\t\telse if(_.isFunction(value)){\r\n\t\t\tcontext = { route:key, callback:value };\r\n\t\t}else if(_.isObject(value)){\r\n\t\t\tcontext = _.clone(value);\r\n\t\t\tif(!_.has(context, 'route'))\r\n\t\t\t\tcontext.route = key;\r\n\t\t\telse if(_.has(context, 'route') && !_.has(context, 'name'))\r\n\t\t\t\tcontext.name = key;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_buildRouteContext(route, name, callback, opts) {\r\n\r\n\t\tlet context = buildRouteContextFromArguments(this, route, name, callback, opts);\r\n\r\n\t\treturn this.buildRouteContext(context);\r\n\t},\r\n\r\n\t//override this method if you need more information in route context\r\n\t// should return object wich will be merged with default context\r\n\t// be aware of providing reserved properties: route, name, callback\r\n\t// this will override context defaults\r\n\tbuildRouteContext: context => context,\r\n\r\n\r\n\t//finally, putting handler to the backbone.history.handlers\r\n\tregisterRouteContext(context){\r\n\t\tBackbone.history.route(context.route, context.callbackWrapper, context);\r\n\t},\r\n\r\n\t//store registered context for further use\r\n\t_storeCreatedContext(context, opts = {}){\r\n\t\tthis.routeContexts || (this.routeContexts = {});\r\n\t\tif(!opts.massAdd)\r\n\t\t\tthis.routeContexts[context.name] = context;\r\n\t\treturn context;\r\n\t},\r\n\r\n\r\n\r\n\t/*\r\n\t\r\n\t\tprocess route methods\t\t\r\n\t\t\"when route happens\"\r\n\r\n\t*/\r\n\r\n\t//inner route handler\r\n\t//preparing actionContext and calls public processCallback\r\n\t_processCallback (routeContext, fragment, options = {}) {\r\n\t\tlet actionContext = createActionContext(this, routeContext, fragment, options);\r\n\t\tactionContext.restart = () => actionContext.callbackWrapper(fragment, options);\r\n\t\tlet result = this.processCallback(actionContext, actionContext.routeType, options);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t//by default behave as original router\r\n\t//override this method to process action by your own\r\n\tprocessCallback(actionContext, routeType){\r\n\r\n\t\treturn processCallback(this, actionContext, routeType);\r\n\r\n\t},\r\n\r\n\thandleError(error, action){\t\t\r\n\t\terrorHandler.handle(error, this, [action]);\r\n\t},\r\n\r\n\t//just triggers appropriate events\r\n\t// triggerRouteEvents(context, event, name, ...args) {\r\n\t// \tif (event == 'route') {\r\n\t// \t\tthis.lastActionContext = context;\r\n\t// \t}\r\n\t// \tthis.trigger(`${event}:${name}`, ...args);\r\n\t// \tthis.trigger(event, name, ...args);\r\n\t// \tBackbone.history.trigger(event, this, name, ...args);\r\n\t// },\r\n\r\n\ttriggerEvent(event, context){\r\n\t\tthis.trigger(event, context);\r\n\t\tBackbone.history.trigger(event, context);\r\n\t},\r\n\r\n\r\n\r\n\r\n\t//converts string to object\r\n\t//default implementation, can be overriden by user\r\n\tqueryStringParser: paramStringToObject,\t\r\n\r\n\t// navigate(...args){\r\n\t// \thistoryNavigate(...args);\r\n\t// \treturn this;\r\n\t// },\r\n\r\n\t_routeToRegExp(route) {\r\n\r\n\t\tvar optionalParam = /\\((.*?)\\)/g;\r\n\t\tvar namedParam    = /(\\(\\?)?:\\w+/g;\r\n\t\tvar splatParam    = /\\*\\w+/g;\r\n\t\tvar escapeRegExp  = /[-{}[]+?.,\\\\\\^$|#\\s]/g;\r\n\r\n\t\troute = route.replace(escapeRegExp, '\\\\$&')\r\n\t\t\t.replace(optionalParam, '(?:$1)?')\r\n\t\t\t.replace(namedParam, function(match, optional) {\r\n\t\t\t\treturn optional ? match : '([^/?]+)';\r\n\t\t\t})\r\n\t\t\t.replace(splatParam, '([^?]*?)');\r\n\t\tlet flags = this.getOption('routeCaseInsensitive') ? 'i' : '';\r\n\t\treturn new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$', flags);\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tSome API methods\r\n\t*/\r\n\r\n\tgetContextByFragment(fragment)\t{\r\n\t\tif(!_.isString(fragment)) return;\r\n\t\t//let contexts = this.routeContexts;\r\n\t\t//console.log('Router contexts', contexts);\r\n\t\tlet result = _(this.routeContexts).find((cntx) => cntx.route.test(fragment));\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n});\r\n\r\nexport default Router;\r\n","import Process from '../../process';\r\nimport BaseRouter from '../router';\r\nimport errorHandler from '../route-error-handler';\r\n\r\nexport default BaseRouter.extend({\r\n\t\r\n\tclassicMode:false,\r\n\tisRouterHoldsActions : false,\r\n\tisRouteChaining: false,\t\r\n\tcallbackAsPromises: true,\r\n\trouteCaseInsensitive: true,\r\n\tregisterPageRoutes(page){\r\n\t\tlet contexts = page.getRoutesContexts({ reverse: true });\r\n\t\t_(contexts).each(context => {\r\n\t\t\tlet callback = (...args) => {\r\n\t\t\t\treturn this.startPage(page, ...args);\r\n\t\t\t};\r\n\t\t\tthis.addRoute(context.route, context.name, callback);\r\n\t\t});\r\n\t},\r\n\thandleError(process, action){\r\n\t\tlet args, error;\r\n\r\n\t\tif(process instanceof Process) {\r\n\t\t\targs = [].slice.call(process.errors) ;\r\n\t\t\terror = args.shift();\r\n\t\t\targs.push(action);\r\n\t\t} else {\r\n\t\t\terror = process;\r\n\t\t\targs = [action];\r\n\t\t}\r\n\r\n\t\terrorHandler.handle(error, this, args);\r\n\r\n\t\t//BaseRouter.prototype.handleError(error, action);\r\n\t},\r\n\tstartPage(page, ...args){\r\n\t\treturn this.beforePageStart(page)\r\n\t\t\t.then(() => page.start(...args))\r\n\t\t\t.then(() => this.afterPageStart(page, ...args));\r\n\t},\r\n\tbeforePageStart(){\r\n\t\tif (this.previousPage && this.previousPage.isStarted())\r\n\t\t\treturn this.previousPage.stop();\r\n\t\telse\r\n\t\t\treturn Promise.resolve();\r\n\t},\r\n\tafterPageStart(page){\r\n\t\tthis.previousPage = page;\r\n\t},\r\n\trestartLastAttempt(){\r\n\t\tif(this.lastAttempt)\r\n\t\t\treturn this.lastAttempt.restart();\r\n\t}\r\n});\r\n","import Process from '../../../components/process';\r\n\r\n\r\nconst defaultStartableOptions  = {\r\n\tconcurrent: false,\r\n\r\n\t//good place to supply own state collecting logic\r\n\tstoreState(){\r\n\r\n\t\tthis.contextState = [{\r\n\t\t\tkey: 'startable.status',\r\n\t\t\tvalue: this.context['startable.status']\r\n\t\t}];\r\n\r\n\r\n\t\t/*\r\n\r\n\t\tfor example: take all simple values from context\r\n\r\n\t\tfor(var key in this.context){\r\n\t\t\tlet value = this.context[key];\r\n\t\t\tif (value == null || !_.isObject(value.valueOf()))\r\n\t\t\t\tthis.contextState.push({ key, value });\r\n\t\t}\r\n\r\n\t\t*/\r\n\r\n\t},\r\n\trestoreState(){\r\n\t\t_(this.contextState || []).each(keyValue => {\r\n\t\t\tthis.context[keyValue.key] = keyValue.value;\r\n\t\t});\r\n\t},\r\n\tonBefore(...args){\r\n\t\tthis.storeState();\r\n\t\tthis.ensureState();\r\n\t\tthis.context['startable.status'] = this.processingName;\r\n\t\tthis.context['startable.start.lastArguments'] = args;\r\n\t},\r\n\tonComplete(){\r\n\t\tthis.context['startable.status'] = this.processedName;\r\n\t},\t\r\n\tonError(){\r\n\t\tthis.restoreState();\r\n\t},\r\n\tensureState(shouldThrow = true){\r\n\t\tlet other = this.name == 'start' ? 'stop' : 'start';\r\n\t\tlet error = this.name == 'start' ? 'not:stopped' : 'not:started';\r\n\t\tlet status = this.context['startable.status'];\r\n\t\tswitch(status){\r\n\t\tcase 'stopping':\r\n\t\tcase 'starting':\r\n\t\t\tif(shouldThrow) throw new Error('not:iddle');\r\n\t\t\telse return 'not:iddle';\r\n\t\tcase 'iddle':\r\n\t\t\tif(this.name == 'start') return;\r\n\t\t\telse if(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\r\n\t\tcase other:\r\n\t\t\tif(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\t\t\t\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst defaultStartOptions  = {\r\n\tprocessingName: 'starting',\r\n\tprocessedName: 'started'\r\n};\r\nconst defaultStopOptions  = {\r\n\tprocessingName: 'stopping',\r\n\tprocessedName: 'stopped'\r\n};\r\n\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeStartable();\r\n\r\n\t},\r\n\t'startable.status': 'iddle',\r\n\t_initializeStartable(){\r\n\r\n\t\tlet startable = _.extend({}, defaultStartableOptions, this.getOption('startableOptions', {args:[this]}));\r\n\r\n\t\tlet start = _.extend({}, startable, defaultStartOptions, this.getOption('startOptions', {args:[this]}));\r\n\t\tlet stop = _.extend({}, startable, defaultStopOptions, this.getOption('stopOptions', {args:[this]}));\r\n\r\n\t\tProcess.register(this, 'start', start);\r\n\t\tProcess.register(this, 'stop', stop);\r\n\r\n\t},\r\n\tisStarted(){\r\n\t\treturn this['startable.status'] === 'started';\r\n\t},\r\n\tisStopped(){\r\n\t\treturn this['startable.status'] === 'stopped' || this['startable.status'] === 'iddle';\r\n\t},\r\n\tisNotIddle(){\r\n\t\treturn this['startable.status'] === 'stopping' || this['startable.status'] === 'starting';\r\n\t},\r\n\trestart(){\r\n\t\tif(this.isNotIddle())\r\n\t\t\tthrow new Error('Restart not allowed while startable instance is not iddle: ', this['startable.status']);\r\n\t\tlet stop = this.isStarted() ? this.stop() : Promise.resolve();\r\n\t\tlet args = this['startable.start.lastArguments'] || [];\r\n\t\treturn stop.then(() => this.start(...args));\r\n\t}\r\n}, {\r\n\tStartable: true\r\n});\r\n","//import isKnownCtor from '../../../utils/is-known-ctor';\r\nimport { isKnownCtor } from '../../../utils/index.js';\r\nexport default Base => Base.extend({\r\n\r\n\tconstructor(opts){\r\n\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeChildrenable(opts);\r\n\r\n\t},\r\n\t_initializeChildrenable(opts){\r\n\t\tthis.mergeOptions(opts, ['parent', 'root']);\r\n\t\tif (this.parent == null && this.root == null) \r\n\t\t\tthis.root = this;\r\n\t},\r\n\r\n\t//call this method manualy for initialize children\r\n\tinitializeChildren(){\r\n\t\tif (this._childrenInitialized) return;\r\n\r\n\t\tlet children = this.getOption('children');\r\n\t\tthis._children = [];\r\n\t\t_(children).each(child => this._initializeChild(child));\r\n\r\n\t\tthis._childrenInitialized = true;\r\n\r\n\t},\r\n\r\n\t_initializeChild(arg){\r\n\t\tlet Child;\r\n\t\tlet options = {};\r\n\r\n\t\tif (isKnownCtor(arg))\r\n\t\t\tChild = arg;\r\n\t\telse if(_.isFunction(arg)){\r\n\t\t\t\r\n\t\t\tlet invoked = arg.call(this, this);\r\n\t\t\treturn this._initializeChild(invoked);\r\n\r\n\t\t} else if (_.isObject(arg)) {\r\n\t\t\tChild = arg.Child;\r\n\t\t\t_.extend(options, _.omit(arg, 'Child'));\r\n\t\t}\r\n\r\n\t\t//if (!isKnownCtor(arg)) return;\r\n\r\n\t\t_.extend(options, this.getOption('childOptions'), { parent: this });\r\n\t\toptions = this.buildChildOptions(options);\r\n\t\t\r\n\t\tlet child = this.buildChild(Child, options);\r\n\t\tthis._children.push(child);\r\n\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\treturn options;\r\n\t},\r\n\tbuildChild(Child, options){\r\n\t\t!Child && (Child = this.getOption('defaultChildClass') || this.prototype.constructor);\r\n\t\treturn new Child(options);\r\n\t},\r\n\t_getChildren(items, opts = {}){\r\n\t\tlet { exclude, filter, map } = opts;\r\n\r\n\t\tif(exclude != null && !_.isArray(exclude))\r\n\t\t\topts.exclude = [exclude];\r\n\r\n\t\tif(!_.isFunction(filter))\r\n\t\t\tdelete opts.filter;\r\n\r\n\t\tlet result = [];\r\n\t\t_(items).each((item, index) => {\r\n\r\n\t\t\tif(!this._childFilter(item, index, opts))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(_.isFunction(map))\r\n\t\t\t\titem = map(item);\r\n\r\n\t\t\titem && result.push(item);\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\t_childFilter(item, index, opts = {}){\r\n\t\t\r\n\t\tif(opts.force) return item;\r\n\r\n\t\tlet { exclude, filter } = opts;\r\n\r\n\t\tif(_.isFunction(this.childFilter) && !this.childFilter(item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isArray(exclude) && exclude.indexOf(item) >= 0)\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isFunction(filter) && !filter.call(this, item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\tchildFilter: false,\r\n\tgetChildren(opts = {}){\r\n\t\tlet children = [].slice.call(this._children || []);\r\n\t\topts.reverse && children.length > 1 && children.reverse();\t\t\r\n\t\treturn this._getChildren(children, opts);\r\n\t},\r\n\tgetAllChildren(opts = {}){\r\n\r\n\t\tlet { includeSelf, map, reverse } = opts;\r\n\t\tlet options = _.omit(opts, 'includeSelf', 'map');\r\n\r\n\r\n\t\tlet children = this.getChildren(options);\r\n\t\tlet result = _(children).chain()\r\n\t\t\t.map(child => {\r\n\t\t\t\tlet children = child.getAllChildren(options);\r\n\t\t\t\treturn reverse ? [children, child] : [child, children];\r\n\t\t\t})\r\n\t\t\t.flatten()\r\n\t\t\t.value();\r\n\r\n\t\tif (includeSelf) {\r\n\t\t\tlet method = reverse ? 'push' : 'unshift';\r\n\t\t\tresult[method](this);\r\n\t\t}\r\n\t\t\r\n\t\tif (_.isFunction(map)) {\r\n\t\t\treturn _(result).chain().map(map).filter(f => !!f).value();\r\n\t\t} else {\t\t\t\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetParent(){\r\n\t\treturn this.parent;\r\n\t}\r\n\r\n\r\n\r\n});\r\n","import BaseRouter from './router';\r\nimport comparator from '../../../utils/comparator';\r\n\r\nexport default {\r\n\tinitializeRoutes(){\r\n\t\tif (this.initializeRouter()) {\r\n\t\t\tthis._buildRoutesContexts();\r\n\r\n\t\t}\r\n\t},\r\n\tinitializeRouter(){\t\t\r\n\t\tif(this.getOption('shouldCreateRouter') && !this.router) {\r\n\t\t\tthis.router = this._createRouter();\r\n\t\t\tthis._shouldRegisterAllRoutes = true;\r\n\t\t}\r\n\r\n\t\treturn !!this.router;\r\n\t},\r\n\t_createRouter(){\r\n\t\tlet Router = this.getOption('Router') || BaseRouter;\r\n\t\tlet options = _.extend({}, this.getOption('routerOptions'));\r\n\t\treturn new Router(options);\r\n\t},\r\n\tregisterAllRoutes(){\r\n\t\tif(!this._shouldRegisterAllRoutes) return;\r\n\r\n\t\tlet pages = this.getAllChildren({ reverse: true, includeSelf: true, force: true });\r\n\t\t\r\n\t\tlet router = this.router;\r\n\t\t_(pages).each(page => router.registerPageRoutes(page));\r\n\t\t\r\n\t},\r\n\t_buildRoutesContexts(){\r\n\t\tlet routes = this.getOption('routes', {args: [this]});\r\n\t\tif (routes == null) return;\r\n\t\tif(_.isString(routes))\r\n\t\t\troutes = [routes];\r\n\r\n\t\tlet result = [];\r\n\t\tlet config = this.getRoutesConfig();\r\n\t\t_(routes).each((route, index) => {\r\n\t\t\tlet context = this._normalizeRoutesContextRoute(route, index, config);\r\n\t\t\t_.isObject(context) && (result.push(context));\r\n\t\t});\r\n\t\tthis.routesContext = result;\r\n\t\treturn this.routesContext;\r\n\t},\r\n\t_normalizeRoutesContextRoute(arg, index, config = {}){\r\n\t\tif(arguments.length < 2){\r\n\t\t\tconfig = this.getRoutesConfig();\r\n\t\t}\r\n\t\tlet context = { page: this };\r\n\t\tif(arg == null)\r\n\t\t\treturn;\r\n\t\tif (_.isString(arg)) {\r\n\t\t\t_.extend(context, {route: arg, rawRoute: arg });\r\n\t\t} else if(_.isFunction(arg)) {\r\n\t\t\targ = arg.call(this, this, index);\r\n\t\t\treturn this._normalizeRoutesContextRoute(arg, index);\r\n\t\t} else {\r\n\t\t\t_.extend(context, arg);\r\n\t\t}\r\n\t\tlet name = (_.isString(index) && index) || context.name || context.route || _.uniqueId('route');\r\n\t\tcontext.name = name;\r\n\r\n\t\tif(_.isNumber(index) && context.order == null)\r\n\t\t\tcontext.order = index;\r\n\r\n\t\tif (!context.rawRoute)\r\n\t\t\tcontext.rawRoute = context.route;\r\n\t\t\t\t\r\n\t\tif(config.relative && config.parentContext && config.parentContext.route)\r\n\t\t\tcontext.route = config.parentContext.route + '/' + context.route;\r\n\r\n\t\treturn context;\r\n\t},\r\n\tgetRoutesConfig(){\r\n\t\tlet config = _.extend({ \r\n\t\t\trelative: this.getOption('relativeRoutes', {args: [this]}),\r\n\t\t\tparent: this.parent,\r\n\t\t\tparentContext: this.parent && _.isFunction(this.parent.getMainRouteContext) && this.parent.getMainRouteContext()\r\n\t\t}, this.getOption('routesConfig', {args: [this]}));\r\n\t\t\r\n\t\treturn config;\r\n\t},\r\n\tgetRoutesContexts(opts = {}){\r\n\t\tlet { clone, reverse } = opts;\r\n\t\tlet result = this.routesContext || [];\r\n\t\tif (clone || reverse) result = [].slice.call(result);\r\n\t\tif (reverse) result.reverse();\r\n\t\treturn result;\r\n\t},\r\n\r\n\tgetMainRouteContext(){\r\n\r\n\t\tif(this.mainRouteContext) return this.mainRouteContext;\r\n\t\tthis.mainRouteContext = _(this.getRoutesContexts())\r\n\t\t\t.chain()\r\n\t\t\t.sortBy((a,b) => comparator([ [b,a, c => c.main], [a,b, c => c.order] ]))\r\n\t\t\t.take(1)\r\n\t\t\t.value()[0];\r\n\r\n\t\treturn this.mainRouteContext;\r\n\t}\r\n};\r\n","import { MnObject } from '../../../vendors/marionette';\r\nimport mix from '../../../utils/mix';\r\nimport GetOptionMixin from '../../../mixins/common/get-option';\r\nimport StartableMixin from '../../../mixins/common/startable';\r\nimport ChildrenableMixin from '../../../mixins/common/childrenable';\r\nimport RoutesMixin from './routes-mixin';\r\n\r\nconst BasePage = mix(MnObject).with(GetOptionMixin, ChildrenableMixin, StartableMixin, RoutesMixin);\r\n\r\nexport default BasePage.extend({\r\n\tconstructor(opts = {}){\r\n\t\tBasePage.apply(this, arguments);\r\n\r\n\t\tthis.mergeOptions(opts, ['root','parent','router','canNotStart','onStart','onBeginStart', 'onBeforeStart', 'onEndStart', 'onStop', 'onBeginStop', 'onBeforeStop', 'onEndStop']);\r\n\t\t\r\n\t\t// resides in routes-mixin\r\n\t\tthis.initializeRoutes();\r\n\r\n\t\t// resides in ChildrenableMixin\r\n\t\tthis.initializeChildren();\r\n\t\t\r\n\t\t// resides in routes-mixin\r\n\t\tthis.registerAllRoutes();\r\n\t},\r\n\r\n\tgetLabel(){\r\n\t\tlet result = this.getOption('label', { args: [this, this.model]});\r\n\t\treturn result;\r\n\t},\r\n\tgetMenuLabel(){\r\n\t\tlet result = this.getOption('menuLabel', { args: [this, this.model], default: this.getLabel()});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\treturn _.extend({\r\n\t\t\troot: this.root,\r\n\t\t\tparent: this.parent,\r\n\t\t\trouter: this.router,\r\n\t\t}, options);\r\n\t},\r\n\r\n\tgetSiblings(opts = {}){\r\n\t\tlet parent = this.getParent();\r\n\t\tlet options = _.extend({ exclude: [this] }, opts);\r\n\t\treturn parent && parent.getChildren(options) || [];\r\n\t\t// if(_.isFunction(opts.map))\r\n\t\t// \treturn _(pages).chain().map(opts.map).filter(f => !!f).value();\r\n\t\t// else\r\n\t\t// \treturn pages;\r\n\t},\r\n\tgetChildrenHashes(){\r\n\t\treturn this.getChildren({ map: i => i.getHash(), visible: true, });\r\n\t},\r\n\tgetSiblingsHashes(){\r\n\t\treturn this.getSiblings({ map: i => i.getHash(), visible: true, });\r\n\t},\r\n\r\n\tgetAllPages(opts = {}){\r\n\t\t\r\n\t\tlet options = _.extend({}, opts, { includeSelf: true });\r\n\t\tdelete options.map;\r\n\t\tlet pages = this.root.getAllChildren(options);\r\n\r\n\t\tif (_.isFunction(opts.map)) {\r\n\t\t\treturn _(pages).chain().map(opts.map).filter(f => !!f).value();\r\n\t\t} else {\r\n\t\t\treturn pages;\r\n\t\t}\r\n\t},\r\n\tgetAllHashes(opts = {}){\r\n\t\tlet options = _.extend({ map: i => i.getHash(), visible: true, }, opts);\r\n\t\treturn this.getAllPages(options);\r\n\t},\r\n\tgetHash(){\r\n\t\tlet context = this.getMainRouteContext();\r\n\r\n\t\tif(!_.isObject(context))\r\n\t\t\treturn;\r\n\r\n\t\tlet parent = this.getParent();\r\n\t\tlet parentCid = parent && parent.cid || undefined;\t\t\r\n\t\treturn {\r\n\t\t\tcid: this.cid,\r\n\t\t\tparentCid,\r\n\t\t\turl: context.route,\r\n\t\t\tlabel: this.getMenuLabel(),\r\n\t\t\torder: this.order,\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t_childFilter(item, index, opts = {}) {\r\n\r\n\t\tif(!BasePage.prototype._childFilter.apply(this, arguments))\r\n\t\t\treturn;\r\n\r\n\t\tlet { visible } = opts;\r\n\r\n\t\tif(visible && (item.visible === false || item.hidden === true))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n});\r\n\r\n","import { history } from '../../../vendors/backbone.js';\r\nimport errorHandler from '../route-error-handler/index.js';\r\n\r\n// supports passing options to the callback\r\n// by using new version of loadUrl\r\nexport function historyNavigate(fragment, opts){\r\n\t\r\n\tlet options = opts === true ? { trigger: true }\r\n\t\t: _.isObject(opts) ? _.clone(opts)\r\n\t\t\t: {};\r\n\r\n\tlet { trigger } = options;\t\r\n\tdelete options.trigger;\r\n\r\n\thistory.navigate(fragment, options);\r\n\r\n\tif (trigger) {\r\n\t\treturn historyLoadUrl(fragment, opts);\r\n\t}\r\n\r\n}\r\n\r\n// original loadUrl does not pass options to the callback\r\n// and this one does\r\nexport function historyLoadUrl(fragment, opts = {}) {\r\n\r\n\t// If the root doesn't match, no routes can match either.\r\n\tif (!history.matchRoot()) return false;\r\n\tfragment = history.fragment = history.getFragment(fragment);\r\n\tlet executed = executeHandler(fragment, opts);\r\n\tif (!executed) {\r\n\t\terrorHandler.handle('not:found', opts.context, [fragment]);\r\n\t\t//history.trigger('handler:not:found', fragment, opts);\r\n\t}\r\n\treturn executed;\r\n}\r\n\r\n//TODO: think about constraints check\r\nfunction testHandler(handler, fragment){\r\n\treturn handler.route.test(fragment);\r\n}\r\n\r\nexport function findHandler(fragment, customTest){\r\n\tlet test = _.isFunction(customTest) ? customTest : testHandler;\r\n\tfragment = history.getFragment(fragment);\r\n\treturn _.filter(history.handlers || [], handler => test(handler, fragment))[0];\r\n}\r\n\r\nexport function executeHandler(fragment, opts = {}, resultContext = {}) {\r\n\tlet handler = findHandler(fragment, opts.testHandler);\r\n\thandler && (resultContext.value = handler.callback(fragment, opts));\r\n\treturn !!handler;\r\n}\r\n\r\nexport function start(options){\r\n\r\n\tif(history.loadUrl !== historyLoadUrl)\r\n\t\thistory.loadUrl = historyLoadUrl;\r\n\r\n\treturn history.start(options);\r\n}\r\n\r\nexport {\r\n\thistory\r\n};\r\n","import { history, historyNavigate }  from '../history/index.js';\r\nimport { Events } from '../../../vendors/backbone.js';\r\n\r\n\r\nexport default _.extend({\r\n\twatch(){\r\n\t\tthis.entries = [];\r\n\t\tthis.listenTo(history, 'route', this.onRoute);\r\n\t\tthis.listenTo(history, 'backroute', this.onBackRoute);\r\n\t},\r\n\tisActionContext: cntx => _.isObject(cntx) && _.isString(cntx.fragment),\r\n\thasElements(){\r\n\t\treturn this.entries.length > 0;\r\n\t},\r\n\tonRoute(actionContext){\r\n\r\n\t\tif(!this.isActionContext(actionContext))\r\n\t\t\treturn;\r\n\r\n\t\tif (this.isActionContext(this.lastElement)) {\r\n\t\t\tthis.entries.push(this.lastElement);\r\n\t\t}\r\n\t\tthis.lastElement = actionContext;\r\n\r\n\t},\r\n\tonBackRoute(actionContext){\r\n\t\tif(!this.isActionContext(actionContext) || !this.isActionContext(actionContext.gobackContext))\r\n\t\t\treturn;\r\n\r\n\t\tlet lookFor = actionContext.gobackContext;\r\n\t\tlet index = this.entries.indexOf(lookFor);\r\n\t\tif (index >= 0) {\r\n\t\t\tthis.entries = this.entries.slice(0, index);\r\n\t\t\tthis.lastElement = lookFor;\r\n\t\t}\r\n\r\n\t},\r\n\tgoBack(){\r\n\t\tlet last = this.hasElements() && _(this.entries).last();\r\n\t\thistoryNavigate(last.fragment, { trigger: true, routeType: 'backroute', gobackContext: last });\r\n\t},\r\n}, Events);\r\n","import { historyNavigate, executeHandler } from '../history';\r\n\r\nfunction normalizeOptions(type = 'route', opts = {}){\r\n\tif(_.isObject(type)) {\r\n\t\topts = type;\r\n\t\ttype = 'route';\r\n\t} \r\n\treturn _.extend({ routeType: type, trigger: true }, opts);\r\n}\r\n\r\nexport function execute(url, opts){\r\n\treturn go(url, 'execute', opts);\r\n}\r\nexport function navigate(url, opts){\r\n\treturn go(url, 'route', opts);\r\n}\r\nexport function navigateBack(url, opts){\r\n\treturn go(url, 'backroute', opts);\r\n}\r\n\r\nexport function go(url, type, opts)\r\n{\r\n\tlet options = normalizeOptions(type, opts);\r\n\tswitch(options.routeType){\r\n\tdefault:\r\n\tcase 'route':\r\n\tcase 'backroute':\r\n\t\treturn historyNavigate(url, options);\r\n\tcase 'execute':\r\n\t\treturn executeHandler(url, options);\r\n\t}\r\n\r\n}\r\n","import { Model, ajax as _nativeAjax } from '../../vendors/backbone';\r\nimport Backbone from 'backbone';\r\n\r\n// import Model from '../../b b/model';\r\n\r\nlet nativeAjax = _nativeAjax;\r\n\r\nconst tokenizedAjax = function(...args){\r\n\tlet options;\r\n\r\n\tif(args && args.length == 1 && _.isObject(args[0])){\r\n\t\toptions = args[0];\r\n\t}\r\n\tif(args && args.length == 2 && !_.isObject(args[0]) && _.isObject(args[1])){\r\n\t\toptions = args[1];\r\n\t}\r\n\r\n\toptions && (options.headers = _.extend({}, options.headers, this.getAjaxHeaders()));\r\n\r\n\treturn nativeAjax.apply($, args);\r\n};\r\n\r\n\r\nconst Token = Model.extend({\r\n\r\n\ttokenAttribute: 'access_token',\r\n\trefreshTokenAttribute: 'refresh_token',\r\n\tendPoint: 'auth/token',\r\n\tsecondsOffset: 0,\r\n\r\n\tshouldRequestOnInitialize: true,\r\n\r\n\tconstructor(){\r\n\t\tthis.ajaxHeaders = {};\r\n\t\tthis.flows = {};\r\n\t\tthis.initializeFlows();\r\n\t\tthis.setExpiration(null);\r\n\r\n\t\tModel.apply(this, arguments);\r\n\r\n\t\tif (this.shouldRequestOnInitialize) {\r\n\t\t\tthis.getReady();\r\n\t\t}\r\n\t},\r\n\r\n\tgetReady(){\r\n\t\tif(this.ready) return this.ready;\r\n\t\t\r\n\t\tif (!this.hasToken()) {\r\n\t\t\tthis.ready = Promise.resolve();\r\n\t\t} else {\r\n\t\t\tthis.ready = this.refresh({force: true}).catch(() => {\r\n\t\t\t\tthis.update(null);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.ready;\r\n\t},\r\n\t\r\n\r\n\tinitializeFlows(){\r\n\r\n\t\tthis.setFlow('password', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\t\tthis.setFlow('refresh', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\r\n\t},\r\n\tgetFlow(key){\r\n\t\treturn _.clone(this.flows[key] || {});\r\n\t},\r\n\tsetFlow(key, value){\r\n\t\tthis.flows[key] = value;\r\n\t},\r\n\r\n\r\n\r\n\thasToken(){\r\n\t\treturn this.getToken() != null;\r\n\t},\r\n\tgetToken(){\r\n\t\treturn this.get(this.tokenAttribute);\r\n\t},\r\n\r\n\tgetRefreshToken(){\r\n\t\treturn this.get(this.refreshTokenAttribute);\r\n\t},\r\n\r\n\tgetAjaxHeaders(){\t\t\r\n\t\treturn this.ajaxHeaders;\r\n\t},\t\r\n\r\n\tparse(data){\r\n\t\treturn data;\r\n\t},\r\n\r\n\tfetch(options = {}){\r\n\t\tif(this._fetching) return this._fetching;\t\t\r\n\t\tthis._fetching = nativeAjax(options).then(\r\n\t\t\t(json) => {\r\n\r\n\t\t\t\tlet parsed = this.parse(_.clone(json));\r\n\t\t\t\tthis.update(parsed);\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\treturn Promise.resolve(json);\r\n\t\t\t}, \r\n\t\t\t(xhr) => {\r\n\t\t\t\t\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\t\r\n\t\t\t\toptions.clearOnFail !== false \r\n\t\t\t\t\t&& this.update(null);\r\n\r\n\t\t\t\tlet error = this.handleError(xhr);\r\n\t\t\t\tif(error){\r\n\r\n\t\t\t\t\treturn Promise.reject(error);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(xhr);\r\n\t\t\t\t}\r\n\t\t\t});\t\r\n\t\treturn this._fetching;\r\n\t},\r\n\thandleError(){},\r\n\tupdate(hash, opts = {}){\r\n\t\tlet { silent } = opts;\r\n\t\tif (hash == null) {\r\n\r\n\t\t\tthis.clear(opts);\r\n\r\n\t\t} else {\r\n\t\t\tlet fullhash = _.extend({}, this.attributes, hash);\r\n\t\t\tlet unset = [];\r\n\t\t\tlet shouldUnset = !!opts.unset;\r\n\t\t\tlet setHash = _(fullhash).reduce((memo, value, key) => {\r\n\t\t\t\tif (key in hash) {\r\n\t\t\t\t\tmemo[key] = value;\r\n\t\t\t\t} else if (shouldUnset) {\r\n\t\t\t\t\tunset.push(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmemo[key] = undefined;\r\n\t\t\t\t}\r\n\t\t\t\treturn memo;\r\n\t\t\t}, {});\r\n\r\n\t\t\tsetHash = this.parse(setHash);\r\n\t\t\tthis.set(setHash, { silent });\r\n\t\t\t_(unset).each(key => this.unset(key, { silent }));\r\n\t\t}\r\n\r\n\t\tthis.reflectTokenChanges();\r\n\r\n\t},\r\n\r\n\treplaceBackboneAjax(){\t\t\r\n\t\tif(!this.hasToken())\r\n\t\t\tBackbone.ajax = nativeAjax;\r\n\t\telse\r\n\t\t\tBackbone.ajax = (...args) => this.ajax(...args);\r\n\t},\r\n\tupdateAjaxHeaders(token){\r\n\t\ttoken || (token = this.getToken());\r\n\t\tlet headers = this.getAjaxHeaders();\r\n\t\tif (token) {\r\n\t\t\theaders.Authorization = 'Bearer ' + token;\r\n\t\t\theaders.Accept = 'application/json';\r\n\t\t} else {\r\n\t\t\tdelete headers.Authorization;\r\n\t\t}\r\n\t},\r\n\r\n\t//implement by your own\r\n\tstoreToken(){},\r\n\r\n\treflectTokenChanges(opts = {}){\r\n\t\tlet { silent, store = true } = opts;\r\n\t\tthis.updateAjaxHeaders();\r\n\t\tthis.replaceBackboneAjax();\r\n\t\tif (store)\r\n\t\t\tthis.storeToken();\r\n\t\tif (!silent)\r\n\t\t\tthis.trigger('changed');\r\n\t},\r\n\r\n\tajax(...args){\r\n\t\treturn this.refresh().then(\r\n\t\t\t() => tokenizedAjax.apply(this, args),\r\n\t\t\terror => Promise.reject(error)\r\n\t\t);\r\n\t},\t\r\n\trefresh(opts = {}){\t\t\r\n\r\n\t\t// if token is fresh enough and there is no force refresh\r\n\t\t// pass\r\n\t\tif (!this.isExpired() && !opts.force) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\tlet options = this.getFlow('refresh');\r\n\t\toptions.data = this.getRefreshTokenData();\r\n\t\treturn this.fetch(options);\r\n\t},\r\n\tgetRefreshTokenData(){\r\n\t\treturn {\r\n\t\t\t'grant_type':'refresh_token',\r\n\t\t\t'refresh_token': this.getRefreshToken(),\r\n\t\t};\r\n\t},\r\n\r\n\tsetExpiration(arg){\r\n\r\n\t\tif (arg === null) {\r\n\t\t\tthis.expiresAt = null;\r\n\t\t}\r\n\r\n\t\tlet date;\r\n\t\tlet now = new Date();\r\n\r\n\t\tif (_.isDate(arg)) {\r\n\t\t\tdate = arg;\r\n\t\t} else if(_.isObject(arg)) {\r\n\t\t\tdate = new Date();\r\n\t\t\t\r\n\t\t\tlet { seconds, minutes, hours, days } = arg;\r\n\t\t\tdate.setDate(date.getDate() + (days || 0));\r\n\t\t\tdate.setHours(date.getHours() + (hours || 0));\r\n\t\t\tdate.setMinutes(date.getMinutes() + (minutes || 0));\r\n\t\t\tdate.setSeconds(date.getSeconds() + (seconds || 0));\r\n\t\t}\r\n\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()) || date < now) {\r\n\t\t\tdate = new Date();\r\n\t\t\tdate.setSeconds(now.getSeconds() + 90);\r\n\t\t}\r\n\r\n\t\tthis.expiresAt = date;\r\n\t},\r\n\tgetExpiration(){\r\n\t\treturn this.expiresAt;\r\n\t},\r\n\tisExpired(){\r\n\t\tlet date = this.getExpiration();\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()))\r\n\t\t\treturn true;\r\n\t\treturn date.valueOf() < Date.now() + (this.secondsOffset * 1000);\r\n\t},\r\n\tlogin(username, password){\r\n\r\n\t\tlet options = this.getFlow('password');\r\n\t\toptions.data = { grant_type:'password', username, password };\r\n\t\toptions.clearOnFail = false;\r\n\t\treturn this.fetch(options);\r\n\r\n\t},\r\n\r\n});\r\n\r\nToken.setNativeAjax = function(arg){\r\n\tlet old = nativeAjax;\r\n\tnativeAjax = arg;\r\n\treturn old;\r\n};\r\n\r\nexport default Token;\r\n","import { triggerMethod, mergeOptions } from '../../utils/index.js';\r\nimport { instanceGetOption } from '../../utils/get-option/index.js';\r\n\r\n\r\nexport default {\r\n\tgetOption: instanceGetOption,\r\n\tmergeOptions: mergeOptions,\r\n\ttriggerMethod: triggerMethod,\r\n};\r\n","export default {\r\n\r\n\t//desc: setups the collection for ViewManager instance\r\n\t//returns: previous collection\r\n\tsetCollection(collection, { init = false} = {}){\r\n\t\t\r\n\t\tif (this.collection == collection) return;\r\n\r\n\t\t//take previous collection for return\r\n\t\tlet previousCollection = this.collection;\r\n\r\n\t\t//take contexts to destroy\r\n\t\tlet destroy = this._removeCollection() || [];\r\n\r\n\t\tthis.collection = collection;\r\n\r\n\t\tif (collection == null && destroy.length){\r\n\t\t\tthis.trigger('change', { destroy });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinit && this.initModels();\r\n\t\tthis._setCollectionListeners();\r\n\r\n\r\n\t\treturn previousCollection;\r\n\t},\r\n\t_clearCollectionStore(){\r\n\t\t\r\n\t\tlet store = this._store;\r\n\t\tstore.filtered.length = 0;\r\n\t\tstore.items.length = 0;\r\n\t\tstore.byModel = {};\r\n\t\tstore.isFiltered = false;\r\n\t\tstore.isSorted = false;\r\n\t},\r\n\t_removeCollection(){\r\n\t\tif (this.collection == null) return;\r\n\r\n\t\tlet previousCollection = this.collection;\r\n\r\n\t\tthis.stopListening(previousCollection);\r\n\r\n\t\tlet destroy = this._removeItems(previousCollection.models);\r\n\r\n\t\tdelete this.collection;\r\n\r\n\t\tthis._clearCollectionStore();\r\n\r\n\t\tdelete this._modelsInitialized;\r\n\r\n\t\treturn destroy;\r\n\r\n\t},\r\n\t_setCollectionListeners(){\r\n\t\tif(!this.collection) return;\r\n\t\tthis.listenTo(this.collection, 'update', this._onCollectionUpdate);\r\n\t\tthis.listenTo(this.collection, 'reset', this._onCollectionReset);\r\n\t\tthis.listenTo(this.collection, 'sort', this._onCollectionSort);\r\n\t\tif (this.collection.length === 0) {\r\n\t\t\tthis.listenToOnce(this.collection, 'sync', this._onCollectionFirstFetch);\r\n\t\t}\r\n\t},\r\n\r\n\t//first run, initialized all collection models\r\n\tinitModels(){\r\n\r\n\t\tif(!this.enableCollection || this._modelsInitialized) return;\r\n\r\n\t\tthis._rebuildModels();\r\n\r\n\t\tthis._modelsInitialized = true;\r\n\r\n\t},\r\n\r\n\t_rebuildModels({ sort = true} = {}){\r\n\r\n\t\tlet items = this._store.items;\r\n\t\tlet filtered = this._store.filtered;\r\n\t\titems.length = 0;\r\n\t\tfiltered.length = 0;\r\n\r\n\t\tlet filter = this.getFilter();\r\n\t\tlet models = this.collection.models;\r\n\r\n\t\tfor(let index = 0, length = models.length; index < length; index++) {\r\n\t\t\tlet model = models[index];\r\n\r\n\t\t\tlet context = this._getModelContext(model, { create: true });\r\n\t\t\tcontext.index = index;\r\n\r\n\t\t\tthis._storeContext(context);\r\n\t\t\titems.push(context);\r\n\r\n\t\t\tif(!filter || filter(context))\r\n\t\t\t\tfiltered.push(context);\r\n\r\n\t\t}\r\n\t\tthis._store.isFiltered = true;\r\n\r\n\t\tsort && this._sortItems(filtered, { comparator: this.getComparator(), force: true },'rebuild');\r\n\t\tthis._store.isSorted = sort;\r\n\r\n\t},\r\n\t_onCollectionUpdate(col, opts = {}){\r\n\r\n\t\tlet { changes = {} } = opts;\r\n\t\tlet { added = [], removed = [], merged = [] } = changes;\r\n\t\tlet destroy;\r\n\t\tif (removed.length) {\r\n\r\n\t\t\tdestroy = this._removeItems(removed);\r\n\t\t\tthis._rebuildModels();\r\n\r\n\t\t} else {\r\n\t\t\tif(added.length) {\t\t\t\t\r\n\t\t\t\tlet data = this._filterItems(added, { force: true });\r\n\t\t\t\tthis._addItems(data.attach, { isSorted: false });\t\t\r\n\t\t\t}\r\n\t\t\tif(merged.length){\r\n\t\t\t\tthis._store.isFiltered = false;\r\n\t\t\t}\r\n\t\t\tif((added.length || merged.length) && !_.isFunction(this.getComparator())){\r\n\t\t\t\tthis._updateIndexes();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.processAndRender({ destroy });\r\n\t},\r\n\r\n\t_addItems(items, {isSorted, isFiltered} = {}){\r\n\r\n\t\tif(!items || !items.length) return;\r\n\r\n\t\tisSorted != null && (this._store.isSorted = isSorted);\r\n\t\tisFiltered != null && (this._store.isFiltered = isFiltered);\r\n\r\n\t\tlet filter = this.getFilter();\r\n\r\n\t\tlet _items = this._store.items;\r\n\t\tlet _filtered = this._store.filtered;\r\n\r\n\t\tfor (let index = 0, length = items.length; index < length; index++) {\r\n\t\t\tlet item = items[index];\r\n\t\t\t_items.push(item);\r\n\t\t\tif(!filter || filter(item))\r\n\t\t\t\t_filtered.push(item);\r\n\t\t}\r\n\t\tthis._store.isFiltered = true;\r\n\r\n\t},\t\r\n\r\n\t_onCollectionFirstFetch(){\r\n\t\tif(this.collection.length) return;\r\n\t\tthis.processAndRender();\r\n\t},\r\n\r\n\t_onCollectionSort(col, { add, merge, remove } = {}){\r\n\r\n\t\tif (_.isFunction(this.getComparator())) return;\r\n\t\tif (add || remove || merge) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._updateIndexes();\r\n\r\n\t\tlet items = this._getItems();\r\n\t\tthis._sortItems(items, { comparator: this._dataComparator, force: true },'collectionsort');\r\n\t\tthis._store.isSorted = true;\r\n\t\tthis.processAndRender();\r\n\r\n\t},\r\n\r\n\t_onCollectionReset(col, { previousModels = []} = {}){\r\n\r\n\t\tlet destroy = this._removeItems(previousModels);\r\n\t\tthis._rebuildModels();\r\n\t\tthis.processAndRender({ destroy });\r\n\r\n\t},\r\n};\r\n","export default {\r\n\t_ensureOptions(){\r\n\t\tif(!this.view)\r\n\t\t\tthrow new Error('view is not set');\r\n\r\n\t\tif(!this.$container){\r\n\t\t\tthis.$container = this.view.$el;\r\n\t\t}\r\n\r\n\t},\r\n\tgetPaginator(){\r\n\t\tlet skip = this.skip || 0;\r\n\t\tlet take = this.take || Infinity;\r\n\t\t!_.isNumber(skip) || skip < 0 && (skip = 0);\r\n\t\t!_.isNumber(take) || take < 0 && (take = Infinity);\r\n\t\tif(skip == 0 && take == Infinity)\r\n\t\t\treturn;\r\n\t\telse\r\n\t\t\treturn {\r\n\t\t\t\tfrom: skip,\r\n\t\t\t\tto: skip + take\r\n\t\t\t};\r\n\t},\r\n\t_dataComparator(a, b){\r\n\t\treturn a.index - b.index;\r\n\t},\t\r\n\tgetComparator(){\r\n\t\treturn this.dataComparator;\r\n\t},\r\n\tsetComparator(comparator, {preventRender} = {}){\r\n\r\n\t\tif(this.dataComparator == comparator) return;\r\n\r\n\t\tthis.dataComparator = comparator;\r\n\t\tthis._store.isSorted = false;\r\n\r\n\t\tif(!preventRender)\r\n\t\t\tthis.processAndRender();\r\n\t},\r\n\tgetFilter(){\r\n\t\treturn this.dataFilter;\r\n\t},\r\n\tsetFilter(filter, {preventRender} = {}){\r\n\t\tif(this.dataFilter == filter) return;\r\n\r\n\t\tthis.dataFilter = filter;\r\n\t\tthis._store.isFiltered = false;\r\n\t\tif(!preventRender)\r\n\t\t\tthis.processAndRender();\r\n\t},\r\n};\r\n","import { isView, isViewClass } from '../../vendors/helpers';\r\nimport result from '../../utils/better-result';\r\n\r\nexport default {\r\n\r\n\tgetCustoms(){\r\n\t\treturn this._store.customs;\r\n\t},\r\n\taddCustomView(arg, index){\t\t\r\n\t\tlet customContext = this._normalizeAddCustomContext(arg, index);\r\n\t\tif (!customContext) { return; }\r\n\t\tthis._store.customs.push(customContext);\r\n\t\tif(isView(customContext.view) && !customContext.view._isDestroyed) {\r\n\t\t\tthis._setupJustCreatedView(customContext.view, customContext);\r\n\t\t}\r\n\t},\r\n\tremoveCustomViews(){\r\n\t\tlet customs = this.getCustoms() || [];\r\n\t\t_.each(customs, custom => {\r\n\t\t\tif(!custom.view) return;\r\n\t\t\t\r\n\t\t\tif(this._checkCustomCondition(custom.view, custom)) { return; }\r\n\r\n\t\t\tif (custom.rebuild)\r\n\t\t\t\tthis._destroyChildView(custom.view);\r\n\t\t\telse\r\n\t\t\t\tthis._detachChildView(custom.view);\r\n\t\t});\r\n\t},\r\n\r\n\t_checkCustomCondition(customView, custom){\r\n\t\t\r\n\t\tif (this.enableFilterForCustomViews) {\r\n\t\t\tlet filter = this.getFilter();\r\n\t\t\treturn !filter || filter(customView);\r\n\t\t}\r\n\r\n\t\tif (_.isFunction(custom.condition)) {\r\n\t\t\treturn custom.condition.call(this.view, customView, this.view);\r\n\t\t} else if(custom.condition != null){\r\n\t\t\treturn custom.condition;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t},\r\n\t_injectCustoms(items, detached, destroyed){\r\n\r\n\t\tif (this.collection && !items.length) {\r\n\t\t\titems = [];\r\n\t\t\tthis._injectEmptyView(items);\r\n\t\t}\r\n\r\n\t\tlet customs = this.getCustoms() || [];\r\n\r\n\t\tif(!customs.length)\r\n\t\t\treturn items;\r\n\r\n\t\tlet newitems = items.slice(0);\r\n\t\t_.each(customs, custom => {\r\n\r\n\t\t\tlet view = this._ensureContextHasView(custom);\r\n\t\t\tif(!view) return;\r\n\r\n\t\t\tif(!this._checkCustomCondition(view, custom)){\r\n\t\t\t\t// if (custom.rebuild) {\r\n\t\t\t\t// \tdestroyed.push(view);\r\n\t\t\t\t// } else {\r\n\t\t\t\t// }\r\n\t\t\t\tdetached.push(custom);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(custom.index == null){\r\n\t\t\t\tnewitems.push(custom);\r\n\t\t\t} else {\r\n\t\t\t\tnewitems.splice(custom.index, 0, custom);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn newitems;\r\n\t},\r\n\r\n\t_normalizeAddCustomContext(arg, index){\r\n\t\tif (isView(arg) && !arg._isDestroyed) {\r\n\t\t\treturn {\r\n\t\t\t\tview: arg,\r\n\t\t\t\trebuild: false,\r\n\t\t\t\tindex\r\n\t\t\t};\r\n\t\t} else if (_.isFunction(arg) && isViewClass(arg)){\r\n\t\t\treturn {\r\n\t\t\t\tbuild: () => new arg(),\r\n\t\t\t\tindex,\r\n\t\t\t\trebuild: true,\r\n\t\t\t};\r\n\t\t} else if(_.isFunction(arg)) {\r\n\t\t\treturn {\r\n\t\t\t\tbuild: arg,\r\n\t\t\t\tindex,\r\n\t\t\t\trebuild: true,\r\n\t\t\t};\r\n\t\t} else if (_.isObject(arg) && !isView(arg)) {\r\n\t\t\tif (arg.build == null && arg.view == null) { return; }\r\n\t\t\tif (index != null)\r\n\t\t\t\targ.index = index;\r\n\r\n\t\t\tif (_.isFunction(arg.view)) {\r\n\t\t\t\tlet viewFn = arg.view;\r\n\t\t\t\tdelete arg.view;\r\n\t\t\t\tlet options = arg.options;\r\n\t\t\t\tif(isViewClass(viewFn)){\r\n\t\t\t\t\targ.build = () => new viewFn(result({ options }, 'options', { context: this.view }));\r\n\t\t\t\t} else {\r\n\t\t\t\t\targ.build = () => viewFn.call(this.view, result({ options }, 'options', { context: this.view }));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (arg.rebuild == null) {\r\n\t\t\t\targ.rebuild = !isView(arg.view);\r\n\t\t\t}\r\n\t\t\treturn arg;\r\n\t\t}\r\n\t}\t\r\n};\r\n","export function isInPage(paginator, index){\r\n\treturn !paginator || (index >= paginator.from && index < paginator.to);\r\n}\r\n\r\nexport function viewIsGood(view){\r\n\treturn view && !view._isDestroyed;\r\n}\r\n\r\nexport function renderView(view) {\r\n\tif (view._isRendered) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (!view.supportsRenderLifecycle) {\r\n\t\tview.triggerMethod('before:render', view);\r\n\t}\r\n\r\n\tview.render();\r\n\tview._isRendered = true;\r\n\r\n\tif (!view.supportsRenderLifecycle) {\r\n\t\tview.triggerMethod('render', view);\r\n\t}\r\n}\r\n\r\nexport function destroyView(view, disableDetachEvents) {\r\n\tif (view.destroy) {\r\n\t\t// Attach flag for public destroy function internal check\r\n\t\tview._disableDetachEvents = disableDetachEvents;\r\n\t\tview.destroy();\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Destroy for non-Marionette Views\r\n\tif (!view.supportsDestroyLifecycle) {\r\n\t\tview.triggerMethod('before:destroy', view);\r\n\t}\r\n\r\n\tconst shouldTriggerDetach = view._isAttached && !disableDetachEvents;\r\n\r\n\tif (shouldTriggerDetach) {\r\n\t\tview.triggerMethod('before:detach', view);\r\n\t}\r\n\r\n\tview.remove();\r\n\r\n\tif (shouldTriggerDetach) {\r\n\t\tview._isAttached = false;\r\n\t\tview.triggerMethod('detach', view);\r\n\t}\r\n\r\n\tview._isDestroyed = true;\r\n\r\n\tif (!view.supportsDestroyLifecycle) {\r\n\t\tview.triggerMethod('destroy', view);\r\n\t}\r\n}\r\n","import { isInPage } from './utils.js';\r\n\r\n\r\nexport default {\r\n\r\n\r\n\tprocess({ destroy = [], silent, forceSort, forceFilter } = {}){\r\n\r\n\t\tthis._removeEmptyViewInstance({ destroy });\r\n\r\n\t\tlet items = this._getItems({ forceFilter });\r\n\r\n\r\n\r\n\t\tlet totalDetach = [];\r\n\r\n\t\tif (!this._store.isFiltered || forceFilter) {\r\n\t\t\tlet { attach, detach } = this._filterItems(items, { filter: this.getFilter() });\r\n\t\t\tthis._setItems(attach, { isFiltered: true });\r\n\t\t\titems = attach;\r\n\t\t\tif(detach.length) {\r\n\t\t\t\t//resultData.detach = resultData.detach.concat(detach);\r\n\t\t\t\ttotalDetach = totalDetach.concat(detach);\r\n\t\t\t}\r\n\t\t\t//resultDetach = detach;\r\n\t\t}\r\n\t\tthis._sortItems(items, { comparator: this.getComparator(), force: forceSort },'process');\r\n\t\tthis._store.isSorted = true;\r\n\r\n\r\n\r\n\t\tlet data = this._filterItems(items, { paginator: this.getPaginator() });\r\n\t\tif(data.detach.length) {\r\n\t\t\t//resultData.detach = resultData.detach.concat(data.detach);\r\n\t\t\ttotalDetach = totalDetach.concat(data.detach);\r\n\t\t}\r\n\r\n\r\n\t\tlet attach = this._injectCustoms(data.attach, totalDetach, destroy);\r\n\r\n\t\tlet result = {\r\n\t\t\tattach,\r\n\t\t\tdetach: totalDetach,\r\n\t\t\tdestroy,\r\n\t\t\ttotal: data.total,\r\n\t\t\tskiped: data.skiped,\r\n\t\t\ttaked: data.taked\r\n\t\t};\r\n\r\n\t\t\r\n\t\tthis.lastResult = result;\r\n\t\tif(!silent)\r\n\t\t\tsetTimeout(() => this.trigger('change', result), 0);\r\n\r\n\t\t\r\n\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\r\n\t_getItems({ forceFilter } = {}){\r\n\r\n\t\tif (this._store.isFiltered && !forceFilter)\r\n\t\t\treturn this._store.filtered;\r\n\t\telse\r\n\t\t\treturn this._store.items;\r\n\t},\r\n\r\n\t_filterItems(items, { filter, paginator, force } = {}){\r\n\r\n\t\tlet iterator = -1;\r\n\t\tlet detach = [];\r\n\t\tlet attach = [];\r\n\r\n\r\n\t\tif (!filter && !paginator && !force) {\r\n\t\t\t\r\n\t\t\treturn { attach: items, detach:[] };\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tlet shouldUpdateIndex = this.collection && items == this.collection.models;\r\n\t\t\r\n\t\t\r\n\t\tfor(let index = 0, length = items.length; index < length; index++){\r\n\r\n\t\t\tlet model = items[index];\r\n\t\t\tlet item = model;\r\n\t\t\tlet isModel = model instanceof Backbone.Model;\r\n\t\t\tlet isNew = false;\r\n\r\n\t\t\tif (isModel) {\r\n\t\t\t\titem = this._getModelContext(model, { create: true, markNew: true });\r\n\t\t\t\tisNew = item.isNew === true;\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tlet pass = !filter || filter(item);\r\n\t\t\tif (!pass) {\r\n\t\t\t\titem.view && !item.view._isDestroyed && detach.push(item);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(isInPage(paginator, ++iterator)) {\r\n\t\t\t\tattach.push(item);\r\n\r\n\t\t\t\tif(shouldUpdateIndex){\r\n\t\t\t\t\titem.index = index;\r\n\t\t\t\t}\r\n\t\t\t\tif (isNew) {\r\n\t\t\t\t\tthis._storeContext(item);\r\n\t\t\t\t}\r\n\t\t\t} else if (paginator && iterator > paginator.to){\r\n\t\t\t\tbreak;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n\t\t\r\n\t\tlet res = { attach , detach };\r\n\t\tif(paginator){\r\n\t\t\tres.total = items.length;\r\n\t\t\tres.skiped = paginator.from;\r\n\t\t\tres.taked = iterator - paginator.from - 1;\r\n\t\t}\r\n\r\n\t\t// resultData.attach = attach;\r\n\t\t// resultData.detach = detach;\r\n\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_sortItems(items, { comparator, force } = {}){\r\n\r\n\t\tif(this._store.isSorted && !force) { return; }\r\n\r\n\t\tif(!comparator) {\r\n\t\t\tcomparator = this._dataComparator;\r\n\t\t\tif(!comparator) return;\r\n\t\t}\r\n\r\n\t\tif (this._store.isFiltered && items !== this._store.items) {\r\n\t\t\tsetTimeout(() => this._sortItems(this._store.items, { comparator, force: true },'timeout sort'),0);\r\n\t\t}\r\n\r\n\t\t\r\n\t\tlet iteratee = comparator.length == 1 \r\n\t\t\t? (a,b) => {\r\n\t\t\t\tlet _a = comparator(a); let _b = comparator(b);\r\n\t\t\t\tif(_a < _b) return -1;\r\n\t\t\t\tif(_a > _b) return 1;\r\n\t\t\t\treturn 0;\t\t\t\t\r\n\t\t\t}\r\n\t\t\t: comparator;\r\n\r\n\t\titems.sort(iteratee);\r\n\t\t\r\n\t},\r\n\r\n\r\n\t_setItems(items, { isSorted, isFiltered } = {}){\r\n\r\n\t\tisSorted != null && (this._store.isSorted = isSorted);\r\n\t\tisFiltered != null && (this._store.isFiltered = isFiltered);\r\n\t\tif (isFiltered) {\r\n\t\t\tthis._store.filtered = items;\r\n\t\t} else {\r\n\t\t\tthis._store.items = items;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_removeItems(items = []){\r\n\r\n\t\tlet destroy = [];\r\n\t\tfor (let index = 0, length = items.length; index < length; index++) {\r\n\t\t\tlet item = items[index];\r\n\t\t\tlet view = this._removeItem(item);\r\n\t\t\tview && destroy.push(view);\r\n\t\t}\r\n\t\treturn destroy;\r\n\t},\r\n\r\n\t_removeItem(item){\r\n\t\tlet model = item instanceof Backbone.Model ? item : item.model;\r\n\t\tlet context = this._store.byModel[model.id] || this._store.byModel[model.cid];\r\n\t\tdelete this._store.byModel[model.id];\r\n\t\tdelete this._store.byModel[model.cid];\r\n\t\treturn context.view;\r\n\t},\r\n\r\n\t_getModelView(model){\r\n\t\tlet id = model.id == null ? model.cid : model.id;\r\n\t\tlet context = this._store.byModel[id];\r\n\t\treturn context && context.view;\r\n\t},\r\n\r\n\t_getModelContext(model, { create, markNew } = {}){\r\n\t\tlet id = model.id == null ? model.cid : model.id;\r\n\t\tlet context = this._store.byModel[id];\r\n\t\tif (context) { return context; }\r\n\t\tif (create) {\r\n\t\t\tcontext = { model, isCollection: true };\r\n\t\t\tmarkNew && (context.isNew = true);\r\n\t\t\treturn context;\r\n\t\t}\r\n\t},\r\n\r\n\t_storeContext(context){\r\n\t\tlet id = context.model.id;\r\n\t\tcontext.isNew && (delete context.isNew);\r\n\t\tif(id != null)\r\n\t\t\tthis._store.byModel[id] = context;\r\n\t\tthis._store.byModel[context.model.cid] = context;\r\n\t},\r\n\r\n\t_initView(context){\r\n\t\tif(context.view && !context.view._isDestroyed)\r\n\t\t\treturn;\r\n\t\tcontext.view = this.createView(context.model);\r\n\t},\r\n\r\n\t_updateIndexes(){\r\n\r\n\t\tlet models = this.collection.models;\r\n\t\tfor (let index = 0, length = models.length; index < length; index++) {\r\n\t\t\tlet model = models[index];\r\n\t\t\tlet id = model.id == null ? model.cid : model.id;\r\n\t\t\tlet context = this._store.byModel[id];\r\n\t\t\tcontext && (context.index = index);\r\n\t\t}\r\n\t},\r\n\r\n\r\n};\r\n","import { destroyView, renderView, viewIsGood } from './utils.js';\r\n\r\n\r\n\r\n\r\nexport default {\r\n\r\n\ttriggerViewMethod(){\r\n\t\tthis.view.triggerMethod.apply(this.view, arguments);\r\n\t},\r\n\tgetChildrenContainer(){\r\n\t\tif(_.isString(this.$container))\r\n\t\t\treturn this.view.$(this.$container);\r\n\t\telse if(_.isFunction(this.$container))\r\n\t\t\treturn this.$container();\r\n\t\telse\r\n\t\t\treturn this.$container;\r\n\t},\r\n\tprocessAndRender(opts){\r\n\t\tlet data = this.process(opts);\r\n\t\tthis.render(data);\r\n\t},\r\n\tbeforeRender(){\r\n\t\tif (this.view._isRendered) {\r\n\t\t\tthis.removeCustomViews();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.initModels();\r\n\t\t}\r\n\t},\r\n\trender(data){\t\t\r\n\t\tif(!data) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tthis.triggerViewMethod('before:render:children', data);\r\n\r\n\t\t\t// if(this.view._isRendered)\r\n\t\t\t// \tthis.removeCustomViews();\r\n\r\n\t\t\tthis._destroyChildViews(data.destroy);\r\n\t\t\tthis._detachChildViews(data.detach);\r\n\t\t\tthis._attachChildViews(data.attach);\r\n\r\n\t\t\tthis.triggerViewMethod('render:children', data);\r\n\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t_destroyChildViews(views = []){\r\n\t\tif(!views.length) return;\r\n\t\tlet $container = this.getChildrenContainer();\r\n\t\tthis.triggerViewMethod('before:destroy:children', this);\r\n\r\n\t\tif (this.view.monitorViewEvents === false) {\r\n\t\t\tthis.view.Dom.detachContents($container);\r\n\t\t}\r\n\t\r\n\t\tconst shouldDisableEvents = this.view.monitorViewEvents === false;\r\n\t\t_.each(views, view => {\r\n\t\t\tthis._destroyChildView(view, shouldDisableEvents);\r\n\t\t});\r\n\t\r\n\t\r\n\t\tthis.triggerViewMethod('destroy:children', this);\r\n\r\n\t},\r\n\r\n\t_destroyChildView(view, shouldDisableEvents){\r\n\r\n\t\tif(shouldDisableEvents == null)\r\n\t\t\tshouldDisableEvents = this.view.monitorViewEvents === false;\r\n\r\n\t\t//view.off('destroy', this.removeChildView, this);\r\n\t\tif (!view || view._isDestroyed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdestroyView(view, shouldDisableEvents);\t\t\r\n\t\tthis.view.stopListening(view);\r\n\t},\r\n\r\n\t_detachChildViews(contexts = []){\r\n\t\tif(!contexts.length) return;\r\n\t\tlet monitorViewEvents = this.monitorViewEvents !== false;\r\n\t\t_.each(contexts, context => {\r\n\t\t\tthis._detachChildView(context.view, monitorViewEvents);\r\n\t\t});\r\n\t},\r\n\r\n\t_detachChildView(view, monitorViewEvents){\r\n\t\tif(!view) return;\r\n\t\tif(monitorViewEvents == null) {\r\n\t\t\tmonitorViewEvents = this.view.monitorViewEvents !== false;\r\n\t\t}\r\n\t\tconst shouldTriggerDetach = view._isAttached && monitorViewEvents;\r\n\t\tif (shouldTriggerDetach) {\r\n\t\t\tview.triggerMethod('before:detach', view);\r\n\t\t}\r\n\t\t\t\t\r\n\t\tthis.view.Dom.detachEl(view.el, view.$el);\r\n\t\tif (shouldTriggerDetach) {\r\n\t\t\tview._isAttached = false;\r\n\t\t\tview.triggerMethod('detach', view);\r\n\t\t}\t\r\n\t\t//this.view.stopListening(view);\r\n\t},\r\n\r\n\t_attachChildViews(contexts = []){\r\n\t\tif(!contexts.length) return;\r\n\t\t\r\n\t\tconst shouldTriggerAttach = this.view._isAttached && this.view.monitorViewEvents !== false;\r\n\r\n\t\tconst elBuffer = this.view.Dom.createBuffer();\r\n\t\tlet $container = this.getChildrenContainer();\r\n\t\t_.each(contexts, context => {\r\n\t\t\tlet view = this._ensureContextHasView(context);\r\n\r\n\t\t\tif (!view) return;\r\n\r\n\t\t\t!view._isRendered && renderView(view);\r\n\t\t\tthis.view.Dom.appendContents(elBuffer, view.el, {_$contents: view.$el});\r\n\r\n\t\t\tif (shouldTriggerAttach && !view._isAttached) {\t\t\t\t\r\n\t\t\t\tview.triggerMethod('before:attach', view);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.view.Dom.appendContents($container[0], elBuffer, {_$el: $container});\r\n\r\n\t\tif(shouldTriggerAttach){\r\n\t\t\t_.each(contexts, context => {\r\n\t\t\t\tlet view = context.view;\r\n\t\t\t\tif(!view || view._isAttached) return;\r\n\t\t\t\tview._isAttached = true;\r\n\t\t\t\tview.triggerMethod('attach', view);\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t_ensureContextHasView(context){\r\n\t\tif (viewIsGood(context.view))\r\n\t\t\treturn context.view;\r\n\t\telse if (context.isCollection) {\r\n\t\t\tcontext.view = this._createModelChildView(context.model);\r\n\t\t\treturn context.view;\r\n\t\t} else if(context.rebuild && _.isFunction(context.build)) {\r\n\t\t\tcontext.view = this._createCustomChildView(context);\r\n\t\t\treturn context.view;\r\n\t\t} \r\n\t},\r\n\t_createChildView(context){\r\n\t\tlet created;\r\n\t\tif (context.isCollection) {\r\n\t\t\tcontext.view = this._createModelChildView(context.model);\r\n\t\t\tcreated = !!context.view;\r\n\t\t} else if (_.isFunction(context.build) && (!viewIsGood(context.view) || context.rebuild)) {\r\n\t\t\tcontext.view = this._createCustomChildView(context);\r\n\t\t\tcreated = !!context.view;\r\n\t\t}\r\n\t\tif (!created) return;\r\n\r\n\t\tthis._setupJustCreatedView(context.view, context);\r\n\t},\r\n\t_createCustomChildView(context){\r\n\t\treturn context.build();\r\n\t},\r\n\t_createModelChildView(model){\r\n\t\tlet View = this._getChildViewClass(model);\r\n\t\tif(!View) return;\r\n\t\tlet options = this._getChildViewOptions(model, View);\r\n\t\tlet view = new View(options);\r\n\t\treturn view;\r\n\t},\r\n\t_setupJustCreatedView(view, context){\r\n\t\tif (_.isFunction(context.onBuild)) {\r\n\t\t\tcontext.onBuild.call(this.view, view);\r\n\t\t}\r\n\t\tthis.view._proxyChildViewEvents(view);\t\t\r\n\t},\r\n\t_getChildViewClass(model){\r\n\t\tif(this.modelView === Backbone.View || this.modelView.prototype instanceof Backbone.View)\r\n\t\t\treturn this.modelView;\r\n\t\telse {\r\n\t\t\treturn this.modelView(model);\r\n\t\t}\r\n\t},\r\n\t_getChildViewOptions(model, View){\r\n\t\tlet options = {};\r\n\t\tif(_.isFunction(this.modelViewOptions)){\r\n\t\t\toptions = this.modelViewOptions.call(this, model, View, this) || {};\r\n\t\t} else if(_.isObject(this.modelViewOptions)) {\r\n\t\t\toptions = this.modelViewOptions;\r\n\t\t}\r\n\t\treturn _.extend({}, options, { model });\r\n\t},\r\n\r\n\r\n\r\n\r\n};\r\n","import { isViewClass } from '../../vendors/helpers';\r\n\r\nconst EmptyViewMixin = {\r\n\tremoveEmptyViewInstance(opts = {}){\r\n\t\tlet view = this._emptyViewInstance;\r\n\t\tif (!view) return;\r\n\t\tlet { destroy = []} = opts;\r\n\t\tif (view) {\r\n\t\t\tdelete this._emptyViewInstance;\r\n\t\t\tdestroy.push(view);\r\n\t\t\topts.destroy = destroy;\r\n\t\t}\r\n\t},\r\n\t_getEmptyViewClas(){\r\n\t\tif (!this.emptyView) { return; }\r\n\t\telse if(isViewClass(this.emptyView)){\r\n\t\t\treturn this.emptyView;\r\n\t\t} else if(_.isFunction(this.emptyView)) {\r\n\t\t\treturn this.emptyView.call(this.view);\r\n\t\t}\r\n\t},\r\n\t_injectEmptyView(items){\r\n\t\tlet View = this._getEmptyViewClas();\r\n\t\tif (!View) return;\r\n\t\tlet options = _.extend({}, this.emptyViewOptions);\r\n\t\tlet view = new View(options);\r\n\t\tthis._emptyViewInstance = view;\r\n\t\titems.push({ view });\r\n\t},\r\n\t_removeEmptyViewInstance({ destroy = [] } = {}){\r\n\t\tlet view = this._emptyViewInstance;\r\n\t\tif (!view) return;\r\n\r\n\t\tif (view) {\r\n\t\t\tdelete this._emptyViewInstance;\r\n\t\t\tdestroy.push(view);\r\n\t\t}\r\n\t},\t\r\n};\r\nexport default EmptyViewMixin;\r\n","import extend from '../../utils/extend';\r\nimport borrow from './borrow';\r\nimport collection from './collection';\r\nimport common from './common';\r\nimport customs from './customs';\r\nimport models from './models';\r\nimport render from './render';\r\nimport emptyView from './empty-view';\r\n\r\nimport { Events } from '../../vendors/backbone';\r\n\r\nconst MergeOptions = [\r\n\t'createView',\r\n\t'dataFilter',\r\n\t'dataComparator',\r\n\t'enableCollection',\r\n\t'$container',\r\n\t'view',\r\n\t'modelView',\r\n\t'modelViewOptions',\r\n\t'emptyView',\r\n\t'emptyViewOptions',\r\n\t'enableFilterForCustomViews'\r\n];\r\n\r\nconst ViewManager = function(options = {}){\r\n\tthis.options = _.omit(options, 'collection');\r\n\tthis.mergeOptions(options, MergeOptions);\r\n\tthis._ensureOptions();\r\n\tthis._store = {\r\n\r\n\t\t//holds current filtered set of model contexts\r\n\t\tfiltered:[],\r\n\r\n\t\t//holds all model contexts\r\n\t\titems: [],\r\n\r\n\t\t//grants fast access to a context through model id or cid\r\n\t\tbyModel: {},\r\n\r\n\t\t//holds all cutoms contexts\r\n\t\tcustoms: [],\r\n\t\r\n\t\t//indicates if comparator should be applied\r\n\t\tisSorted: false,\r\n\r\n\t\t//indicates if filter should be applied\r\n\t\tisFiltered: false,\r\n\r\n\t};\r\n\t\r\n\t//in collection mixin\r\n\tif(this.enableCollection)\r\n\t\tthis.setCollection(this.collection || options.collection);\r\n};\r\n\r\nViewManager.extend = extend;\r\n\r\n_.extend(ViewManager.prototype, Events, borrow, collection, common, customs, models, render, emptyView);\r\n\r\nexport default ViewManager;\r\n","const _disallowedKeys = ['setItem', 'key', 'getItem', 'removeItem', 'clear'];\r\nconst allowedKey = key => _disallowedKeys.indexOf(key) < 0;\r\n\r\nconst fake = {\r\n\tsetItem(id, val) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\treturn this[id] = String(val);\r\n\t},\r\n\tgetItem(id) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\treturn this[id];\r\n\t},\r\n\tremoveItem(id) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\tdelete this[id];\r\n\t},\r\n\tclear() {\r\n\t\tlet keys = _(this).keys();\r\n\t\t_(keys).each(key => this.removeItem(key));\r\n\t}\r\n};\r\n\r\nexport default fake;\r\n","import fake from './fake';\r\n\r\nlet session = (typeof sessionStorage === 'undefined') \r\n\t? fake : sessionStorage;\r\n\r\nlet local = (typeof localStorage === 'undefined') \r\n\t? fake : localStorage;\r\n\r\nexport {\r\n\tsession,\r\n\tlocal\r\n};\r\n","import { session, local } from './store';\r\n\r\nconst getStore = (opts = {}) => opts.local === true ? local : session;\r\n\r\nconst SECONDS = 1000;\r\nconst MINUTES = SECONDS * 60;\r\nconst HOURS = MINUTES * 60;\r\nconst DAYS = HOURS * 24;\r\n\r\nvar store = {\r\n\r\n\t_normalizeValue(value) {\r\n\t\tvar normValue = value;\r\n\t\tif (_.isObject(value) && _.isFunction(value.toJSON))\r\n\t\t\tnormValue = value.toJSON();\r\n\t\tif (_.isDate(value) && !_.isNaN(value.valueOf()))\r\n\t\t\tnormValue = 'date(' + normValue + ')';\r\n\t\treturn normValue;\r\n\t},\r\n\r\n\t_createItem(value, expireAt) {\r\n\t\treturn { expireAt: expireAt, value: value };\r\n\t},\r\n\r\n\tjsonParse(key, value) {\r\n\t\tvar datePattern = /^date\\((\\d{4,4}-\\d{2,2}-\\d{2,2}([T\\s]\\d{2,2}:\\d{2,2}:\\d{2,2}(\\.\\d*)?Z?)?)\\)$/;\r\n\t\tif (_.isString(value) && datePattern.test(value)) {\r\n\t\t\tvar textDate = value.replace(datePattern, '$1');\r\n\t\t\treturn new Date(textDate);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t_jsonParse(key, value, context) {\r\n\t\tif (!key) return value;\r\n\t\treturn this.jsonParse(key, value, context);\r\n\t},\r\n\t_parse(raw) {\r\n\t\tlet _this = this;\r\n\t\tlet item = JSON.parse(raw, function (key, value) { return _this._jsonParse(key, value, this); });\r\n\t\tif ('expireAt' in item && 'value' in item)\r\n\t\t\treturn item;\r\n\t\telse\r\n\t\t\treturn this._createItem(item, 0);\r\n\t},\r\n\t_get(key, opts) {\r\n\t\tlet raw = getStore(opts).getItem(key);\r\n\t\tif (raw == null) return;\r\n\t\treturn this._parse(raw);\r\n\t},\r\n\tget(key, opts = {}) {\r\n\r\n\t\tlet { checkExpire = true } = opts;\r\n\r\n\t\tlet item = this._get(key, opts);\t\t\r\n\t\tif (item == null) return;\r\n\r\n\t\tlet expired = this._isExpired(item);\r\n\t\tif (!expired || !checkExpire) {\r\n\r\n\t\t\treturn item.value;\r\n\t\t}\r\n\t\telse if (expired) {\r\n\t\t\tthis.remove(key, opts);\r\n\t\t}\r\n\t},\r\n\tset(key, value, opts = {}) {\r\n\r\n\t\tlet expireAt = Date.now() + this.getExpireAt(opts);\r\n\t\tlet normValue = this._normalizeValue(value);\r\n\t\tlet item = this._createItem(normValue, expireAt);\r\n\t\tthis._set(key, item, opts);\r\n\t\t\r\n\t},\r\n\tremove(key, opts) {\r\n\t\tgetStore(opts).removeItem(key);\r\n\t},\r\n\texpire(key, opts) {\r\n\t\tlet item = this._get(key, opts);\r\n\t\tif (!item) return;\r\n\t\titem.expireAt = 0;\r\n\t\tthis._set(key, item, opts);\r\n\t},\r\n\tgetExpireAt ({ expireAt, seconds, minutes, hours, days }) {\r\n\t\tif (expireAt != null)\r\n\t\t\treturn expireAt;\r\n\r\n\t\tlet offset = 0;\r\n\r\n\t\t_.isNumber(seconds) && (offset += seconds * SECONDS);\r\n\t\t_.isNumber(minutes) && (offset += minutes * MINUTES);\r\n\t\t_.isNumber(hours) && (offset += hours * HOURS);\r\n\t\t_.isNumber(days) && (offset += days * DAYS);\r\n\r\n\t\toffset === 0 && (offset += 10 * MINUTES);\r\n\r\n\t\treturn offset;\r\n\t},\r\n\t_set(key, item, opts) {\r\n\t\tlet text = JSON.stringify(item);\r\n\t\tgetStore(opts).setItem(key, text);\r\n\t},\r\n\tisExpired(key, opts) {\r\n\t\tlet item = this._get(key, opts);\r\n\t\tif (item == null) return true;\r\n\t\treturn this._isExpired(item);\r\n\t},\r\n\t_isExpired(item) {\r\n\t\treturn item.expireAt < Date.now();\r\n\t},\r\n};\r\n\r\nexport default store;\r\n","import extend from '../../utils/extend';\r\nconst errorProps = ['description', 'fileName', 'lineNumber', 'name', 'message', 'number', 'url'];\r\nfunction normalizeAppErrorOptions(data = {}){\r\n\tif(_.isString(data)){\r\n\t\tdata = { message: data };\r\n\t}\r\n\treturn data;\r\n}\r\nconst AppError = extend.call(Error, {\r\n\turlRoot: '',\r\n\turl: '',\r\n\tname: 'app:error',\r\n\tconstructor(options){\r\n\t\tif (!(this instanceof AppError)) {\r\n\t\t\treturn new AppError(_.extend({},options,{ newKeywordOmited: true }));\r\n\t\t}\r\n\t\toptions = normalizeAppErrorOptions(options);\r\n\t\tlet url = options.url;\r\n\t\tdelete options.url;\r\n\r\n\t\tconst error = Error.call(this, options.message);\r\n\t\tconst important = {\r\n\t\t\tname: options.name || this.name,\r\n\t\t\tmessage: options.message || this.message,\r\n\t\t};\r\n\t\tif(url || this.url){\r\n\t\t\timportant.url = (this.urlRoot || '') + (url || this.url || '');\r\n\t\t}\r\n\t\toptions.name = important.name;\r\n\t\t_.extend(this, important, _.pick(error, errorProps), options);\r\n\t\r\n\t\tif (Error.captureStackTrace) {\r\n\t\t\tthis.captureStackTrace();\r\n\t\t}\r\n\t\tif (options.url) \r\n\t\t\tthis.url = this.urlRoot + this.url;\r\n\t},\t\r\n\tcaptureStackTrace(){\r\n\t\tError.captureStackTrace(this, this.constructor);\r\n\t},\r\n\ttoString() {\r\n\t\tlet url = this.url ? ` See: ${ this.url }` : '';\r\n\t\treturn `${ this.name }: ${ this.message }${url}`;\r\n\t}\r\n});\r\n// AppError.setUrlRoot = function(url){\r\n// \tthis.prototype.urlRoot = url;\r\n// };\r\nAppError.extend = extend;\r\n\r\n\r\nexport default AppError;\r\n","import { Events } from '../../vendors/backbone.js';\r\nimport { triggerMethod } from '../../utils/index.js';\r\nimport { instanceGetOption as getOption} from '../../utils/get-option/index.js';\r\n\r\nconst ViewStack = function(options = {}){\r\n\tthis.cid = _.uniqueId('stack');\r\n\tthis.unremovableKey = `_${this.cid}_preventRemove`;\r\n\tthis.destroyOnRemove = true;\r\n\tthis.removeOnEsc = true,\r\n\tthis.removeOnOutsideClick = true,\r\n\tthis.options = options;\r\n\tthis.stack = [];\r\n};\r\n_.extend(ViewStack.prototype, Events, {\r\n\r\n\r\n\tadd(view, options){\r\n\t\tif(!_.isObject(view)) { return; }\r\n\t\t\r\n\t\tthis.triggerMethod('before:add');\r\n\r\n\t\tthis.stack.push(view);\r\n\t\tthis._setupView(view, options);\r\n\r\n\t\tthis._stackChanged(1, view);\r\n\r\n\t},\r\n\t_setupView(view, { preventRemove } = {}){\r\n\t\tif (preventRemove) {\r\n\t\t\tlet key = this.getUnremovableKey();\r\n\t\t\tview[key] = true;\r\n\t\t}\r\n\t\tthis.listenToOnce(view, 'destroy', () => this._removeView(view, { selfDestroy: true }));\t\t\r\n\t},\r\n\tremove(view, { destroy } = {}){\r\n\t\tlet destroyOnRemove = this.getOption('destroyOnRemove');\r\n\t\tlet removed = this._removeView(view);\r\n\t\tif (removed && (destroy || destroyOnRemove)) {\r\n\t\t\tthis._destroyView(view);\r\n\t\t}\r\n\t},\r\n\tgetLast(){\r\n\t\treturn _.last(this.stack);\r\n\t},\r\n\tremoveLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view);\r\n\t},\r\n\tdestroyLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view, { destroy: true });\r\n\t},\r\n\r\n\r\n\t_removeView(view, { selfDestroy } = {}){\r\n\t\tif (!_.isObject(view)) { return; }\r\n\r\n\t\tif (this.isViewUnremovable(view, selfDestroy)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._cleanUpView(view);\r\n\r\n\t\tlet index = this.stack.indexOf(view);\r\n\t\tif (index === -1) return;\r\n\r\n\t\tif (index == this.stack.length - 1)\r\n\t\t\tthis.stack.pop();\r\n\t\telse\r\n\t\t\tthis.stack.splice(index, 1);\r\n\t\t\t\r\n\t\tthis._stackChanged(-1);\r\n\r\n\t\treturn view;\r\n\t},\r\n\t_cleanUpView(view){\r\n\t\tthis.stopListening(view);\r\n\t\tdelete view[this.getUnremovableKey()];\r\n\t},\r\n\t_destroyView(view) {\r\n\t\tif (_.isObject(view) && _.isFunction(view.destroy)) { \r\n\t\t\tview.destroy();\r\n\t\t}\r\n\t},\t\r\n\t_stackChanged(change, view){\r\n\t\tif (change > 0) {\r\n\t\t\tthis._setDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('add', view);\r\n\t\t} else {\r\n\t\t\tthis._unsetDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('remove', view);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tUnremovable view methods\r\n\t\tsometimes you want to prevent view to be removed from the stack\t\t\r\n\t*/\r\n\tgetUnremovableKey(){\r\n\t\treturn this.getOption('unremovableKey');\r\n\t},\r\n\t// options is for internal use only.\r\n\t// self destroy flag filled when a view destroyed outside the stack\r\n\tisViewUnremovable(view, { selfDestroy }={}){\r\n\t\tif (selfDestroy) return false;\r\n\t\tlet key = this.getUnremovableKey();\r\n\t\treturn view[key];\r\n\t},\t\r\n\r\n\r\n\t/*\r\n\t\tDOM listeners logic\r\n\t\t- esc handler\r\n\t\t- outside click handler\r\n\t*/\r\n\tgetViewDomElement(view){\r\n\t\treturn view && view.el;\r\n\t},\r\n\tisElementOutsideOfView(eventElement, view){\r\n\t\tlet viewElement = this.getViewDomElement(view);\r\n\t\tif (!viewElement) return;\r\n\t\treturn !$.contains(viewElement, eventElement);\r\n\t},\r\n\tgetViewIfElementOutside(eventElement){\r\n\t\tlet view = this.getLast();\r\n\t\tif (!view) return;\r\n\t\tif(this.isElementOutsideOfView(eventElement, view)) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\t},\r\n\toutsideClickHandler(event){\r\n\t\tif (!this.stack.length) { return; }\r\n\r\n\t\tlet view = this.getViewIfElementOutside(event.target);\r\n\t\tif (!view) { return; }\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.remove(view);\r\n\r\n\t},\r\n\tescapePressHandler(event){\r\n\t\tif (!this.stack.length || event.keyCode !== 27 ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.removeLast();\r\n\r\n\t},\r\n\r\n\t_setDocumentListeners(){\r\n\t\tif (this._documentListeners || !this.stack.length) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._shouldRemoveOnEsc()) {\t\t\t\r\n\t\t\tthis._escapePressHandler = _.bind(this.escapePressHandler, this);\r\n\t\t\t$doc.on('keyup', this._escapePressHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:on');\r\n\t\t}\r\n\t\tif (this._shouldRemoveOnOutsideClick()) {\r\n\t\t\tthis._outsideClickHandler = _.bind(this.outsideClickHandler, this);\r\n\t\t\t$doc.on('click', this._outsideClickHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:click:on');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:on');\r\n\t\tthis._documentListeners = true;\r\n\t},\r\n\t_unsetDocumentListeners(){\r\n\t\tif (!(this._documentListeners && !this.stack.length)) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._escapePressHandler) {\r\n\t\t\t$doc.off('keyup', this._escapePressHandler);\r\n\t\t\tdelete this._escapePressHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:off');\r\n\t\t}\r\n\t\tif(this._outsideClickHandler) {\r\n\t\t\t$doc.off('click', this._outsideClickHandler);\r\n\t\t\tdelete this._outsideClickHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:click:off');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:off');\r\n\t\tthis._documentListeners = false;\r\n\t},\r\n\t_shouldRemoveOnEsc(){\r\n\t\treturn this.getOption('removeOnEsc') === true;\r\n\t},\r\n\t_shouldRemoveOnOutsideClick(){\r\n\t\treturn this.getOption('removeOnOutsideClick') === true;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\thelper methods\r\n\t*/\r\n\tgetOption,\r\n\ttriggerMethod,\r\n\r\n\tgetDocument(){\r\n\t\treturn this.$doc || $(document);\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t},\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\t\t\r\n\t\tthis._isDestroying = true;\r\n\r\n\t\tthis.triggerMethod('before:destroy');\r\n\t\tlet $doc = this.getDocument();\r\n\t\twhile(this.stack.length){\r\n\t\t\tthis.destroyLast();\r\n\t\t}\r\n\t\t$doc.off('keyup', this._onKeyUp);\r\n\t\t$doc.off('click', this._outsideClick);\r\n\r\n\t\tthis._isDestroyed = true;\r\n\t\tthis.triggerMethod('destroy');\r\n\t},\r\n});\r\nexport default ViewStack;\r\n","import { Region } from '../../vendors/marionette';\r\n\r\nexport const config = {\r\n\tdestroySelfOnEmpty: false,\r\n\tdestroyOnEmpty: false,\r\n};\r\n\r\nconst BaseNodeRegion = Region.extend({\r\n\tonEmpty() {\r\n\t\tlet destroySelf = this.getOption('destroySelfOnEmpty') || this.getOption('destroyOnEmpty');\r\n\t\tlet destroyNode = this.getOption('destroyOnEmpty');\r\n\t\tdestroySelf && this.destroy();\r\n\t\tdestroyNode && this.el.remove();\r\n\t}\r\n});\r\n\r\nconfig.Region = BaseNodeRegion;\r\n\r\nfunction normalizeElement(selector) {\r\n\tlet body = document.querySelector('body');\r\n\tlet el;\r\n\tif (selector == null) {\r\n\t\tel = body;\r\n\t} else if( selector instanceof Element) {\r\n\t\tel = selector;\r\n\t}\r\n\telse if(selector && selector.jquery){\r\n\t\tel = selector.get(0);\r\n\t} else if (_.isString(selector)) {\r\n\t\tel = document.querySelector(selector);\r\n\t}\r\n\tif (el instanceof Element) {\r\n\t\treturn el;\r\n\t} else {\r\n\t\tthrow new Error('el must be in Dom');\t\t\r\n\t}\r\n}\r\n\r\nexport default function renderInNode(view, { el, replaceElement = false, destroySelfOnEmpty = config.destroySelfOnEmpty, destroyOnEmpty = config.destroyOnEmpty  } = {}) {\r\n\tconst NodeRegion = config.Region;\r\n\tel = normalizeElement(el);\r\n\tconst body = document.querySelector('body');\r\n\tif (el === body) {\r\n\t\tel = document.createElement('div');\r\n\t\tbody.appendChild(el);\r\n\t\treplaceElement = true;\r\n\t}\r\n\tconst region = new NodeRegion({ el, replaceElement, destroySelfOnEmpty, destroyOnEmpty });\r\n\tregion.show(view);\r\n}\r\n","export default CollectionView => CollectionView.extend({\r\n\tshouldHandleEmptyFetch: true, \r\n\tconstructor(){\r\n\t\tCollectionView.apply(this, arguments);\r\n\r\n\t\tthis.getOption('shouldHandleEmptyFetch') && this.emptyView\r\n\t\t\t&& this._handleEmptyFetch();\r\n\t},\r\n\t_handleEmptyFetch(){\r\n\t\tif (!this.collection || this.collection.length) { return; }\r\n\r\n\t\tthis.listenToOnce(this.collection, 'sync', \r\n\t\t\t() => !this.collection.length && this._renderChildren()\r\n\t\t);\r\n\r\n\t},\r\n});\r\n","function rebuildIndexes() {\r\n\tif (!this.getOption('shouldRebuildIndexes') || !this.collection) {\r\n\t\treturn;\r\n\t}\r\n\tlet models = this.collection.models;\r\n\tfor (let index = 0, length = models.length; index < length; index++) {\r\n\t\tlet model = models[index];\r\n\t\tlet view = this._children.findByModel(model);\r\n\t\tview && (view._index = index);\r\n\t}\r\n}\r\n\r\nexport default CollectionView => CollectionView.extend({\r\n\tshouldRebuildIndexes: true,\r\n\r\n\tconstructor() {\t\t\r\n\t\t\r\n\t\tCollectionView.apply(this, arguments);\r\n\t\tthis.on('before:sort', rebuildIndexes.bind(this));\r\n\t\t// if (this.collection) {\r\n\t\t// \trebuildIndexes.call(this);\r\n\t\t// \tthis.listenTo({\r\n\t\t// \t\t'update': rebuildIndexes.bind(this),\r\n\t\t// \t\t'sort': rebuildIndexes.bind(this),\r\n\t\t// \t\t'reset': rebuildIndexes.bind(this),\r\n\t\t// \t});\r\n\t\t// }\r\n\t},\r\n\t_addChild(view, index){\r\n\t\tview._isModelView = arguments.length === 1;\r\n\t\tif (index != null) {\r\n\t\t\tview._index = index;\r\n\t\t}\r\n\t\treturn CollectionView.prototype._addChild.apply(this, arguments);\r\n\t},\r\n\t_viewComparator(v1,v2){\r\n\t\tlet res = v1._index - v2._index;\r\n\t\tif (res) return res;\r\n\t\tif (v1._isModelView) return 1;\r\n\t\treturn -1;\r\n\t},\r\n});\r\n","export default CollectionView => CollectionView.extend({\r\n\t_renderChildren() {\r\n\t\t// If there are unrendered views prevent add to end perf\r\n\t\tif (this._hasUnrenderedViews) {\r\n\t\t\tdelete this._addedViews;\r\n\t\t\tdelete this._hasUnrenderedViews;\r\n\t\t}\r\n\r\n\t\tconst views = this._addedViews || this.children._views;\r\n\r\n\t\tthis.triggerMethod('before:render:children', this, views);\r\n\t\r\n\t\tthis._showEmptyView();\r\n\t\r\n\t\tconst els = this._getBuffer(views);\r\n\t\r\n\t\tthis._attachChildren(els, views);\r\n\t\r\n\t\tdelete this._addedViews;\r\n\t\r\n\t\tthis.triggerMethod('render:children', this, views);\r\n\t},\r\n\taddChildView(view, index, options = {}) {\r\n\t\tif (!view || view._isDestroyed) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tif (_.isObject(index)) {\r\n\t\t\toptions = index;\r\n\t\t}\r\n\r\n\t\t// If options has defined index we should use it\r\n\t\tif (options.index != null) {\r\n\t\t\tindex = options.index;\r\n\t\t}\r\n\r\n\t\tif (!this._isRendered && !options.preventRender) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tthis._addChild(view, index);\r\n\r\n\t\tif (options.preventRender) {\r\n\t\t\tthis._hasUnrenderedViews = true;\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tconst hasIndex = (typeof index !== 'undefined');\r\n\t\tconst isAddedToEnd = !hasIndex || index >= this._children.length;\r\n\r\n\t\t// Only cache views if added to the end and there is no unrendered views\r\n\t\tif (isAddedToEnd && !this._hasUnrenderedViews) {\r\n\t\t\tthis._addedViews = [view];\r\n\t\t}\r\n\t\t\r\n\t\tif (hasIndex) {\r\n\t\t\tthis._renderChildren();\r\n\t\t} else {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t\r\n\t\treturn view;\r\n\t},\r\n\t_showEmptyView() {\r\n\r\n\t\tthis._destroyEmptyView();\r\n\t\r\n\t\tif(!this.isEmpty()) { return; }\r\n\r\n\t\tconst EmptyView = this._getEmptyView();\t\r\n\t\tif (!EmptyView) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tconst options = this._getEmptyViewOptions();\r\n\t\tthis._emptyViewInstance = new EmptyView(options);\r\n\t\r\n\t\tthis.addChildView(this._emptyViewInstance, { preventRender: true, index: 0, });\r\n\t\r\n\t},\r\n\t_destroyEmptyView(){\r\n\t\tlet view = this._emptyViewInstance;\r\n\t\tif (!view) return;\r\n\t\r\n\t\tthis._removeChildView(view);\r\n\t\r\n\t\tthis._removeChild(view);\r\n\t\r\n\t\tview.destroy();\r\n\t\tdelete this._emptyViewInstance;\r\n\t},\r\n}, { CollectionViewMixin_4x: true});\r\n","import { isView, isViewClass, betterResult } from '../../../utils/index.js';\r\n\r\nexport default Base => Base.extend({\r\n\t\r\n\trenderAllCustoms: false,\r\n\tshouldMergeCustoms: false,\r\n\r\n\tconstructor(){\r\n\t\tthis._customs = [];\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeCustoms();\r\n\t},\r\n\t_initializeCustoms(){\r\n\r\n\t\tlet optionsCustoms = betterResult(this.options, 'customs', { args: [this], context: this });\r\n\t\tlet instanceCustoms = betterResult(this, 'customs', { args: [this] });\r\n\t\tlet shouldMergeCustoms = this.getOption('shouldMergeCustoms');\r\n\t\tlet add;\r\n\t\tif (shouldMergeCustoms) {\r\n\t\t\tadd = (instanceCustoms || []).concat(optionsCustoms || []);\t\t\t\r\n\t\t} else {\r\n\t\t\tadd = instanceCustoms || optionsCustoms || [];\r\n\t\t}\r\n\t\tthis._customs.push(...add);\r\n\r\n\t\tif (this.getOption('renderAllCustoms')) {\r\n\t\t\tthis.on('render', this._renderCustoms);\r\n\t\t}\r\n\t},\r\n\t_renderCustoms(){\r\n\t\tif (!this.getOption('renderAllCustoms')) return;\r\n\t\tlet customs = this.getCustoms();\r\n\t\tthis.triggerMethod('before:customs:render');\r\n\t\tthis.addChildViews(customs);\r\n\t\tthis.triggerMethod('customs:render');\r\n\t},\r\n\tgetCustoms() {\t\t\r\n\t\treturn this._prepareCustoms(this._customs.slice(0));\r\n\t},\r\n\t_prepareCustoms(rawcustoms){\r\n\t\treturn _.reduce(rawcustoms, (array, item) => {\r\n\t\t\tlet args = this._prepareCustom(item);\r\n\t\t\targs && (args = this.buildCustom(...args));\r\n\t\t\targs && array.push(args);\r\n\t\t\treturn array;\r\n\t\t},[]);\r\n\t},\r\n\t_prepareCustom(arg){\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\treturn this._prepareCustom(arg.call(this, this));\r\n\t\t} else if (_.isArray(arg)) {\r\n\t\t\treturn arg;\r\n\t\t} else {\r\n\t\t\treturn [arg, { index: 0 }];\r\n\t\t}\r\n\t},\r\n\tbuildCustom(view, options = {}){ \r\n\t\tif (isViewClass(view)) {\r\n\t\t\tlet childOptions = this.getOption('customViewOptions');\r\n\t\t\tview = new view(childOptions);\r\n\t\t} else if (_.isFunction(view)) {\r\n\t\t\tview = view.call(this, this);\r\n\t\t}\r\n\t\tif (isView(view)) {\r\n\t\t\treturn [view, options]; \r\n\t\t}\r\n\t},\r\n\taddChildViews(children = []){\r\n\t\tif (!children.length) { return; }\r\n\r\n\t\tlet awaitingRender = false;\r\n\r\n\t\twhile(children.length) {\r\n\r\n\t\t\tlet args = children.pop();\r\n\t\t\tif (!args) { continue; }\r\n\r\n\t\t\tif (!_.isArray(args)) {\r\n\t\t\t\targs = [args, { index: 0 }];\r\n\t\t\t}\r\n\r\n\t\t\tlet [ view, index, options = {} ] = args;\r\n\t\t\tif (_.isObject(index)) {\r\n\t\t\t\toptions = index;\r\n\t\t\t\tindex = undefined;\r\n\t\t\t}\r\n\t\t\tif (index != null && !('index' in options)) {\r\n\t\t\t\toptions.index = index;\r\n\t\t\t}\r\n\t\t\toptions.preventRender = !!children.length;\r\n\t\t\tif (!isView(view)) { continue; }\r\n\r\n\t\t\tthis.addChildView(view, options);\r\n\t\t\tawaitingRender = options.preventRender;\r\n\t\t}\r\n\t\tif (awaitingRender) {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t},\r\n}, { CustomsMixin: true });\r\n","\r\nconst defaultCssConfig = {\r\n\tbeforeRender: true,\r\n\tmodelChange: true,\r\n\trefresh: true,\r\n};\r\n\r\nexport default (Base) => Base.extend({\r\n\tconstructor(){\r\n\t\tif(!this.cssClassModifiers) {\r\n\t\t\tthis.cssClassModifiers = [];\r\n\t\t}\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._setupCssClassModifiers();\t\t\r\n\t},\r\n\taddCssClassModifier(modifier){\r\n\t\tthis.cssClassModifiers.push(modifier);\r\n\t},\r\n\trefreshCssClass(){\r\n\t\tlet className = this._getCssClassString();\r\n\t\tif(className == ''){\r\n\t\t\tthis.$el.removeAttr('class');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$el.attr({\r\n\t\t\t\tclass: className\r\n\t\t\t});\r\n\t\t}\r\n\t},\t\r\n\r\n\t_getCssClassModifiers(){\r\n\t\tlet optsModifiers = this.getOption('cssClassModifiers',{deep:false, args:[this.model, this]});\r\n\t\tlet propsModifiers = this.getProperty('cssClassModifiers',{deep:false, args:[this.model, this]});\r\n\t\tlet modifiers = [this.getOption('className')].concat(optsModifiers || [], propsModifiers || []);\r\n\t\treturn modifiers;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassModifiers(){\r\n\t\treturn this._getCssClassModifiers();\r\n\t},\r\n\t_getCssClassString()\r\n\t{\r\n\t\tlet modifiers = this.getCssClassModifiers();\r\n\t\tlet classes = _(modifiers).map((cls) => {\r\n\t\t\treturn _.isString(cls) \r\n\t\t\t\t? cls \r\n\t\t\t\t: _.isFunction(cls) \r\n\t\t\t\t\t? cls.call(this, this.model, this) \r\n\t\t\t\t\t: null;\r\n\t\t});\r\n\t\tlet ready = _(classes).filter((f) => f != null && f != '');\r\n\t\tlet className = _.uniq(ready).join(' ');\r\n\t\treturn (className || '').trim();\r\n\t},\r\n\r\n\t_setupCssClassModifiers(){\r\n\r\n\t\tif(this._cssClassModifiersInitialized) return;\r\n\r\n\t\tlet cfg = this.getCssClassConfig();\r\n\t\tif(!cfg) return;\r\n\r\n\t\tlet events = this.getCssClassEvents(cfg);\r\n\t\t_(events).each((eventName) => this.on(eventName, this.refreshCssClass));\r\n\r\n\t\tif (cfg.modelChange && this.model) {\r\n\t\t\tthis.listenTo(this.model, 'change', this.refreshCssClass);\r\n\t\t}\r\n\r\n\t\tthis._cssClassModifiersInitialized = true;\r\n\t},\r\n\t\r\n\t_getCssClassConfig(){\r\n\t\tlet cfg = _.extend({}, defaultCssConfig, this.getOption('cssClassConfig'));\r\n\t\tif(!cfg || _.size(cfg) == 0) return;\r\n\t\treturn cfg;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassConfig(){\r\n\t\treturn this._getCssClassConfig();\r\n\t},\r\n\r\n\t_getCssClassEvents(cfg){\r\n\t\tlet events = [].concat(cfg.events || []);\r\n\t\tif(cfg.refresh) events.push('refresh');\r\n\t\tif(cfg.beforeRender) events.push('before:render');\r\n\t\tevents = _(events).uniq();\r\n\t\treturn events;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassEvents(cfg){\r\n\t\treturn this._getCssClassEvents(cfg);\r\n\t}\r\n}, { CssClassModifiersMixin: true });\r\n","\r\nconst defaultSelector = (name, prefix = '') => prefix + 'region-' + name;\r\n\r\nfunction defaultUpdateDom(name, $el)\r\n{\r\n\tlet selector = defaultSelector(name);\r\n\tlet element = $('<div>').addClass(selector);\r\n\t$el.append(element);\r\n\r\n\treturn '.' + selector;\r\n}\r\n\r\nexport default function buildRegionFunc(view, hash, context){\r\n\r\n\tlet { $el } = view;\t\r\n\tlet { autoCreateRegion } = context;\r\n\tlet { updateDom, name, el } = hash;\r\n\tlet regionEl;\r\n\t\r\n\tlet region = view.getRegion(name);\r\n\r\n\r\n\tif (el == null && autoCreateRegion !== false) {\r\n\r\n\t\tlet testEl = region && region.getOption('el',{ deep:false});\r\n\r\n\t\tif (!region || !testEl || !$el.find(testEl).length) {\r\n\r\n\t\t\tregionEl = defaultUpdateDom(name, $el);\r\n\r\n\t\t} \r\n\r\n\t} else if(_.isFunction(updateDom)) {\r\n\t\tupdateDom.call(view, $el, view);\r\n\r\n\t} \r\n\t\r\n\t\r\n\tif (!region) {\r\n\t\tlet definition = _.pick(hash, 'replaceElement', 'regionClass');\r\n\t\tdefinition.el = hash.el || regionEl;\r\n\t\tregion = view.addRegion(name, definition);\r\n\t}\r\n\r\n\r\n\treturn region;\r\n}\r\n","import buildRegion from './build-region';\r\n\r\nexport default function normalizeNestedViewContextRegion(context) {\r\n\r\n\tlet { region } = context;\r\n\tlet regionName = (_.isString(region) && region) || context.regionName || context.name;\r\n\r\n\tif (_.isString(region) || region == null) {\r\n\t\tregion = {};\r\n\t} else if (_.isFunction(region)) {\r\n\t\tregion = region.call(this, context, this);\r\n\t}\r\n\r\n\tif (_.isObject(region)) {\r\n\r\n\t\tif(!region.name)\r\n\t\t\tregion.name = regionName;\r\n\t\tlet replaceElement = this.getOption('replaceNestedElement');\r\n\t\tcontext.region = _.extend({ replaceElement }, region);\r\n\t\tcontext.show = _.partial(buildRegion, this, context.region, context);\r\n\t}\r\n\treturn context;\r\n}\r\n","//import result from '../../../utils/better-result';\r\nimport { betterResult as result } from '../../../utils/index.js';\r\nimport normalizeRegion from './normalize-region.js';\r\nimport { isView, isViewClass } from '../../../vendors/helpers.js';\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tthis._nestedViews = {};\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis.initializeNestedViews();\r\n\t},\r\n\ttemplate: false,\r\n\r\n\tshowAllNestedViewsOnRender: false,\r\n\tshowNestedViewOnAdd: false,\r\n\treplaceNestedElement: true,\r\n\r\n\tinitializeNestedViews(){\r\n\t\tif (this._nestedViewsInitialized) return;\r\n\r\n\t\tif(this.getOption('showAllNestedViewsOnRender')) {\r\n\t\t\tthis.on('render', () => this.showAllNestedViews());\r\n\t\t}\r\n\r\n\t\tlet nesteds = this.getOption('nestedViews', { args:[this.model, this]});\r\n\t\t_(nesteds).each((context, index) => {\r\n\r\n\t\t\tlet name = _.isString(index) ? index : (context.name || _.uniqueId('nested'));\r\n\t\t\tthis.addNestedView(name, context);\r\n\r\n\t\t});\r\n\r\n\t\tthis._nestedViewsInitialized = true;\r\n\t},\r\n\t_normalizeNestedContext(name, context){\r\n\r\n\t\tif (isViewClass(context)) {\r\n\t\t\tlet View = context;\r\n\t\t\tcontext = {\r\n\t\t\t\tname, View\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t//unwrap to plain object\r\n\t\tif (_.isFunction(context)) {\r\n\t\t\tcontext = context.call(this, this.model, this);\r\n\t\t}\r\n\r\n\t\t//fix name if its not provided\r\n\t\tif (context.name == null) {\r\n\t\t\tcontext.name = name || _.uniqueId('nested');\r\n\t\t}\r\n\r\n\t\t//convert region to valid function\r\n\t\tcontext = normalizeRegion.call(this, context);\t\t\r\n\r\n\r\n\t\treturn context;\r\n\t},\r\n\t_createNestedContext(context){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\tcontexts[context.name] = context;\r\n\t},\r\n\r\n\taddNestedView(name, context){\r\n\r\n\t\tif (!_.isString(name) || name === '') {\r\n\t\t\tthrow new Error('addNestedView: first argument should be a string');\r\n\t\t}\r\n\r\n\t\tcontext = this._normalizeNestedContext(name, context);\r\n\t\tthis._createNestedContext(context);\r\n\t\tif(this.getOption('showNestedViewOnAdd') && this.isRendered()){\r\n\t\t\tthis.showNestedView(context);\r\n\t\t}\t\t\r\n\t},\r\n\r\n\tshowNestedView(name){\r\n\t\tlet region = this.getNestedViewRegion(name);\r\n\t\tlet view = region && this.buildNestedView(name);\r\n\t\tif (view) {\r\n\t\t\tregion.show(view);\r\n\t\t}\r\n\t},\r\n\tshowAllNestedViews(){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\t_(contexts).each(context => this.showNestedView(context));\r\n\t},\r\n\tgetNestedViewContext(name){\r\n\t\tlet contexts = this._nestedViews;\r\n\t\tif (arguments.length == 0)\r\n\t\t\treturn contexts;\r\n\t\telse\r\n\t\t\treturn contexts[name];\r\n\t},\r\n\r\n\r\n\tbuildNestedView(name){\r\n\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\r\n\t\tif(!context) return;\r\n\t\tlet passedView = result(context, 'view', { context: this, args: [this, this.model] });\r\n\t\tif(_.isFunction(context.template))\r\n\t\t\treturn context.template;\r\n\t\telse if ( isView(passedView) ) {\r\n\t\t\treturn passedView;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet View = context.View;\r\n\t\t\tlet options = this.buildNestedViewOptions(result(context, 'options', { context: this, args: [this, this.model], default:{} }));\r\n\t\t\t\r\n\t\t\treturn new View(options);\r\n\t\t}\r\n\t},\r\n\tbuildNestedViewOptions(opts){\r\n\t\treturn opts;\r\n\t},\r\n\tgetNestedViewRegion(name){\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\t\treturn context && _.result(context, 'show');\r\n\t}\r\n\t\r\n});\r\n","import ViewManager from '../../../components/view-manager';\r\n\r\nexport default BaseView => BaseView.extend({\r\n\t\r\n\tconstructor(options){\r\n\t\tthis.options = options;\r\n\t\tthis.mergeOptions(options,['managedCollection','collection','viewFilter','viewComparator', 'modelView', 'modelViewOptions', 'emptyView', 'emptyViewOptions']);\r\n\t\t\r\n\t\tBaseView.apply(this, arguments);\r\n\t\t\r\n\t\t//tries to initialize viewManager\r\n\t\tthis._initializeViewManager();\r\n\t},\r\n\r\n\ttemplate: _.noop,\r\n\t//if true - initializes ViewManager without collection support\r\n\tenableCustomViews: false,\r\n\t//if true - initializes ViewManager with collection and customviews support\r\n\tenableCollectionViews: false,\r\n\r\n\t_initializeViewManager(){\r\n\t\tlet customs = this.getOption('enableCustomViews');\r\n\t\tlet models = this.getOption('enableCollectionViews');\r\n\t\tif(!(customs || models)) return;\r\n\t\t\r\n\t\tlet enableFilterForCustomViews;\r\n\t\tif (!models && customs && this.getFilter()) {\r\n\t\t\tenableFilterForCustomViews = true;\r\n\t\t}\r\n\r\n\t\tthis._fallbackOptions();\r\n\r\n\t\tthis._viewManager = new ViewManager({\r\n\t\t\tenableCollection: models,\r\n\t\t\tcollection: models && this.managedCollection || this.collection || null,\r\n\t\t\tview: this,\r\n\t\t\t$container: this.getChildrenContainer(),\r\n\t\t\tmodelView: this.modelView,\r\n\t\t\tmodelViewOptions: this.modelViewOptions,\r\n\t\t\tdataFilter: this.getFilter(),\r\n\t\t\tdataComparator: this.getComparator(),\r\n\t\t\temptyView: this.emptyView,\r\n\t\t\temptyViewOptions: this.emptyViewOptions,\r\n\t\t\tenableFilterForCustomViews\r\n\t\t});\r\n\r\n\t\tif (this._customViewsQueue) {\r\n\t\t\t_.each(this._customViewsQueue, args => this._viewManager.addCustomView.apply(this._viewManager, args));\r\n\t\t\tthis._customViewsQueue.length = 0;\r\n\t\t\tdelete this._customViewsQueue;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_fallbackOptions(){\r\n\t\tif(!this.modelView) {\r\n\t\t\tthis.modelView = this.childView || this.options.childView;\r\n\t\t}\r\n\t\tif(!this.modelViewOptions){\r\n\t\t\tthis.modelViewOptions = this.childViewOptions || this.options.childViewOptions;\r\n\t\t}\r\n\t},\t\r\n\r\n\r\n\t/*\r\n\t\trender has two additional calls\r\n\t\t\t- this._viewManager.beforeRender()\r\n\t\t\t- this._viewManager.processAndRender()\r\n\t*/\r\n\trender() {\r\n\t\tconst template = this.getTemplate();\r\n\r\n\t\tif (template === false || this._isDestroyed) { return this; }\r\n\r\n\t\tthis._viewManager && this._viewManager.beforeRender();\r\n\r\n\t\tthis.triggerMethod('before:render', this);\r\n\r\n\r\n\t\t// If this is not the first render call, then we need to\r\n\t\t// re-initialize the `el` for each region\r\n\t\tif (this._isRendered) {\r\n\t\t\tthis._reInitRegions();\r\n\t\t}\r\n\r\n\t\tthis._renderTemplate(template);\r\n\t\tthis.bindUIElements();\r\n\r\n\t\tthis._viewManager && this._viewManager.processAndRender();\r\n\r\n\t\tthis._isRendered = true;\r\n\t\tthis.triggerMethod('render', this);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\r\n\tgetChildrenContainer(){\r\n\t\treturn this.getOption('childrenContainer', { force: false });\r\n\t},\r\n\r\n\t/*\r\n\t\tmanaging sort and filter\r\n\t*/\r\n\tsetComparator(comparator, opts) {\r\n\t\tthis._viewManager && this._viewManager.setComparator(comparator, opts);\r\n\t\tthis.viewComparator = comparator;\r\n\t\treturn this;\r\n\t},\r\n\tgetComparator(){\r\n\t\treturn this.viewComparator;\r\n\t},\r\n\tsetFilter(filter, opts) {\r\n\t\tthis._viewManager && this._viewManager.setFilter(filter, opts);\r\n\t\tthis.viewFilter = filter;\r\n\t\treturn this;\r\n\t},\r\n\tgetFilter(){\r\n\t\treturn this.viewFilter;\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tfallback methods for CollectionView \r\n\t*/\r\n\tsort(){\r\n\t\tthis._viewManager && this._viewManager.processAndRender({ forceSort: true, forceFilter: true });\r\n\t},\r\n\tfilter(){\r\n\t\tthis._viewManager && this._viewManager.processAndRender({ forceFilter: true });\r\n\t},\t\r\n\r\n\taddChildView(...args){\r\n\t\tif (!args || args.length == 0) return;\r\n\t\tif (this._viewManager) {\r\n\t\t\tthis._viewManager.addCustomView.apply(this._viewManager, arguments);\r\n\t\t} else {\r\n\t\t\tthis._customViewsQueue || (this._customViewsQueue = []);\r\n\t\t\tthis._customViewsQueue.push(args);\r\n\t\t}\r\n\t},\r\n\r\n});\r\n","export default Base => Base.extend({\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\r\n\t\tthis._isDestroying = true;\r\n\t\tBase.prototype.destroy.apply(this, arguments);\r\n\t\tdelete this._isDestroying;\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t}\r\n}, { DestroyMixin: true });\r\n","import { buildViewByKey } from '../../../utils/index.js';\r\nexport default Base => Base.extend({\r\n\tbuildViewByKey\r\n});\r\n","import { BackboneView } from '../../vendors/backbone.js';\r\n\r\nexport default BackboneView.extend({\r\n\tconstructor({ text } = {}){\r\n\t\tBackboneView.apply(this, arguments);\r\n\t\tthis.setText(text);\r\n\t},\r\n\trender(){\r\n\t\tthis.$el.html(this.text);\r\n\t\tthis._isRendered = true;\r\n\t\treturn this;\r\n\t},\r\n\tisRendered(){\r\n\t\treturn this._isRendered === true;\r\n\t},\r\n\tsetText(text){\r\n\t\tthis.text = text;\r\n\t\tif(this.isRendered()) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n});\r\n","import { isView, isViewClass, mix } from '../../utils/index.js';\r\n\r\n\r\nimport { customs, nextCollectionView } from '../../mixins/collection-view/index.js';\r\nimport { destroy } from '../../mixins/view/index.js';\r\nimport TextView from '../text-view/index.js';\r\n\r\nexport default CollectionView => {\r\n\tlet Mixed = CollectionView;\r\n\tlet mixWith = [];\r\n\r\n\tif (!Mixed.DestroyMixin) {\r\n\t\tmixWith.push(destroy);\r\n\t}\r\n\tif (!Mixed.CollectionViewMixin_4x) {\r\n\t\tmixWith.push(nextCollectionView);\r\n\t}\r\n\r\n\tif (!Mixed.CustomsMixin) {\r\n\t\tmixWith.push(customs);\r\n\t}\r\n\r\n\tif (mixWith.length) {\r\n\t\tMixed = mix(Mixed).with(...mixWith);\r\n\t}\r\n\r\n\treturn Mixed.extend({\r\n\t\tviewComparator:false,\r\n\t\twrapContent: true,\r\n\t\tchildViewContainer: '[data-modal-content]',\r\n\t\trenderAllCustoms: true,\r\n\t\ttemplateContext(){\r\n\t\t\treturn {\r\n\t\t\t\tshouldWrapContent: this.getOption('wrapContent') === true,\r\n\t\t\t};\r\n\t\t},\r\n\t\tevents:{\r\n\t\t\t'click'(event){\r\n\t\t\t\tif(this.getOption('preventRemove')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet $el = $(event.target);\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tif ($el.closest('[data-modal-content]').length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.destroy();\r\n\t\t\t}\r\n\t\t},\r\n\t\tcustoms:[\r\n\t\t\t(v) => v.createCloseButton(),\r\n\t\t\t(v) => v.takeOptionsView('header'),\r\n\t\t\t(v) => v.takeOptionsView('content'),\r\n\t\t\t(v) => v.takeOptionsView('footer'),\r\n\t\t],\r\n\t\tcreateCloseButton(){\r\n\t\t\tif (!this.getOption('closeButton') || this.getOption('preventRemove')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet Button = this.getOption('closeButtonView');\r\n\t\t\tif (!isViewClass(Button)) {\r\n\t\t\t\tthrow new Error('CloseButtonView not defined in modals config');\r\n\t\t\t}\r\n\t\t\tlet view = new Button({ attributes: { 'data-modal-close':'' } });\r\n\t\t\tthis.listenTo(view, 'click', this.destroy);\r\n\t\t\treturn view;\r\n\t\t},\r\n\t\ttakeOptionsView(key){\r\n\t\t\tlet view = this.getOption(key);\r\n\t\t\tlet _view;\r\n\t\t\tif(!view) {\t\t\t\r\n\t\t\t\treturn view;\r\n\t\t\t} else if(isView(view)) {\r\n\t\t\t\t_view = view;\r\n\t\t\t}\r\n\t\t\telse if(_.isString(view)){\t\t\t\r\n\t\t\t\tlet tagName = ['header','footer'].indexOf(key) > -1 ? key : 'div';\r\n\t\t\t\tlet View = this.getOption('textView') || TextView;\r\n\t\t\t\t_view = new View({ text: view, tagName });\r\n\t\t\t} else if(isViewClass(view)) {\r\n\t\t\t\tlet options = this.getOption(key+'Options');\r\n\t\t\t\t_view = new view(options);\r\n\t\t\t}\r\n\t\t\tif(_view){\r\n\t\t\t\t!this.modalChildren && (this.modalChildren = {});\r\n\t\t\t\tthis.modalChildren[key] = _view;\r\n\t\t\t\tif (key === 'content') {\r\n\t\t\t\t\tthis._initContentListeners(_view);\r\n\t\t\t\t}\r\n\t\t\t\treturn _view;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_initContentListeners(content){\r\n\t\t\tthis.listenTo(content, {\r\n\t\t\t\t'destroy': () => this.destroy(),\r\n\t\t\t\t'done': () => this.destroy(),\r\n\t\t\t});\r\n\t\t},\r\n\t\tattributes:{\r\n\t\t\t'data-modal': ''\r\n\t\t},\r\n\t});\r\n};\r\n","import { isViewClass } from '../../utils/index.js';\r\nimport renderInNode from '../../components/render-in-node/index.js';\r\nimport { View as MnView } from '../../vendors/marionette.js';\r\nimport { ViewStack } from '../../components/index.js';\r\n\r\nimport ViewMixin from './view-mixin';\r\n\r\nexport default {\r\n\t\r\n\ttemplate: _.template(`\r\n<div data-modal-bg></div>\r\n<% if(shouldWrapContent) {%><div data-modal-content-wrapper><%} %>\r\n<section data-modal-content></section>\r\n<% if(shouldWrapContent) {%></div><%} %>\r\n`),\r\n\r\n\tBaseView: undefined,\r\n\tTextView: undefined,\r\n\tModalView: undefined,\r\n\tCloseButtonView: undefined,\r\n\r\n\tbuildView(options, View){\r\n\t\tif(!isViewClass(View)) {\r\n\t\t\tif (!this.ModalView) {\r\n\t\t\t\tif (!this.BaseView) {\r\n\t\t\t\t\tthrow new Error('modals config has no View defined. please set View or BaseView');\r\n\t\t\t\t}\r\n\t\t\t\tthis.ModalView = ViewMixin(this.BaseView);\r\n\t\t\t}\r\n\t\t\tView = this.ModalView;\r\n\t\t}\r\n\t\toptions = _.extend({ \r\n\t\t\ttextView: this.TextView || MnView, \r\n\t\t\tcloseButtonView: this.CloseButtonView || MnView,\r\n\t\t\ttemplate: this.template,\r\n\t\t}, options);\r\n\t\treturn new View(options);\r\n\t},\r\n\trender(view, stack, options = {}){\r\n\t\tlet el = _.result(this, 'container');\r\n\t\tif(el && el.jquery){\r\n\t\t\tel = el.get(0);\r\n\t\t}\r\n\t\toptions = _.extend({ \r\n\t\t\tel, replaceElement: true, destroyOnEmpty: true,\t\t\t\r\n\t\t}, options);\r\n\r\n\t\trenderInNode(view, options);\r\n\r\n\t\tif (stack) {\r\n\t\t\tlet { preventRemove } = options;\r\n\t\t\tstack.add(view, { preventRemove });\r\n\t\t}\r\n\t},\r\n\tcontainer: () => document.querySelector('body'),\r\n\tstackOptions: {\r\n\t\tremoveOnEsc: true,\r\n\t\tremoveOnOutsideClick: true,\r\n\t},\r\n\tgetStack(options){\r\n\t\tif (!this.stack) {\r\n\t\t\tlet stackOptions = this.stackOptions || options;\r\n\t\t\tthis.stack = new ViewStack(stackOptions);\r\n\t\t}\r\n\t\treturn this.stack;\r\n\t}\r\n};\r\n\r\n","import config from './config';\r\n\r\nfunction show(opts = {}, showOptions = {}){\r\n\r\n\tlet { preventRemove, promise } = opts;\r\n\r\n\tlet modal = config.buildView(opts);\r\n\tshowOptions.preventRemove = preventRemove;\r\n\tconfig.render(modal, config.getStack(), showOptions);\r\n\r\n\tif (promise) {\r\n\t\treturn modal.promise;\r\n\t} else {\r\n\t\treturn modal;\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport default {\r\n\tconfig,\r\n\tshow\r\n};\r\n","import { isView, isViewClass, getOption } from '../../utils/index.js';\r\nimport { TextView } from '../../components/index.js';\r\n\r\nfunction get(context, key){\r\n\tif(_.isFunction(context.getOption)){\r\n\t\treturn context.getOption(key);\r\n\t}\r\n\telse {\r\n\t\treturn getOption(context.options, key, { context, args: [ context ], checkAlso: context });\r\n\t}\r\n}\r\n\r\nfunction buildView(view, options){\r\n\tif (isView(view)) {\r\n\t\treturn view;\r\n\t} else if (isViewClass(view)) {\r\n\t\treturn new view(options);\r\n\t}\r\n}\r\n\r\nexport default function buildViewByKey(key, { allowTextView = true, options } = {}) {\r\n\tif(!_.isString(key)) { return; }\r\n\tlet view = get(this, key);\r\n\tlet _options = get(this, key + 'Options');\r\n\tif (allowTextView && _.isString(view)) {\r\n\t\t_options = _.extend(_options, { text: view });\r\n\t\tview = TextView;\r\n\t}\r\n\toptions = _.extend({}, options, _options);\r\n\treturn buildView(view, options);\r\n}\r\n","export { default as betterResult } from './better-result/index.js';\r\nexport { default as camelCase } from './camel-case/index.js';\r\n\r\nexport { default as comparator } from './comparator/index.js';\r\nexport { default as compareAB } from './compare-ab/index.js';\r\nexport { default as convertString } from './convert-string/index.js';\r\nexport { default as extend } from './extend/index.js';\r\n\r\nexport { default as flat } from './flat/index.js';\r\nexport { default as getByPath } from './get-by-path/index.js';\r\nexport { default as getOption } from './get-option/index.js';\r\nexport { default as hasFlag } from './has-flag/index.js';\r\nexport { default as isKnownCtor } from './is-known-ctor/index.js';\r\n\r\nexport { default as mix } from './mix/index.js';\r\nexport { default as paramsToObject } from './params-to-object/index.js';\r\nexport { default as setByPath } from './set-by-path/index.js';\r\nexport { default as toBool } from './to-bool/index.js';\r\nexport { default as unflat } from './unflat/index.js';\r\n\r\nexport { default as compareObjects } from './compare-objects/index.js';\r\nexport { default as mergeObjects } from './merge-objects/index.js';\r\nexport { default as triggerMethod, triggerMethodOn } from './trigger-method/index.js';\r\n\r\nexport { default as mergeOptions } from './merge-options/index.js';\r\n\r\nexport { default as buildViewByKey } from './build-view-by-key/index.js';\r\n\r\nexport { \r\n\tisModel, isModelClass, isCollection, isCollectionClass, isView, isViewClass\r\n} from '../vendors/helpers';\r\n\r\n/*\r\nexport default {\r\n\tbetterResult, camelCase,\r\n\tcomparator, compareAB, convertString, extend,\r\n\tflat, getByPath, getOption, hasFlag, isKnownCtor, \r\n\tmix, paramsToObject, setByPath, toBool, unflat,\r\n\tisModel, isModelClass, isCollection, isCollectionClass, isView, isViewClass,\r\n\ttriggerMethod, triggerMethodOn, mergeOptions,\r\n\tcompareObjects, mergeObjects\r\n};\r\n*/\r\n","// import result from '../../../utils/better-result';\r\n// import getOption from '../../../utils/get-option';\r\nimport { betterResult as result, getOption } from '../../../utils/index.js';\r\n\r\nconst Mixin = (Base) => Base.extend({\r\n\r\n\t//property first approach\r\n\tgetProperty(key, opts){\r\n\t\t\r\n\t\tlet defaultGetArguments = result(this, '_getPropertyArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts, {\r\n\t\t\tcontext: this,\r\n\t\t});\r\n\t\tlet { deep } = options;\r\n\r\n\t\tlet value = result(this, key, options);\r\n\t\tif (value == null && deep !== false) {\r\n\t\t\tvalue = result(this.options, key, options);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\r\n\t//options first approach\r\n\tgetOption(key, opts){\r\n\t\tlet defaultGetArguments = result(this, '_getOptionArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts);\r\n\r\n\t\treturn getOption(this, key, options);\r\n\t},\r\n\r\n\tmergeOptions(values = {}, keys = [], opts = {}){\r\n\t\t\r\n\t\tif(_.isString(keys))\r\n\t\t\tkeys = keys.split(/\\s*,\\s*/);\r\n\r\n\t\t_.each(keys, (key) => {\r\n\t\t\tconst option = result(values, key, _.extend({ force: false }, opts));\r\n\t\t\tif (option !== undefined) {\r\n\t\t\t\tthis[key] = option;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n}, {\r\n\tGetOptionMixin:true\r\n});\r\n\r\nMixin.defaults = {\r\n\tdeep: true,\r\n\tforce: true\r\n};\r\n\r\nexport default Mixin;\r\n","export default function getNestedResult(value, context, schema) {\r\n\treturn value != null \r\n\t\t&& _.isFunction(schema.nested) \r\n\t\t&& schema.nested(value, context);\r\n}","export default function getPropertySchema(model, key)\r\n{\r\n\tif (_.isFunction(model.getPropertySchema)) {\r\n\t\treturn model.getPropertySchema(key);\r\n\t} else {\r\n\t\treturn {};\r\n\t}\r\n}","export default function getDisplayConfig(key, model, schema){\r\n\tif (key == null) return {};\r\n\treturn (_.isFunction(model.getPropertyDisplayConfig) && model.getPropertyDisplayConfig(key))\r\n\t\t|| (schema && schema.display) || {};\r\n}","import { Model } from '../../../vendors/backbone.js';\r\nimport getNestedResult from './get-nested-result.js';\r\nimport getPropertySchema from './get-property-schema.js';\r\nimport getDisplayConfig from './get-display-config.js';\r\n//import getByPath from '../../../utils/get-by-path/index.js';\r\nimport { getByPath } from '../../../utils/index.js';\r\n\r\nexport default Base => {\r\n\tconst originalGet = Model.prototype.get;\r\n\tconst Mixed = Base.extend({\r\n\t\tgetByPath(key){\r\n\t\t\tif(key.indexOf('.') > -1)\r\n\t\t\t\treturn getByPath(this, key);\r\n\t\t\telse\r\n\t\t\t\treturn originalGet.call(this, key);\r\n\t\t},\r\n\t\tget(key, opts = {}){\r\n\t\t\tif(key == null || key == '') return;\t\r\n\t\t\t\r\n\t\t\tlet value = 'value' in opts \r\n\t\t\t\t? opts.value\r\n\t\t\t\t: this.getByPath.call(this, key);\r\n\r\n\t\t\tif (!_.size(opts)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet result = opts.nested && getNestedResult(value, this, prop);\r\n\t\t\tif (result != null) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(opts.transform) && !opts.raw) {\r\n\t\t\t\tvalue = opts.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(prop.transform) && !opts.raw){\r\n\t\t\t\tvalue = prop.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(opts.display === true){\r\n\r\n\t\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\r\n\t\t\t\tif(opts.alternative){\r\n\t\t\t\t\tvalue = _.isFunction(display.alternative) && display.alternative.call(this, value, _.extend({},opts,prop), this);\r\n\t\t\t\t}\r\n\t\t\t\telse if(_.isFunction(display.transform)) {\r\n\t\t\t\t\tvalue = display.transform.call(this, value, opts, this);\r\n\t\t\t\t}\r\n\t\t\t\tif(display.ifEmpty && (value == null || value === ''))\r\n\t\t\t\t\treturn display.ifEmpty;\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tdisplay(key, opts = {}){\r\n\t\t\t_.extend(opts, { display:true });\r\n\t\t\treturn this.get(key, opts);\r\n\t\t},\r\n\t\tpropertyName(key) {\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\t\t\treturn display.label || key;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Mixed;\r\n};\r\n","export default Collection => Collection.extend({\r\n\tconstructor(){\r\n\t\t\r\n\t\tthis.on({\r\n\t\t\trequest(){\r\n\t\t\t\tthis._isFetching = true;\r\n\t\t\t},\r\n\t\t\tsync(){\r\n\t\t\t\tthis._isFetching = false;\r\n\t\t\t\tthis._isFetched = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tCollection.apply(this, arguments);\r\n\t},\r\n\tisFetching(){\r\n\t\treturn this._isFetching === true;\r\n\t},\r\n\tisFetched(){\r\n\t\treturn this._isFetched === true;\r\n\t}\r\n});\r\n","export default Base => Base.extend({\r\n\ttriggerNameEvent: true,\r\n\tstopEvent: true,\r\n\tconstructor(options){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis.mergeOptions(options, ['name']);\r\n\t},\r\n\ttagName:'button',\r\n\ttemplate: _.template('<i></i><span><%= text %></span><i></i>'),\r\n\tevents:{\r\n\t\t'click'(e) {\r\n\t\t\tlet stop = this.getOption('stopEvent');\r\n\t\t\tif (stop) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\tthis.beforeClick().then(\r\n\t\t\t\tdata => {\r\n\t\t\t\t\tthis.triggerMethod('click', data, e, this);\r\n\t\t\t\t\tif (this.name) {\r\n\t\t\t\t\t\tthis.triggerMethod('click:'+this.name, data, e, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror => {\r\n\t\t\t\t\tthis.triggerMethod('click:fail', error, this.name, e, this);\r\n\t\t\t\t\tif (this.name) {\r\n\t\t\t\t\t\tthis.triggerMethod('click:'+this.name+':fail', error, e, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\tbeforeClick(){\r\n\t\tlet result = this.triggerMethod('before:click');\r\n\t\tif(result && _.isFunction(result.then) ) {\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve(result);\r\n\t\t}\r\n\t},\r\n\ttemplateContext(){\r\n\t\treturn {\r\n\t\t\ttext: this.getOption('text')\r\n\t\t};\r\n\t},\r\n\tdisable(){\r\n\t\tthis.$el.prop('disabled', true);\r\n\t},\r\n\tenable(){\r\n\t\tthis.$el.prop('disabled', false);\r\n\t},\r\n});\r\n","import { flat, unflat, setByPath, getByPath, compareObjects, betterResult } from '../../../utils/index.js';\r\n\r\nfunction takeValue(key, first = {}, second = {}){\r\n\tif(!_.isObject(first) || !_.isString(key)) return;\r\n\tif (key in first) {\r\n\t\treturn first[key];\r\n\t} else {\r\n\t\treturn second[key];\r\n\t}\r\n}\r\n\r\nfunction getTriggerMethod(context){\r\n\tif(!context) { return () => {}; }\r\n\treturn _.isFunction(context.triggerMethod) ? context.triggerMethod\r\n\t\t: _.isFunction(context.trigger) ? context.trigger\r\n\t\t\t: () => {};\r\n}\r\n\r\nfunction ensureError(error, value){\r\n\tif(error instanceof Error){\r\n\t\tthrow error;\r\n\t}\r\n\treturn arguments.length > 1 ? value : error;\r\n}\r\n\r\n\r\nexport default Base => Base.extend({\r\n\r\n\tisControl: true,\r\n\tconstructor(options){\t\t\r\n\t\tthis._initControl(options);\r\n\t\tBase.apply(this, arguments);\r\n\t\tif (this.getOption('validateOnReady')) {\r\n\t\t\tthis.once('control:ready', () => {\r\n\t\t\t\tthis.validate().catch(() => {});\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t_onControlDestroy(){\r\n\t\tlet parent = this.getParentControl();\r\n\t\tif (parent && _.isFunction(parent._removeChildControl)) {\r\n\t\t\tparent._removeChildControl(this);\r\n\t\t}\r\n\t\tlet children = this.getChildrenControls();\r\n\t\tif (children) {\r\n\t\t\t_.each(children, child => child._removeParentControl());\r\n\t\t\tchildren.length = 0;\r\n\t\t}\r\n\t\tdelete this._cntrl;\r\n\t},\r\n\t_removeChildControl(control){\r\n\t\tthis.off(control);\r\n\t\tlet children = this.getChildrenControls();\r\n\t\tif (!children.length) { return; }\r\n\t\tlet index = children.indexOf(control);\r\n\t\tif (index === -1) return;\r\n\t\tchildren.splice(index, 1);\r\n\t},\r\n\t_addChildControl(control){\r\n\t\tlet children = this.getChildrenControls();\r\n\t\tchildren.push(control);\r\n\t\t// this.listenTo(control, 'control:invalid', (error) => {\r\n\t\t// \tthis._onControlValidateFail(error, this.getControlValue({ notValidated: true })).catch(() => {});\r\n\t\t// });\r\n\t},\r\n\t_removeParentControl(){\r\n\t\tdelete this._cntrl.parent;\r\n\t},\r\n\t_initControl(options = {}){\r\n\t\tif (this._controlInitialized) { return; }\r\n\r\n\t\tthis._cntrl = {};\r\n\t\tlet name = takeValue('controlName', options, this) || 'control';\r\n\t\tthis._cntrl.name = name;\r\n\r\n\t\tlet value = takeValue('value', options, this);\r\n\t\tvalue = this._clone(value);\r\n\t\tthis.initControlValue(value);\r\n\t\tthis.initParentControl(options);\r\n\r\n\t\tthis.once('destroy', this._onControlDestroy);\r\n\r\n\t\tthis._controlInitialized = true;\r\n\t},\r\n\tinitParentControl(options){\r\n\t\tlet parent = takeValue('proxyTo', options, this) || takeValue('parentControl', options, this);\r\n\t\tthis._cntrl.parent = parent;\r\n\t\tif (parent && _.isFunction(parent._addChildControl)) {\r\n\t\t\tparent._addChildControl(this);\r\n\t\t}\r\n\t},\r\n\tinitControlValue(value){\r\n\t\tthis._cntrl.initial = value;\r\n\t\tthis.setControlValue(value, { silent: true });\r\n\t},\r\n\tgetControlName(){\r\n\t\treturn this._cntrl.name;\r\n\t},\r\n\r\n\tisSameControlValue(value){\r\n\t\tlet current = this.getControlValue();\r\n\t\treturn this.isValid() && compareObjects(current, value);\r\n\t},\r\n\tgetControlValue(key, options = {}){\r\n\t\t\r\n\t\tif(_.isObject(key)) {\r\n\t\t\toptions = key;\r\n\t\t\tkey = undefined;\r\n\t\t}\r\n\t\tlet { notValidated, clone } = options;\r\n\t\tlet valueKey = notValidated ? 'notValidated' : 'value';\r\n\t\tlet value = this._cntrl[valueKey];\r\n\t\tif (key != null) {\r\n\t\t\treturn getByPath(value, key);\r\n\t\t} else {\r\n\t\t\treturn clone ? this._clone(value) : value;\r\n\t\t}\r\n\t},\r\n\tsetControlValue(value, options = {}){\r\n\t\tlet  { key, notValidated } = options;\r\n\t\tvalue = this._prepareValueBeforeSet(value, { key });\r\n\t\tconst resolve = Promise.resolve(value);\r\n\t\tif (this.isSameControlValue(value)) { return resolve; }\r\n\r\n\t\tthis._cntrl.notValidated = value;\r\n\r\n\t\tif (notValidated) { return resolve; }\r\n\t\treturn this._setControlValue(value, options);\r\n\t},\r\n\t_prepareValueBeforeSet(value, { key } = {}){\r\n\t\tvalue = this.prepareValueBeforeSet(value);\r\n\t\tif (key == null) { return value; }\r\n\r\n\t\tlet current = this.getControlValue({ notValidated: true, clone: true }) || {};\r\n\t\tsetByPath(current, key, value);\r\n\t\treturn current;\r\n\t},\r\n\r\n\t//override this if you need modify value before set\r\n\tprepareValueBeforeSet: value => value,\r\n\r\n\t_setControlValue(value, options = {}) {\r\n\t\tlet { skipValidation } = options;\r\n\t\tif (skipValidation) {\r\n\t\t\treturn this._onSetControlValueValidateSuccess(value, options);\r\n\t\t}\r\n\t\treturn this._validate(value, options)\r\n\t\t\t.then(\r\n\t\t\t\t() => this._onSetControlValueValidateSuccess(value, options), \r\n\t\t\t\terror => this._onSetControlValueValidateFail(error, value, options)\r\n\t\t\t);\r\n\t},\r\n\t_onSetControlValueValidateSuccess(value, options){\r\n\t\tthis._cntrl.previous = this._cntrl.value;\r\n\t\tthis._cntrl.value = value;\r\n\t\tthis._cntrl.isDone = false;\r\n\t\tthis._tryTriggerEvent('change', [value], options);\r\n\t\treturn Promise.resolve(value);\r\n\t},\r\n\t_onSetControlValueValidateFail(error, value, options){\r\n\t\tthis._tryTriggerEvent('change:fail', [value, error], options);\r\n\t\treturn ensureError(error, value);\r\n\t},\r\n\r\n\tisValid(){\r\n\t\treturn this._cntrl.isValid !== false;\r\n\t},\r\n\tvalidate(options = {}){\r\n\r\n\t\tlet notValidated = !this.isValid();\r\n\t\tlet value = this.getControlValue({ notValidated });\r\n\t\tlet promise = this._validate(value, options);\r\n\t\tlet _catch = options.catch;\r\n\r\n\t\tif (_catch === false) {\r\n\t\t\treturn promise;\r\n\t\t} else if(_.isFunction(_catch)) {\r\n\t\t\treturn promise.catch(_catch);\r\n\t\t} else {\r\n\t\t\treturn promise.catch(ensureError);\r\n\t\t}\r\n\t},\r\n\t_validate(value, options){\r\n\r\n\t\tlet validate = this._validateControlPromise(value, options);\r\n\t\treturn validate.then(\r\n\t\t\t() => this._onControlValidateSuccess(value, options),\r\n\t\t\terror => this._onControlValidateFail(error, value, options)\r\n\t\t);\r\n\t},\r\n\t_validateChildrenControlsPromise({ isControlWrapper, skipChildValidate} = {}, errors = {}){\r\n\r\n\t\tlet children = this.getChildrenControls();\r\n\t\tlet childrenPromise = Promise.resolve();\r\n\t\tif (!children.length) return childrenPromise;\r\n\r\n\t\treturn _.reduce(children, (finaly, child) => {\r\n\t\t\tlet control = child.getControlName();\r\n\r\n\t\t\tfinaly = finaly.then(() => {\r\n\r\n\t\t\t\tif (!child.validate || (skipChildValidate && control == skipChildValidate)) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tlet validateResult = child.validate({ stopPropagation: true, catch: false });\r\n\r\n\t\t\t\treturn validateResult;\r\n\t\t\t}).catch(error => {\r\n\r\n\t\t\t\tif(isControlWrapper){\r\n\t\t\t\t\terrors.wrapped = error;\r\n\t\t\t\t} else {\r\n\t\t\t\t\terrors.children[control] = error;\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t});\r\n\t\t\treturn finaly;\r\n\t\t}, childrenPromise);\t\t\r\n\r\n\t},\r\n\t_validateControlPromise(value, options){\r\n\t\t\r\n\t\tconst { skipChildValidate } = options;\r\n\t\tconst isControlWrapper = betterResult(this, 'isControlWrapper', { args:[this]});\r\n\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet childrenErrors = {\r\n\t\t\t\tchildren: {}\r\n\t\t\t};\r\n\t\t\tlet childrenPromise = this._validateChildrenControlsPromise({ skipChildValidate, isControlWrapper }, childrenErrors);\r\n\r\n\t\t\tchildrenPromise.then(() => {\r\n\r\n\t\t\t\tif (_.size(childrenErrors.children)) {\r\n\t\t\t\t\treject(childrenErrors.children);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else if (childrenErrors.wrapped) {\r\n\t\t\t\t\treject(childrenErrors.wrapped);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tlet validate = this.getOption('controlValidate', { force: false });\r\n\t\t\t\tlet values = this.getParentControlValue({ notValidated: true });\r\n\t\t\t\tlet validateResult = _.isFunction(validate) && validate.call(this, value, values, options) || undefined;\r\n\t\t\t\tlet promise = Promise.resolve(value);\r\n\t\t\t\tif (validateResult && validateResult.then) {\r\n\t\t\t\t\tpromise = validateResult;\r\n\t\t\t\t} else if(validateResult) {\r\n\t\t\t\t\tpromise = Promise.reject(validateResult);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpromise.then(\r\n\t\t\t\t\t() => resolve(value),\r\n\t\t\t\t\terror => reject(error)\r\n\t\t\t\t);\r\n\r\n\t\t\t});\r\n\t\t});\t\t\r\n\t},\r\n\r\n\r\n\r\n\t_onControlValidateSuccess(value, options){\r\n\t\tthis.makeValid(value, options);\r\n\t\treturn Promise.resolve(value);\r\n\t},\r\n\tmakeValid(value, options){\r\n\t\tthis._cntrl.isValid = true;\r\n\t\tthis._tryTriggerEvent('valid', [value], options);\r\n\t},\r\n\r\n\t_onControlValidateFail(error, value, options){\r\n\t\tthis.makeInvalid(error, value, options);\r\n\t\treturn Promise.reject(error);\r\n\t},\r\n\tmakeInvalid(error, value, options){\r\n\t\tthis._cntrl.isValid = false;\r\n\t\tthis._tryTriggerEvent('invalid', [value, error], options);\r\n\t},\r\n\r\n\tgetParentControl() {\r\n\t\treturn this._cntrl.parent;\r\n\t},\r\n\tgetParentControlValue(options) {\r\n\r\n\t\tlet parent = this.getParentControl();\r\n\t\tif (!parent || !_.isFunction(parent.getControlValue)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (betterResult(parent, 'isControlWrapper', { args:[this]})) {\r\n\t\t\treturn parent.getParentControlValue(options);\r\n\t\t} else {\r\n\t\t\treturn parent.getControlValue(options);\r\n\t\t}\r\n\t},\r\n\tgetChildrenControls(){\r\n\t\tif(!this._cntrl.children) {\r\n\t\t\tthis._cntrl.children = [];\r\n\t\t}\r\n\t\treturn this._cntrl.children;\r\n\t},\r\n\thandleChildControlEvent(event, controlName, ...args) {\r\n\t\tlet childEvent = controlName + ':' + event;\r\n\t\tlet trigger = getTriggerMethod(this);\r\n\t\ttrigger.call(this, childEvent, ...args);\r\n\r\n\t\tlet cce = this.getOption('childControlEvents', { args: [this] }) || {};\r\n\t\tlet def = this.defaultChildControlEvents || {};\r\n\t\tlet handler = cce[childEvent];\r\n\t\tif (_.isFunction(handler)) {\r\n\t\t\thandler.apply(this, args);\r\n\t\t} else {\r\n\t\t\tlet defHandler = def[event];\r\n\t\t\t_.isFunction(defHandler) && defHandler.call(this, controlName, ...args);\r\n\t\t}\r\n\t},\r\n\tdefaultChildControlEvents:{\r\n\t\t'change'(controlName, value){\r\n\t\t\tlet isControlWraper = this.getOption('isControlWrapper');\r\n\t\t\tisControlWraper && (controlName = undefined);\r\n\t\t\tthis.setControlValue(value, { key: controlName, skipChildValidate: controlName });\r\n\t\t},\r\n\t\t'done'(controlName, value){\r\n\t\t\tlet isControlWraper = this.getOption('isControlWrapper');\r\n\t\t\tisControlWraper && (controlName = undefined);\r\n\t\t\tthis.setControlValue(value, { key: controlName, skipChildValidate: controlName });\r\n\t\t},\r\n\t\t'invalid'(controlName, value, error){\r\n\t\t\tlet isControlWraper = this.getOption('isControlWrapper');\r\n\t\t\tisControlWraper && (controlName = undefined);\r\n\t\t\tthis.setControlValue(value, { key: controlName, silent: true });\r\n\t\t\tthis.makeInvalid(error);\r\n\t\t},\r\n\t},\r\n\r\n\tcontrolDone(){\r\n\t\tif (!this._cntrl.isValid || this._cntrl.isDone) { return; }\r\n\t\tlet value = this.getControlValue();\r\n\t\tthis._cntrl.isDone = true;\r\n\t\tthis._tryTriggerEvent('done', [value]);\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\thelpers\r\n\t*/\r\n\t_clone(value){\r\n\t\tif(_.isArray(value))\r\n\t\t\treturn value.slice(0);\r\n\t\telse if(_.isObject(value)) {\r\n\t\t\treturn unflat(flat(value));\r\n\t\t} else\r\n\t\t\treturn value;\r\n\t},\r\n\t_tryTriggerEvent(name, args = [], { silent, stopPropagation } = {}){\r\n\t\tif (silent) { return; }\r\n\t\tlet controlName = this.getControlName();\r\n\t\tlet event = 'control:' + name;\r\n\t\tlet namedEvent = controlName + ':' + name;\r\n\r\n\t\tlet trigger = getTriggerMethod(this);\r\n\t\t\r\n\t\ttrigger.call(this, event, ...args);\r\n\r\n\t\tlet parent = this.getParentControl();\r\n\t\tif (stopPropagation || !parent) { return; }\r\n\t\tif (_.isFunction(parent.handleChildControlEvent)) {\r\n\t\t\tparent.handleChildControlEvent(name, controlName, ...args);\r\n\t\t} else {\r\n\t\t\tlet parentTrigger = getTriggerMethod(parent);\r\n\t\t\tparentTrigger.call(this, namedEvent, ...args);\r\n\t\t}\r\n\r\n\t},\r\n\tmakeControlReady(){\r\n\t\tlet trigger = getTriggerMethod(this);\r\n\t\ttrigger.call(this, 'control:ready');\r\n\t},\r\n\r\n}, { ControlMixin: true });\r\n","import { isView, isViewClass, buildViewByKey } from '../../../utils/index.js';\r\nimport ControlMixin from '../control/index.js';\r\nimport { cssClassModifiers } from '../../view/index.js';\r\n\r\n\r\nexport default Base => {\r\n\tlet Mixed = Base;\r\n\tif (!Mixed.ControlMixin) {\r\n\t\tMixed = ControlMixin(Mixed);\r\n\t}\r\n\tif (!Mixed.CssClassModifiersMixin) {\r\n\t\tMixed = cssClassModifiers(Mixed);\r\n\t}\r\n\r\n\treturn Mixed.extend({\r\n\t\trenderAllCustoms: true,\r\n\t\tisControlWrapper: true,\r\n\t\tskipFirstValidationError: true,\r\n\t\tshouldShowError: false,\r\n\r\n\t\tconstructor(){\r\n\t\t\tMixed.apply(this, arguments);\r\n\t\t\tif(!this.cssClassModifiers) {\r\n\t\t\t\tthis.cssClassModifiers = [];\r\n\t\t\t}\r\n\t\t\tthis.addCssClassModifier('control-wrapper');\r\n\t\t\tthis.on({\r\n\t\t\t\t'control:valid': this._onControlValid,\r\n\t\t\t\t'control:invalid': this._onControlInvalid\r\n\t\t\t});\t\t\r\n\t\t},\t\r\n\r\n\t\tgetCustoms(){\r\n\t\t\tlet customs = [];\r\n\t\t\tif (this.getOption('isControlWrapper')) {\r\n\t\t\t\tcustoms.push(this.getControlView());\r\n\t\t\t} else {\r\n\t\t\t\tcustoms.push(...this._customs);\r\n\t\t\t}\r\n\t\t\tcustoms = this.injectSystemViews(customs);\r\n\t\t\treturn this._prepareCustoms(customs);\r\n\t\t},\r\n\t\tinjectSystemViews(customs = []){\r\n\t\t\tcustoms.unshift(this.getHeaderView());\r\n\t\t\tcustoms.push(\r\n\t\t\t\tthis.getErrorView(),\r\n\t\t\t\tthis.getFooterView()\t\r\n\t\t\t);\r\n\t\t\treturn customs;\r\n\t\t},\r\n\t\tbubildViewByKey(key, { skipTextCheck, options } = {}){\r\n\t\t\tlet view;\r\n\t\t\tlet value;\r\n\r\n\t\t\tif(!skipTextCheck) {\r\n\t\t\t\tvalue = this.getOption(key);\r\n\t\t\t\tif (_.isString(value)) {\r\n\t\t\t\t\tlet tagName = (key == 'header' || key == 'footer') ? key : 'div';\r\n\t\t\t\t\tview = this.buildTextView(value, tagName);\r\n\t\t\t\t\tif(view) { return view; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (value == null) {\r\n\t\t\t\tview = this.getOption(key+'View');\r\n\t\t\t} else {\r\n\t\t\t\tview = value;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(isView(view)) { return view; }\r\n\t\t\tif(isViewClass(view)) {\r\n\t\t\t\tlet _options = _.extend({}, this.getOption(key+'ViewOptions'), options);\r\n\t\t\t\treturn new view(_options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tbuildTextView(text, tagName){\r\n\t\t\tlet View = this.getOption('textView');\r\n\t\t\tif (!View) { return; }\r\n\t\t\treturn new View({ text, tagName });\r\n\t\t},\r\n\r\n\r\n\r\n\t\tgetErrorView(){\r\n\t\t\tif (!this.getOption('shouldShowError')) { return; }\r\n\t\t\tif (this.getOption('showValidateError', {force:false})) { return; }\r\n\t\t\tthis.errorView = this.buildErrorView();\r\n\t\t\treturn this.errorView;\r\n\t\t},\r\n\t\tbuildErrorView(){\r\n\t\t\treturn buildViewByKey.call(this, 'errorView', { allowTextView: false });\r\n\t\t},\r\n\r\n\r\n\r\n\t\tgetHeaderView(){\t\t\t\r\n\t\t\treturn this.buildHeaderView();\r\n\t\t},\r\n\t\tbuildHeaderView(){\r\n\t\t\treturn buildViewByKey.call(this, 'header', { allowTextView: true, options: { tagName: 'header' }});\r\n\t\t},\r\n\r\n\r\n\r\n\t\tgetFooterView(){\r\n\t\t\tif (this.getOption('buttonsInFooter')) {\r\n\t\t\t\treturn this.buildButtonsView();\r\n\t\t\t} else {\r\n\t\t\t\treturn this.buildFooterView();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbuildFooterView(){\r\n\t\t\treturn buildViewByKey.call(this, 'footer', { allowTextView: true, options: { tagName: 'footer' }});\r\n\t\t},\r\n\r\n\t\tbuildButtonsView(){\r\n\t\t\tif (this._buttonsView) {\r\n\t\t\t\tthis.stopListening(this._buttonsView);\r\n\t\t\t}\r\n\r\n\t\t\tlet options = this.buildButtonsOptions();\r\n\t\t\tlet view = buildViewByKey.call(this, 'buttonsView', { allowTextView: false, options });\r\n\t\t\tif (!view) { return; }\r\n\r\n\t\t\tthis._buttonsView = view;\r\n\t\t\tthis.settleButtonsListeners(view);\r\n\r\n\t\t\treturn view;\r\n\t\t},\r\n\t\tbuildButtonsOptions(){\r\n\t\t\tlet btns = this.getOption('buttons');\r\n\t\t\tif(btns) {\r\n\t\t\t\treturn _.reduce(btns, (hash, b) => {\r\n\t\t\t\t\tlet item = this.buildButton(b, this);\r\n\t\t\t\t\thash[item.name] = item;\r\n\t\t\t\t\treturn hash;\r\n\t\t\t\t}, {});\r\n\t\t\t}\t\t\r\n\t\t},\r\n\t\tbuildButton(value){\r\n\t\t\tif (_.isString(value)) {\r\n\t\t\t\treturn this.buildButton({ text: value, className: value, name: value });\r\n\t\t\t} else if(_.isFunction(value)) {\r\n\t\t\t\treturn this.buildButton(value.call(this));\r\n\t\t\t} else if(_.isObject(value)) {\r\n\t\t\t\treturn this.fixButton(value);\r\n\t\t\t}\r\n\t\t},\r\n\t\tfixButton(button){\r\n\t\t\treturn button;\r\n\t\t},\r\n\t\tsettleButtonsListeners(buttonsView){\r\n\t\t\tthis.listenTo(buttonsView, {\r\n\t\t\t\t'resolve'(){\r\n\t\t\t\t\tthis.triggerMethod('resolve', this.getControlValue());\r\n\t\t\t\t},\r\n\t\t\t\t'reject'(){\r\n\t\t\t\t\tthis.triggerMethod('reject');\r\n\t\t\t\t},\r\n\t\t\t\t'reject:soft'(){\r\n\t\t\t\t\tthis.triggerMethod('reject:soft');\r\n\t\t\t\t},\r\n\t\t\t\t'reject:hard'(){\r\n\t\t\t\t\tthis.triggerMethod('reject:hard');\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetControlView(){\r\n\t\t\tthis.control = buildViewByKey.call(this, 'controlView', { allowTextView: false, options: { parentControl: this } });\t\t\t\r\n\t\t\treturn this.control;\r\n\t\t},\r\n\r\n\r\n\t\t_onControlInvalid(value, error){\r\n\t\t\tthis.disableButtons();\r\n\t\t\tthis._showValidateError(error);\r\n\t\t},\r\n\t\t_onControlValid(){\r\n\t\t\tthis.enableButtons();\r\n\t\t\tthis._hideValidateError();\r\n\t\t},\r\n\t\t\r\n\t\tdisableButtons(){\r\n\t\t\tif(this._buttonsView && _.isFunction(this._buttonsView.disableButton)) {\r\n\t\t\t\tthis._buttonsView.disableButton('resolve');\r\n\t\t\t}\r\n\t\t},\r\n\t\tenableButtons(){\r\n\t\t\tif(this._buttonsView && _.isFunction(this._buttonsView.enableButton)) {\r\n\t\t\t\tthis._buttonsView.enableButton('resolve');\r\n\t\t\t}\r\n\t\t},\r\n\t\t_showValidateError(error){\r\n\t\t\t\r\n\t\t\tlet shouldShow = this.getOption('shouldShowError');\r\n\t\t\tlet skipFirstValidationError = this.getOption('skipFirstValidationError');\r\n\r\n\t\t\tif (skipFirstValidationError && !this._firstValidationErrorSkipped) {\r\n\t\t\t\tthis._firstValidationErrorSkipped = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!shouldShow) return;\r\n\r\n\t\t\tlet show = this.getOption('showValidateError', { force: false });\r\n\t\t\tif (_.isFunction(show)) {\r\n\t\t\t\tshow.call(this, error);\r\n\t\t\t} else {\r\n\t\t\t\tif (!this.errorView) return;\r\n\t\t\t\tthis.errorView.showError(error);\r\n\t\t\t}\t\t\r\n\t\t},\r\n\t\t_hideValidateError(){\r\n\t\t\tlet hide = this.getOption('hideValidateError', { force: false });\r\n\t\t\tif (_.isFunction(hide)) {\r\n\t\t\t\thide.call(this);\r\n\t\t\t} else {\r\n\t\t\t\tif (!this.errorView) return;\r\n\t\t\t\tthis.errorView.hideError();\r\n\t\t\t}\t\t\r\n\t\t},\r\n\t}, { ControlViewMixin: true });\r\n\r\n\r\n};\r\n","//import getOption from '../../../utils/get-option';\r\nimport { getOption } from '../../../utils/index.js';\r\nconst _getOption = (context, key, checkAlso) => getOption(context, key, { args:[context], checkAlso });\r\n\r\nexport default function getInputType(inputView, opts = {}){\r\n\t\r\n\tlet valueType = _getOption(inputView, 'valueType', opts);\r\n\tif (valueType == null) {\r\n\t\tlet value = inputView.getControlValue();\r\n\t\tif ( value == null) {\r\n\t\t\tvalueType = 'string';\r\n\t\t} else {\r\n\t\t\tif(_.isNumber(value))\r\n\t\t\t\tvalueType = 'number';\r\n\t\t\telse if(_.isDate(value))\r\n\t\t\t\tvalueType = 'datetime';\r\n\t\t\telse\r\n\t\t\t\tvalueType = 'string';\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tif (valueType == 'number') {\r\n\t\tinputView._valueIsNumber = true;\r\n\t}\r\n\r\n\tlet type = _getOption(inputView, 'inputType', opts);\r\n\tif(type == null){\r\n\t\ttype = _getOption(inputView.valueOptions, 'inputType', opts.valueOptions);\r\n\t}\r\n\tif (!type) {\r\n\t\tif (inputView._valueIsNumber) {\r\n\t\t\ttype = _getOption(inputView, 'inputNumberType', opts) || 'number';\r\n\t\t} else if (valueType == 'string') {\r\n\t\t\ttype = 'text';\r\n\t\t} else if (valueType == 'datetime') {\r\n\t\t\ttype = 'datetime';\r\n\t\t} else {\r\n\t\t\ttype = 'text';\r\n\t\t}\r\n\t}\r\n\tinputView.inputType = type;\r\n\tinputView.valueType = valueType;\r\n\treturn type;\r\n}\r\n","import getInputType from './get-input-type.js';\r\n\r\n//import getOption from '../../../utils/get-option';\r\nimport { getOption } from '../../../utils/index.js';\r\n\r\nexport default function setInputAttributes(inputView, opts = {}) {\r\n\r\n\tlet attributes = getOption(inputView, opts, 'attributes');\r\n\r\n\tlet check = _.extend({}, inputView, opts, inputView.valueOptions, opts.valueOptions);\r\n\r\n\tlet restrictionKeys = {\r\n\t\t'maxLength':'maxlength', \r\n\t\t'minLength':'minlength',\r\n\t\t'minValue':'min', \r\n\t\t'maxValue':'max', \r\n\t\t'valuePattern':'pattern',\r\n\t\t'required':'required',\r\n\t\t'value':'value'\r\n\t};\r\n\tlet restrictions = {};\r\n\t_(restrictionKeys).each((key2, key) => {\r\n\t\tlet value = check[key];\r\n\t\t//getOption(inputView, opts, key);\r\n\t\tif (value != null)\r\n\t\t\trestrictions[key2] = value;\r\n\t});\r\n\r\n\tinputView.attributes = _.extend({\r\n\t\tvalue: inputView.value,\r\n\t\ttype: getInputType(inputView, opts),\r\n\t}, restrictions, attributes);\r\n\t\r\n\tif(opts.attributes)\r\n\t\tdelete opts.attributes;\r\n}\r\n","//import getOption from '../../../../utils/get-option';\r\nimport { getOption } from '../../../../utils/index.js';\r\nexport default (context, key, ifNull) => getOption(context, key, { args:[context], default: ifNull });\r\n\r\n","export default function isChar(event){\r\n\treturn event.key && event.key.length == 1 && !event.ctrlKey;\r\n}","import getOption from './_get-option';\r\nimport isChar from './_is-char';\r\nexport default function(eventContext) {\r\n\tlet { context, event } = eventContext;\r\n\tlet prevent = false;\r\n\tlet stop = false;\r\n\r\n\tif (isChar(event)) {\r\n\t\tif (!context.isEnteredCharValid(event.key)) {\r\n\t\t\tprevent = true;\r\n\t\t}\r\n\t}\r\n\tif(event.keyCode == 13 && getOption(context, 'doneOnEnter', true)){\r\n\t\tprevent = true;\r\n\t\tstop = true;\r\n\t}\r\n\r\n\tstop && event.stopPropagation();\r\n\tprevent && event.preventDefault();\r\n}\r\n","import getOption from './_get-option';\r\nexport default function(eventContext) {\r\n\tlet { context, event } = eventContext;\r\n\r\n\tif (event.keyCode == 13) {\r\n\t\t\r\n\t\tlet shouldDone = getOption(context, 'doneOnEnter', true);\r\n\t\tif (shouldDone) {\r\n\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcontext.controlDone();\r\n\r\n\t\t}\r\n\r\n\t}\r\n}\r\n","export default function(eventContext) {\r\n\tlet { context, event } = eventContext;\r\n\tlet text = event.originalEvent.clipboardData.getData('text/plain');\r\n\tif (!text) return;\r\n\tif (!context.isValueValid(text)) {\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t}\r\n}\r\n","import getOption from './_get-option';\r\nexport default function(eventContext) {\r\n\tlet { context } = eventContext;\r\n\tif (getOption(context, 'doneOnBlur', true)) {\r\n\t\tcontext.controlDone();\r\n\t}\r\n}\r\n","import getOption from './_get-option';\r\nexport default function(eventContext) {\r\n\tlet { context, input } = eventContext;\r\n\tif (getOption(context, 'selectOnFocus', true)) {\r\n\t\tinput.select();\r\n\t}\r\n}\r\n","export default function(eventContext) {\r\n\r\n\tlet { context, input, event } = eventContext;\r\n\r\n\tcontext.setControlValue(event.target.value).then(newvalue => {\r\n\t\tif (event.target.value != (newvalue || '').toString()) {\r\n\t\t\tinput.value = newvalue;\r\n\t\t}\r\n\t});\r\n\t//context.triggerControlChange();\r\n}\r\n","import keydown from './keydown';\r\nimport keyup from './keyup';\r\nimport paste from './paste';\r\nimport blur from './blur';\r\nimport focus from './focus';\r\nimport input from './input';\r\n//import jsChange from './js-change';\r\nexport default {\r\n\tkeydown, \r\n\t//keypress,\r\n\tkeyup,\r\n\tpaste,\r\n\tblur,\r\n\tfocus,\r\n\tinput,\r\n\t//'js:change': jsChange\r\n};","//import camelCase from '../../../utils/camel-case';\r\nimport { camelCase } from '../../../utils/index.js';\r\nimport events from './events/index.js';\r\nexport default function handleInputEvent(control, eventName, event) {\r\n\tlet options = _.extend({\r\n\t\tcontext: control,\r\n\t\tinput: control.el,\r\n\t\trestrictions: control.restrictions,\r\n\t\teventName,\r\n\t\tevent\r\n\t});\r\n\r\n\r\n\tlet method = camelCase(`on:dom:${eventName}`);\r\n\r\n\tif (_.isFunction(events[eventName])) {\r\n\t\tevents[eventName].call(control, options);\r\n\t} \r\n\t\r\n\tif (_.isFunction(control[method])) {\r\n\t\tcontrol[method](event, options);\r\n\t} \r\n}\r\n","import handleEvent from './handle-event.js';\r\nimport eventHandlers from './events/index.js';\r\n//import getOption from '../../../utils/get-option';\r\nimport { getOption } from '../../../utils/index.js';\r\n\r\nconst _getOption = (context, key, checkAlso) => \r\n\tgetOption(context, key, { args:[context], checkAlso });\r\n\r\nexport default function setInputEvents(inputView, opts = {}) {\r\n\r\n\tlet passedEvents = _getOption(inputView, 'events', opts);\t\r\n\r\n\tlet eventsArray = _(eventHandlers).keys();\t\r\n\tlet events = _.reduce(eventsArray, (Memo, eventName) => {\r\n\t\tMemo[eventName] = function(event){ \r\n\t\t\thandleEvent(this, eventName, event); \r\n\t\t};\r\n\t\treturn Memo;\r\n\t}, {});\r\n\tinputView.events = _.extend(events, passedEvents);\r\n}\r\n","import ControlMixin from '../control/index.js';\r\nimport setInputAttributes from './set-attributes.js';\r\nimport setInputEvents from './set-events.js';\r\n// import getOption from '../../../utils/get-option';\r\n// import convert from '../../../utils/convert-string';\r\nimport { convertString as convert, getOption } from '../../../utils/index.js';\r\nexport default Base => {\r\n\r\n\tlet Mixin = Base.ControlMixin ? Base : ControlMixin(Base);\r\n\r\n\treturn Mixin.extend({\r\n\t\tconstructor(opts){\r\n\t\t\t\r\n\t\t\tthis._initControl(opts);\r\n\r\n\t\t\tsetInputAttributes(this, opts);\r\n\t\t\tsetInputEvents(this, opts);\r\n\t\t\tMixin.apply(this, arguments);\r\n\r\n\t\t\tif (!_.isFunction(this.getOption)) {\r\n\t\t\t\tthis.getOption = _.partial(getOption, this, _, { args: [this]});\r\n\t\t\t}\r\n\r\n\t\t\tthis.buildRestrictions();\r\n\t\t\tlet value = this.getOption('value') || '';\t\t\t\r\n\t\t\tthis.el.value = value;\r\n\t\t\t//this.setControlValue(value, { trigger: false, silent: true });\r\n\t\t},\r\n\t\ttagName:'input',\r\n\t\ttemplate: false,\r\n\t\tdoneOnEnter: true,\r\n\t\tdoneOnBlur: true,\r\n\t\tbuildRestrictions(){\r\n\t\t\tlet attrs = _.result(this, 'attributes');\r\n\t\t\tlet pickNumbers = ['maxlength', 'minlength', 'min', 'max'];\r\n\t\t\tlet pickStrings = ['pattern'];\r\n\t\t\tlet pickBools = ['required'];\r\n\t\t\tlet restrictions = {};\r\n\t\t\t_(attrs).each((value, key) => {\r\n\t\t\t\tlet pick = false;\r\n\t\t\t\tkey = key.toLowerCase();\r\n\t\t\t\tif (pickNumbers.indexOf(key) > -1) {\r\n\t\t\t\t\tvalue = convert(value, 'number');\r\n\t\t\t\t\tpick = true;\r\n\t\t\t\t} else if (pickStrings.indexOf(key) > -1) {\r\n\t\t\t\t\tpick = true;\r\n\t\t\t\t} else if (pickBools.indexOf(key) > -1) {\r\n\t\t\t\t\tpick = true;\r\n\t\t\t\t\tvalue = convert(value, 'boolean', { returnNullAndEmptyAs: true, returnOtherAs: true });\r\n\t\t\t\t}\r\n\t\t\t\tpick && (restrictions[key] = value);\r\n\t\t\t});\r\n\t\t\tthis.restrictions = restrictions;\t\t\r\n\t\t},\r\n\t\tprepareValueBeforeSet(value){\r\n\t\t\tif (value == null || value === '') return value;\r\n\t\t\t\r\n\t\t\tlet len = this.getMaxLength();\r\n\t\t\tif (len > 0) {\r\n\t\t\t\tvalue = value.toString().substring(0, len);\r\n\t\t\t}\r\n\t\t\tif (this._valueIsNumber) {\r\n\t\t\t\tlet num = convert(value, 'number');\r\n\t\t\t\tif(isNaN(num))\r\n\t\t\t\t\treturn;\r\n\t\t\t\tlet min = this.restrictions.min;\r\n\t\t\t\tlet max = this.restrictions.max;\r\n\t\t\t\t!isNaN(min) && num < min && (num = min);\r\n\t\t\t\t!isNaN(max) && num > max && (num = max);\r\n\t\t\t\treturn num;\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tgetValueType(){\r\n\t\t\treturn this.valueType;\r\n\t\t},\r\n\t\tconvertValue(value){\r\n\t\t\treturn convert(value, this.getValueType());\r\n\t\t},\t\t\r\n\t\tgetMaxLength()\r\n\t\t{\r\n\t\t\treturn this.restrictions.maxlength;\r\n\r\n\t\t},\r\n\t\tisLengthValid(){\r\n\t\t\tlet value = this.getControlValue();\r\n\t\t\tlet len = this.getMaxLength();\r\n\t\t\treturn len == null || value.length < len;\r\n\t\t},\r\n\t\tisEnteredCharValid(char) {\r\n\t\t\tlet type = this.getValueType();\r\n\r\n\t\t\tif (type == 'number') {\r\n\t\t\t\treturn ['.','-'].indexOf(char) > -1 || !isNaN(parseInt(char, 10));\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tisValueValid(value){\r\n\t\t\tlet type = this.getValueType();\r\n\t\t\tif (type == 'number') {\r\n\t\t\t\treturn !isNaN(parseFloat(value, 10));\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tcontrolValidate(value){\r\n\t\t\tif (value == null || value === '') {\r\n\t\t\t\tif(this.restrictions.required)\r\n\t\t\t\t\treturn 'required';\r\n\t\t\t\telse if (this.restrictions.minLength > 0) {\r\n\t\t\t\t\treturn 'length:small';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet strValue = value.toString();\r\n\t\t\tif (_.isNumber(this.restrictions.maxlength) && strValue.length > this.restrictions.maxlength)\r\n\t\t\t\treturn 'length:big';\r\n\t\t\tif (this._valueIsNumber) {\r\n\t\t\t\tif (!_.isNumber(value))\r\n\t\t\t\t\treturn 'not:number';\r\n\t\t\t\tif (_.isNumber(this.restrictions.min) && value < this.restrictions.min)\r\n\t\t\t\t\treturn 'less:than:min';\r\n\t\t\t\tif (_.isNumber(this.restrictions.max) && value > this.restrictions.max)\r\n\t\t\t\t\treturn 'greater:than:max';\r\n\t\t\t}\r\n\t\t\tif (this.restrictions.pattern) {\r\n\t\t\t\tlet pattern = RegExp(this.restrictions.pattern);\r\n\t\t\t\tif (pattern.test(strValue)) {\r\n\t\t\t\t\treturn 'pattern:mismatch';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n","//import View from 'base/collection-view';\r\n//import Button from 'components/button';\r\nexport default Base => Base.extend({\r\n\tconstructor(options){\r\n\t\tif (!this.cssClassModifiers) {\r\n\t\t\tthis.cssClassModifiers = [];\r\n\t\t}\r\n\t\tthis._buttons = {};\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis.addPromiseBarCssClass();\r\n\t\tthis.mergeOptions(options, ['promise', 'reject', 'resolve', 'beforeRejectSoft', 'beforeRejectHard', 'beforeResolve']);\r\n\t},\r\n\tclassName:'promise-bar',\r\n\ttagName: 'footer',\r\n\tresolve:'ok',\r\n\ttriggerNameEvent: true,\r\n\taddPromiseBarCssClass(){\r\n\t\tthis.cssClassModifiers.push('promise-bar');\r\n\t},\r\n\tonRender(){\r\n\t\tthis.addButtons();\r\n\t},\r\n\taddButtons(){\r\n\t\tlet buttons = this.buildButtons() || [];\r\n\t\twhile (buttons.length){\r\n\t\t\tlet button = buttons.pop();\r\n\t\t\tlet preventRender = !!buttons.length;\r\n\t\t\tthis.addChildView(button, { preventRender });\r\n\t\t}\r\n\t},\r\n\tbuildButtons(){\r\n\t\tlet names = ['resolve','rejectSoft','rejectHard'];\r\n\t\treturn _.reduce(names, (buttons, name) => {\r\n\t\t\tlet button = this.buildButton(name);\r\n\t\t\tbutton && buttons.push(button);\r\n\t\t\treturn buttons;\r\n\t\t}, []);\r\n\t},\r\n\tbuildButton(name){\r\n\t\tlet options = this.getButtonOptions(name);\r\n\t\tif (!options) return;\r\n\t\tlet Button = this.getOption('buttonView');\r\n\t\tlet btn = new Button(options);\r\n\t\tthis._buttons[name] = btn;\r\n\t\treturn btn;\r\n\t},\r\n\tgetButtonOptions(name){\r\n\t\tlet options = this.getOption(name);\r\n\t\tif ( !options ) return;\r\n\t\tif( _.isString(options) ) {\r\n\t\t\toptions = { text: options };\r\n\t\t} else if(!_.isObject(options)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet defs = { \r\n\t\t\tclassName: name, \r\n\t\t\tname, \r\n\t\t\ttriggerNameEvent: this.getOption('triggerNameEvent'), \r\n\t\t\tstopEvent: true \r\n\t\t};\r\n\t\toptions = _.extend(defs, options);\r\n\t\treturn options;\r\n\t},\r\n\tchildViewEvents:{\r\n\t\t'click:resolve'(data){\r\n\t\t\tthis.triggerMethod('resolve', data);\r\n\t\t},\r\n\t\t'click:rejectSoft'(value){ \r\n\t\t\tthis.triggerMethod('reject', { type: 'soft', value });\r\n\t\t\tthis.triggerMethod('reject:soft', value);\r\n\t\t},\r\n\t\t'click:rejectHard'(value){ \r\n\t\t\tthis.triggerMethod('reject', { type: 'hard', value });\r\n\t\t\tthis.triggerMethod('reject:hard', value);\r\n\t\t},\r\n\t\t'click:fail'(error, name, event, view) {\r\n\t\t\tthis.triggerMethod('click:fail', error, name, event, view);\r\n\t\t\tif (name) {\r\n\t\t\t\tthis.triggerMethod(`click:${name}:fail`, error, event, view);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tdisableButton(name){\r\n\t\tlet btn = this._buttons[name];\r\n\t\tbtn && btn.disable();\r\n\t},\r\n\tenableButton(name){\r\n\t\tlet btn = this._buttons[name];\r\n\t\tbtn && btn.enable();\r\n\t},\r\n\r\n});\r\n"],"names":["MnObject","Mn","Object","ctors","Model","Collection","View","Router","tryGetFromMn","_","each","isFunction","ClassName","push","isKnownCtor","arg","isFn","result","knownCtors","some","ctor","prototype","betterResult","obj","key","opts","context","args","checkAlso","force","defaultValue","default","isString","value","apply","isObject","alsoOptions","omit","camelCase","text","first","splitter","replace","match","prefix","toUpperCase","toLowerCase","isClass","Base","isModel","isModelClass","isCollection","isCollectionClass","isView","isViewClass","extend","getModel","model","compareAB","a","b","func","isArray","every","f","call","getView","comparator","length","single","toNumber","isNumber","parseFloat","isNaN","undefined","trueValues","falseValues","alternative","returnValue","isBoolean","valueOrAlternative","nullable","nullValue","alts","alt","convertToBoolean","other","options","defaultOptions","strict","returnNullAs","returnEmptyAs","returnNullAndEmptyAs","returnAnyAs","returnOtherAs","toString","isTrue","indexOf","isFalse","convertString","type","toBoolean","traverse","fields","root","babelHelpers.typeof","hash","attributes","props","getOwnPropertyNames","x","name","prop","Date","Array","flattenObject","res","getProperty","get","gettingByPath","getByPathArray","propertyName","pathArray","nextName","shift","getByPath","path","split","slice","getOption","also","_opts","deep","instanceGetOption","transformStringArray","arr","ignoreCase","toCamelCase","map","hasFlag","flag","Error","has","all","values","flags","intersection","createMixinFromObject","mixedObj","clone","mixedCtor","constructor","mx","arguments","normalizeArguments","raw","wrap","wrapObjectWithConstructor","merge","mergeObjects","mixins","size","unshift","withMethod","Mixed","class","reduce","Memo","Ctor","mixed","mix","_ctor","pstoSetPair","pair","keyvalue","join","pstoSetKeyValue","decodeURIComponent","paramsToObject","emptyObject","pairs","setProperty","set","silent","ensureSetByPathArguments","errors","setByPathArr","argumentsErrors","ensureArguments","modelContext","models","normalizeSetByPathOptions","ext","triggerModelEventsOnSetByPath","rest","pathChunks","trigger","property","setByPath","normalizeOptions","setByPathArray","unFlat","e","compareObjects","objectA","objectB","allvalues","uniq","concat","valuesA","filter","_v","valuesB","allkeys","keys","mergeObject","src","dst","flatSrc","flat","flatDst","unflat","triggerMethod","event","methodName","method","triggerMethodOn","mergeOptions","option","Process","process","concurrent","concurrencyCheck","run","isPromisable","Promise","then","asArray","race","promises","valueToPromise","resolve","reject","_initDefaults","_initCancelation","_mergeOptions","cid","uniqueId","cancelPromise","cancel","previous","getProcessFromContext","promise","updateProcessInContext","_createLifeCyclePromise","_notCanceled","_begin","_beforeStart","_canBeStarted","_waitOtherPromises","triggerComplete","catch","triggerError","error","jsError","getJsError","_cancelationRace","_getHookResultAsPromise","contextMethod","invokeOnContext","hookName","procMethod","procHook","cntxHook","triggerOnContext","onComplete","triggerEnd","onError","getContextProcessKey","eventName","register","router","update","routeArgumentsToObject","route","callback","isRouterHoldsActions","rawRoute","isRegExp","_routeToRegExp","callbackWrapper","bind","_processCallback","createActionContext","routeContext","fragment","rawArgs","_extractParameters","queryString","pop","qs","prepareActionQueryString","prepareActionArguments","routeType","queryStringParser","params","index","substring","toPromise","getCallbackFunction","executeResult","exception","processCallback","actionContext","asPromise","triggerEvent","shouldTriggerEvent","execute","lastAttempt","handleError","handlers","_getHandleContext","applyHandler","handler","getHandler","items","setHandler","memo","item","getHandleContext","custom","$","Deferred","BaseRouter","BbRouter","with","GetOptionMixin","routes","getInitRoutes","addRoutes","controller","approutes","_buildRouteContext","registerRouteContext","_storeCreatedContext","isRouteChaining","normalized","chain","_normalizeRoutes","doNotReverse","reverse","registered","addRoute","massAdd","c","buildRouteContextFromArguments","buildRouteContext","history","routeContexts","restart","action","handle","paramStringToObject","optionalParam","namedParam","splatParam","escapeRegExp","optional","RegExp","find","cntx","test","page","contexts","getRoutesContexts","startPage","beforePageStart","start","afterPageStart","previousPage","isStarted","stop","defaultStartableOptions","contextState","keyValue","storeState","ensureState","processingName","processedName","restoreState","shouldThrow","status","defaultStartOptions","defaultStopOptions","_initializeStartable","startable","isNotIddle","_initializeChildrenable","parent","_childrenInitialized","children","_children","_initializeChild","child","Child","invoked","buildChildOptions","buildChild","exclude","_childFilter","childFilter","_getChildren","includeSelf","getChildren","getAllChildren","flatten","initializeRouter","_buildRoutesContexts","_createRouter","_shouldRegisterAllRoutes","pages","registerPageRoutes","config","getRoutesConfig","_normalizeRoutesContextRoute","routesContext","order","relative","parentContext","getMainRouteContext","mainRouteContext","sortBy","main","take","BasePage","ChildrenableMixin","StartableMixin","RoutesMixin","initializeRoutes","initializeChildren","registerAllRoutes","getLabel","getParent","i","getHash","visible","getSiblings","getAllPages","parentCid","getMenuLabel","hidden","historyNavigate","navigate","historyLoadUrl","matchRoot","getFragment","executed","executeHandler","testHandler","findHandler","customTest","resultContext","loadUrl","entries","listenTo","onRoute","onBackRoute","isActionContext","lastElement","gobackContext","lookFor","last","hasElements","Events","url","go","navigateBack","nativeAjax","_nativeAjax","tokenizedAjax","headers","getAjaxHeaders","Token","ajaxHeaders","flows","initializeFlows","setExpiration","shouldRequestOnInitialize","getReady","ready","hasToken","refresh","setFlow","endPoint","getToken","tokenAttribute","refreshTokenAttribute","data","_fetching","json","parsed","parse","xhr","clearOnFail","clear","fullhash","unset","shouldUnset","setHash","reflectTokenChanges","Backbone","ajax","token","Authorization","Accept","store","updateAjaxHeaders","replaceBackboneAjax","storeToken","isExpired","getFlow","getRefreshTokenData","fetch","getRefreshToken","expiresAt","date","now","isDate","seconds","minutes","hours","days","setDate","getDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","valueOf","getExpiration","secondsOffset","username","password","grant_type","setNativeAjax","old","collection","init","previousCollection","destroy","_removeCollection","initModels","_setCollectionListeners","_store","filtered","byModel","isFiltered","isSorted","stopListening","_removeItems","_clearCollectionStore","_modelsInitialized","_onCollectionUpdate","_onCollectionReset","_onCollectionSort","listenToOnce","_onCollectionFirstFetch","enableCollection","_rebuildModels","sort","getFilter","_getModelContext","create","_storeContext","_sortItems","getComparator","col","changes","added","removed","merged","_filterItems","_addItems","attach","_updateIndexes","processAndRender","_items","_filtered","add","remove","_getItems","_dataComparator","previousModels","view","$container","$el","skip","Infinity","dataComparator","preventRender","dataFilter","customs","customContext","_normalizeAddCustomContext","_isDestroyed","_setupJustCreatedView","getCustoms","_checkCustomCondition","rebuild","_destroyChildView","_detachChildView","customView","enableFilterForCustomViews","condition","detached","destroyed","_injectEmptyView","newitems","_ensureContextHasView","splice","build","viewFn","isInPage","paginator","from","to","viewIsGood","renderView","_isRendered","supportsRenderLifecycle","render","destroyView","disableDetachEvents","_disableDetachEvents","supportsDestroyLifecycle","shouldTriggerDetach","_isAttached","forceSort","forceFilter","_removeEmptyViewInstance","totalDetach","detach","_setItems","getPaginator","_injectCustoms","total","skiped","taked","lastResult","setTimeout","iterator","shouldUpdateIndex","isNew","markNew","pass","iteratee","_a","_b","_removeItem","id","createView","removeCustomViews","triggerViewMethod","_destroyChildViews","_detachChildViews","_attachChildViews","views","getChildrenContainer","monitorViewEvents","Dom","detachContents","shouldDisableEvents","detachEl","el","shouldTriggerAttach","elBuffer","createBuffer","appendContents","_$contents","_$el","_createModelChildView","_createCustomChildView","created","_getChildViewClass","_getChildViewOptions","onBuild","_proxyChildViewEvents","modelView","modelViewOptions","EmptyViewMixin","_emptyViewInstance","emptyView","_getEmptyViewClas","emptyViewOptions","MergeOptions","ViewManager","_ensureOptions","setCollection","borrow","common","_disallowedKeys","allowedKey","fake","val","String","removeItem","session","sessionStorage","local","localStorage","getStore","SECONDS","MINUTES","HOURS","DAYS","normValue","toJSON","expireAt","datePattern","textDate","jsonParse","_this","JSON","_jsonParse","_createItem","getItem","_parse","checkExpire","_get","expired","_isExpired","getExpireAt","_normalizeValue","_set","offset","stringify","setItem","errorProps","normalizeAppErrorOptions","message","AppError","newKeywordOmited","important","urlRoot","pick","captureStackTrace","ViewStack","unremovableKey","destroyOnRemove","removeOnEsc","removeOnOutsideClick","stack","_setupView","_stackChanged","preventRemove","getUnremovableKey","_removeView","selfDestroy","_destroyView","getLast","isViewUnremovable","_cleanUpView","change","_setDocumentListeners","_unsetDocumentListeners","eventElement","viewElement","getViewDomElement","contains","isElementOutsideOfView","getViewIfElementOutside","target","preventDefault","stopPropagation","keyCode","removeLast","_documentListeners","$doc","getDocument","_shouldRemoveOnEsc","_escapePressHandler","escapePressHandler","on","_shouldRemoveOnOutsideClick","_outsideClickHandler","outsideClickHandler","off","document","_isDestroying","destroyLast","_onKeyUp","_outsideClick","BaseNodeRegion","Region","destroySelf","destroyNode","normalizeElement","selector","body","querySelector","Element","jquery","renderInNode","replaceElement","destroySelfOnEmpty","destroyOnEmpty","NodeRegion","createElement","appendChild","region","show","CollectionView","_handleEmptyFetch","_renderChildren","rebuildIndexes","findByModel","_index","_isModelView","_addChild","v1","v2","_hasUnrenderedViews","_addedViews","_views","_showEmptyView","els","_getBuffer","_attachChildren","hasIndex","isAddedToEnd","_destroyEmptyView","isEmpty","EmptyView","_getEmptyView","_getEmptyViewOptions","addChildView","_removeChildView","_removeChild","CollectionViewMixin_4x","_customs","_initializeCustoms","optionsCustoms","instanceCustoms","shouldMergeCustoms","_renderCustoms","addChildViews","_prepareCustoms","rawcustoms","array","_prepareCustom","buildCustom","childOptions","awaitingRender","CustomsMixin","defaultCssConfig","cssClassModifiers","_setupCssClassModifiers","modifier","className","_getCssClassString","removeAttr","attr","optsModifiers","propsModifiers","modifiers","_getCssClassModifiers","getCssClassModifiers","classes","cls","trim","_cssClassModifiersInitialized","cfg","getCssClassConfig","events","getCssClassEvents","refreshCssClass","modelChange","_getCssClassConfig","beforeRender","_getCssClassEvents","CssClassModifiersMixin","defaultSelector","defaultUpdateDom","element","addClass","append","buildRegionFunc","autoCreateRegion","updateDom","regionEl","getRegion","testEl","definition","addRegion","normalizeNestedViewContextRegion","regionName","partial","buildRegion","_nestedViews","initializeNestedViews","_nestedViewsInitialized","showAllNestedViews","nesteds","addNestedView","normalizeRegion","getNestedViewContext","_normalizeNestedContext","_createNestedContext","isRendered","showNestedView","getNestedViewRegion","buildNestedView","passedView","template","buildNestedViewOptions","BaseView","_initializeViewManager","noop","_fallbackOptions","_viewManager","managedCollection","_customViewsQueue","addCustomView","childView","childViewOptions","getTemplate","_reInitRegions","_renderTemplate","bindUIElements","setComparator","viewComparator","setFilter","viewFilter","DestroyMixin","BackboneView","setText","html","mixWith","nextCollectionView","closest","v","createCloseButton","takeOptionsView","Button","_view","tagName","TextView","modalChildren","_initContentListeners","content","ModalView","ViewMixin","MnView","CloseButtonView","stackOptions","showOptions","modal","buildView","getStack","buildViewByKey","allowTextView","_options","Mixin","defaultGetArguments","defaults","getNestedResult","schema","nested","getPropertySchema","getDisplayConfig","getPropertyDisplayConfig","display","originalGet","transform","ifEmpty","label","_isFetching","_isFetched","beforeClick","takeValue","second","getTriggerMethod","ensureError","_initControl","once","validate","getParentControl","_removeChildControl","getChildrenControls","_removeParentControl","_cntrl","control","_controlInitialized","_clone","initControlValue","initParentControl","_onControlDestroy","_addChildControl","initial","setControlValue","current","getControlValue","isValid","notValidated","valueKey","_prepareValueBeforeSet","isSameControlValue","_setControlValue","prepareValueBeforeSet","skipValidation","_onSetControlValueValidateSuccess","_validate","_onSetControlValueValidateFail","isDone","_tryTriggerEvent","_catch","_validateControlPromise","_onControlValidateSuccess","_onControlValidateFail","isControlWrapper","skipChildValidate","childrenPromise","finaly","getControlName","validateResult","wrapped","childrenErrors","_validateChildrenControlsPromise","getParentControlValue","makeValid","makeInvalid","controlName","childEvent","cce","def","defaultChildControlEvents","defHandler","isControlWraper","namedEvent","handleChildControlEvent","parentTrigger","ControlMixin","addCssClassModifier","_onControlValid","_onControlInvalid","getControlView","injectSystemViews","getHeaderView","getErrorView","getFooterView","skipTextCheck","buildTextView","errorView","buildErrorView","buildHeaderView","buildButtonsView","buildFooterView","_buttonsView","buildButtonsOptions","settleButtonsListeners","btns","buildButton","fixButton","button","buttonsView","parentControl","disableButtons","_showValidateError","enableButtons","_hideValidateError","disableButton","enableButton","shouldShow","skipFirstValidationError","_firstValidationErrorSkipped","showError","hide","hideError","ControlViewMixin","_getOption","getInputType","inputView","valueType","_valueIsNumber","valueOptions","inputType","setInputAttributes","check","restrictionKeys","restrictions","key2","ifNull","isChar","ctrlKey","eventContext","prevent","isEnteredCharValid","shouldDone","controlDone","originalEvent","clipboardData","getData","isValueValid","input","select","newvalue","handleInputEvent","setInputEvents","passedEvents","eventsArray","eventHandlers","buildRestrictions","attrs","pickNumbers","pickStrings","pickBools","convert","len","getMaxLength","num","min","max","getValueType","maxlength","char","parseInt","required","minLength","strValue","pattern","_buttons","addPromiseBarCssClass","addButtons","buttons","buildButtons","names","getButtonOptions","btn","defs","disable","enable"],"mappings":"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"}